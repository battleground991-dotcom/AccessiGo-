<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#FFD700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="AccessiGo - Bengaluru Namma Metro Accessibility Companion">
    
    <title>AccessiGo - Namma Metro Accessibility</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='128' fill='%23FFD700'/><path d='M128 200h256M128 312h256M200 128v256M312 128v256' stroke='%23000' stroke-width='32' stroke-linecap='round'/></svg>">
    <meta name="apple-mobile-web-app-title" content="AccessiGo">
    <link rel="apple-touch-startup-image" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1125 2436'><rect fill='%230A0A0A' width='1125' height='2436'/><rect x='362' y='1018' width='400' height='400' rx='80' fill='%23FFD700'/></svg>">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Tailwind -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <style>
        :root {
            --gold-50: #FFFEF0;
            --gold-100: #FFF9D6;
            --gold-200: #FFF3AD;
            --gold-300: #FFEC85;
            --gold-400: #FFE55C;
            --gold-500: #FFD700;
            --gold-600: #E6C200;
            --gold-700: #B39600;
            --gold-800: #806B00;
            --gold-900: #4D4000;
            --purple-line: #7B2D8E;
            --green-line: #00A650;
            --yellow-line: #FFCC00;
        }
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            html { scroll-behavior: auto; }
        }
        
        /* Skip Link */
        .skip-link {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold-500);
            color: #000;
            padding: 12px 24px;
            border-radius: 0 0 12px 12px;
            font-weight: 600;
            z-index: 10000;
            transition: top 0.2s;
        }
        .skip-link:focus {
            top: 0;
            outline: 3px solid #000;
            outline-offset: 2px;
        }
        
        /* Focus Styles */
        *:focus-visible {
            outline: 3px solid var(--gold-500);
            outline-offset: 3px;
            border-radius: 4px;
        }
        
        /* Glassmorphism Base */
        .glass {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .glass-light {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .glass-gold {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.05) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .animate-slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-slide-down { animation: slideDown 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-scale-in { animation: scaleIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-pulse { animation: pulse 2s ease-in-out infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        
        /* Stagger delays */
        .stagger-1 { animation-delay: 0.1s; }
        .stagger-2 { animation-delay: 0.2s; }
        .stagger-3 { animation-delay: 0.3s; }
        .stagger-4 { animation-delay: 0.4s; }
        .stagger-5 { animation-delay: 0.5s; }
        
        /* Button Press Effect */
        .btn-press {
            transition: transform 0.15s cubic-bezier(0.16, 1, 0.3, 1), box-shadow 0.15s ease;
        }
        .btn-press:active {
            transform: scale(0.96);
        }
        
        /* Crowd Level Pills */
        .crowd-low { background: linear-gradient(135deg, #10B981, #059669); }
        .crowd-medium { background: linear-gradient(135deg, #F59E0B, #D97706); }
        .crowd-high { background: linear-gradient(135deg, #EF4444, #DC2626); }
        
        /* Metro Lines */
        .line-purple { background: var(--purple-line); }
        .line-green { background: var(--green-line); }
        .line-yellow { background: var(--yellow-line); }
        
        /* Bottom Sheet */
        .bottom-sheet {
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .bottom-sheet.open {
            transform: translateY(0);
        }
        
        /* Page Transitions */
        .page {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .page.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Dynamic Island */
        .dynamic-island {
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 215, 0, 0.5);
        }
        
        /* Toast Notification */
        .toast {
            animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        .toast.hiding {
            animation: slideUp 0.3s ease-in forwards reverse;
        }
        
        /* Gradient backgrounds */
        .bg-gradient-gold {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }
        
        .bg-gradient-dark {
            background: linear-gradient(180deg, #0A0A0A 0%, #1A1A1A 100%);
        }
        
        /* Text gradient */
        .text-gradient-gold {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Leaflet Map Customization */
        .leaflet-container {
            background: #1a1a2e;
            border-radius: 1.5rem;
        }
        
        .leaflet-popup-content-wrapper {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            color: white;
        }
        
        .leaflet-popup-tip {
            background: rgba(26, 26, 46, 0.95);
        }
        
        .custom-marker {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }
        
        .bus-marker {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.4);
        }
        
        .location-marker {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5);
            animation: pulse 2s infinite;
        }
        
        /* Map Modal */
        .map-modal {
            backdrop-filter: blur(10px);
        }
        
        /* SOS Button Glow */
        @keyframes sosGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5), 0 0 40px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.8), 0 0 60px rgba(239, 68, 68, 0.5); }
        }
        
        #sos-button {
            animation: sosGlow 2s ease-in-out infinite;
        }
        
        /* Request Status Colors */
        .status-pending { background: linear-gradient(135deg, #F59E0B, #D97706); }
        .status-accepted { background: linear-gradient(135deg, #3B82F6, #1D4ED8); }
        .status-processing { background: linear-gradient(135deg, #8B5CF6, #6D28D9); }
        .status-completed { background: linear-gradient(135deg, #10B981, #059669); }
        
        /* Timer pulse */
        @keyframes timerPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .timer-pulse {
            animation: timerPulse 1s ease-in-out infinite;
        }
        
        /* Urgent badge */
        @keyframes urgentShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }
        
        .urgent-badge {
            animation: urgentShake 0.5s ease-in-out infinite;
        }
        
        /* Voice Assistant Animations */
        @keyframes voicePulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        @keyframes voiceWave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(2); }
        }
        
        @keyframes orbGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.5), 0 0 60px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 50px rgba(139, 92, 246, 0.8), 0 0 100px rgba(139, 92, 246, 0.5); }
        }
        
        .voice-listening #voice-orb > div:first-child {
            animation: orbGlow 1.5s ease-in-out infinite;
        }
        
        .voice-listening #pulse-ring-1,
        .voice-listening #pulse-ring-2,
        .voice-listening #pulse-ring-3 {
            display: block !important;
        }
        
        #voice-assistant-btn.listening {
            animation: orbGlow 1.5s ease-in-out infinite;
        }
        
        #voice-assistant-btn.listening #voice-listening-indicator {
            display: block !important;
            animation: voicePulse 1.5s ease-out infinite;
        }
        
        /* Voice wave bars */
        .voice-wave {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            height: 40px;
        }
        
        .voice-wave .bar {
            width: 4px;
            height: 20px;
            background: linear-gradient(to top, #8B5CF6, #6366F1);
            border-radius: 2px;
            animation: voiceWave 0.5s ease-in-out infinite;
        }
        
        .voice-wave .bar:nth-child(1) { animation-delay: 0s; }
        .voice-wave .bar:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave .bar:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave .bar:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave .bar:nth-child(5) { animation-delay: 0.4s; }
    </style>
</head>
<body class="bg-gradient-dark min-h-screen text-white overflow-x-hidden">
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Dynamic Island Status Bar -->
    <div id="dynamic-island" onclick="showRequestDetails()" class="dynamic-island fixed top-4 left-1/2 -translate-x-1/2 z-50 glass rounded-full px-4 py-2 hidden items-center gap-3 cursor-pointer hover:bg-white/10 transition-colors" role="status" aria-live="polite">
        <div id="island-dot" class="w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></div>
        <span id="island-text" class="text-sm font-medium">Assistance Request Active</span>
        <svg class="w-4 h-4 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-20 left-1/2 -translate-x-1/2 z-40 flex flex-col gap-2" aria-live="polite"></div>
    
    <!-- Main App Container -->
    <div id="app" class="min-h-screen">
        
        <!-- Landing Page -->
        <div id="page-landing" class="page active min-h-screen flex flex-col">
            <div class="flex-1 flex flex-col items-center justify-center p-6 text-center">
                <!-- Logo -->
                <div class="mb-8 animate-float">
                    <div class="w-24 h-24 rounded-3xl bg-gradient-gold flex items-center justify-center shadow-2xl shadow-yellow-500/30">
                        <svg class="w-14 h-14 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                        </svg>
                    </div>
                </div>
                
                <h1 class="text-4xl md:text-5xl font-bold mb-4 animate-slide-up">
                    <span class="text-gradient-gold">AccessiGo</span>
                </h1>
                
                <p class="text-lg text-gray-400 mb-2 animate-slide-up stagger-1" style="opacity:0">
                    Bengaluru Namma Metro
                </p>
                <p class="text-xl text-white font-medium mb-8 animate-slide-up stagger-2" style="opacity:0">
                    Your Accessibility Companion
                </p>
                
                <!-- Language Selector -->
                <div class="mb-8 animate-slide-up stagger-3" style="opacity:0">
                    <label for="language-select" class="sr-only">Select Language</label>
                    <select id="language-select" class="glass rounded-2xl px-6 py-3 text-white font-medium cursor-pointer hover:bg-white/10 transition-colors" aria-label="Select your preferred language">
                        <option value="en" class="bg-gray-900">üá¨üáß English</option>
                        <option value="hi" class="bg-gray-900">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                        <option value="kn" class="bg-gray-900">üáÆüá≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                        <option value="ta" class="bg-gray-900">üáÆüá≥ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                        <option value="te" class="bg-gray-900">üáÆüá≥ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                        <option value="ml" class="bg-gray-900">üáÆüá≥ ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                    </select>
                </div>
                
                <!-- CTA Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 w-full max-w-sm animate-slide-up stagger-4" style="opacity:0">
                    <button onclick="showPage('page-commuter')" class="btn-press flex-1 bg-gradient-gold text-black font-bold py-4 px-8 rounded-2xl shadow-lg shadow-yellow-500/30 hover:shadow-yellow-500/50 transition-shadow">
                        <span data-i18n="commuter_login">Commuter Login</span>
                    </button>
                    <button onclick="showPage('page-staff-login')" class="btn-press flex-1 glass hover:bg-white/10 font-bold py-4 px-8 rounded-2xl transition-colors">
                        <span data-i18n="staff_portal">Staff Portal</span>
                    </button>
                </div>
                
                <!-- Accessibility Features Preview -->
                <div class="mt-12 grid grid-cols-4 gap-3 max-w-lg animate-slide-up stagger-5" style="opacity:0">
                    <div class="glass-gold rounded-2xl p-4 text-center">
                        <div class="text-2xl mb-2">üéß</div>
                        <p class="text-xs text-gray-300" data-i18n="feature_voice">Voice Guide</p>
                    </div>
                    <div class="glass-gold rounded-2xl p-4 text-center">
                        <div class="text-2xl mb-2">üé§</div>
                        <p class="text-xs text-gray-300">AI Assistant</p>
                    </div>
                    <div class="glass-gold rounded-2xl p-4 text-center">
                        <div class="text-2xl mb-2">‚ôø</div>
                        <p class="text-xs text-gray-300" data-i18n="feature_assist">Assistance</p>
                    </div>
                    <div class="glass-gold rounded-2xl p-4 text-center">
                        <div class="text-2xl mb-2">üó∫Ô∏è</div>
                        <p class="text-xs text-gray-300" data-i18n="feature_routes">Routes</p>
                    </div>
                </div>
            </div>
            
            <!-- Settings Bar -->
            <div class="p-4 flex justify-center gap-4">
                <button onclick="toggleLargeText()" class="glass rounded-full px-4 py-2 text-sm flex items-center gap-2 hover:bg-white/10 transition-colors" aria-label="Toggle large text">
                    <span class="text-lg">Aa</span>
                    <span data-i18n="large_text">Large Text</span>
                </button>
                <button onclick="toggleReduceMotion()" class="glass rounded-full px-4 py-2 text-sm flex items-center gap-2 hover:bg-white/10 transition-colors" aria-label="Toggle reduced motion">
                    <span class="text-lg">‚ö°</span>
                    <span data-i18n="reduce_motion">Reduce Motion</span>
                </button>
            </div>
        </div>
        
        <!-- Commuter Dashboard -->
        <div id="page-commuter" class="page hidden min-h-screen pb-24">
            <main id="main-content" tabindex="-1">
                <!-- Header -->
                <header class="glass sticky top-0 z-30 px-4 py-4">
                    <div class="flex items-center justify-between max-w-4xl mx-auto">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-gold flex items-center justify-center">
                                <svg class="w-6 h-6 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                                </svg>
                            </div>
                            <div>
                                <h1 class="font-bold text-lg">AccessiGo</h1>
                                <p class="text-xs text-gray-400" data-i18n="welcome_back">Welcome back!</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="toggleVoiceAssistant()" class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center hover:scale-110 transition-transform shadow-lg" aria-label="Voice Assistant">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                                </svg>
                            </button>
                            <button onclick="openFullMap()" class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="Open map">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                                </svg>
                            </button>
                            <button onclick="showNotificationHistory()" class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="View notification history">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                                </svg>
                            </button>
                            <button onclick="showPage('page-landing')" class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="Back to home">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </header>
                
                <div class="px-4 py-6 max-w-4xl mx-auto space-y-6">
                    <!-- Quick Actions Grid -->
                    <section aria-labelledby="quick-actions-title">
                        <h2 id="quick-actions-title" class="sr-only">Quick Actions</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="showPage('page-trip-planner')" class="btn-press glass-gold rounded-3xl p-6 text-left hover:scale-[1.02] transition-transform">
                                <div class="w-12 h-12 rounded-2xl bg-gradient-gold flex items-center justify-center mb-4">
                                    <svg class="w-6 h-6 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                                    </svg>
                                </div>
                                <h3 class="font-bold text-lg mb-1" data-i18n="plan_trip">Plan Trip</h3>
                                <p class="text-sm text-gray-400" data-i18n="plan_trip_desc">Find your route</p>
                            </button>
                            
                            <button onclick="showPage('page-stations')" class="btn-press glass rounded-3xl p-6 text-left hover:scale-[1.02] transition-transform">
                                <div class="w-12 h-12 rounded-2xl bg-white/10 flex items-center justify-center mb-4">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </div>
                                <h3 class="font-bold text-lg mb-1" data-i18n="stations">Stations</h3>
                                <p class="text-sm text-gray-400" data-i18n="stations_desc">Browse all stops</p>
                            </button>
                            
                            <button onclick="showAssistanceSheet()" class="btn-press glass rounded-3xl p-6 text-left hover:scale-[1.02] transition-transform">
                                <div class="w-12 h-12 rounded-2xl bg-white/10 flex items-center justify-center mb-4">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/>
                                    </svg>
                                </div>
                                <h3 class="font-bold text-lg mb-1" data-i18n="request_help">Request Help</h3>
                                <p class="text-sm text-gray-400" data-i18n="request_help_desc">Staff assistance</p>
                            </button>
                            
                            <button onclick="startVoiceGuidance()" class="btn-press glass rounded-3xl p-6 text-left hover:scale-[1.02] transition-transform">
                                <div class="w-12 h-12 rounded-2xl bg-white/10 flex items-center justify-center mb-4">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                                    </svg>
                                </div>
                                <h3 class="font-bold text-lg mb-1" data-i18n="voice_guide">Voice Guide</h3>
                                <p class="text-sm text-gray-400" data-i18n="voice_guide_desc">Audio navigation</p>
                            </button>
                        </div>
                    </section>
                    
                    <!-- Live Crowd Status -->
                    <section aria-labelledby="crowd-title">
                        <div class="flex items-center justify-between mb-4">
                            <h2 id="crowd-title" class="font-bold text-xl" data-i18n="live_crowd">Live Crowd Status</h2>
                            <span class="text-xs text-gray-400 flex items-center gap-1">
                                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                <span data-i18n="live">Live</span>
                            </span>
                        </div>
                        <div class="glass rounded-3xl p-4 space-y-3" id="crowd-list">
                            <!-- Populated by JS -->
                        </div>
                    </section>
                    
                    <!-- Metro Lines Overview -->
                    <section aria-labelledby="lines-title">
                        <h2 id="lines-title" class="font-bold text-xl mb-4" data-i18n="metro_lines">Metro Lines</h2>
                        <div class="space-y-3">
                            <button onclick="filterStations('purple')" class="w-full btn-press glass rounded-2xl p-4 flex items-center gap-4 hover:bg-white/5 transition-colors text-left">
                                <div class="w-4 h-12 rounded-full line-purple"></div>
                                <div class="flex-1">
                                    <h3 class="font-bold" data-i18n="purple_line">Purple Line</h3>
                                    <p class="text-sm text-gray-400">Whitefield ‚Üî Challaghatta</p>
                                </div>
                                <span class="text-sm text-gray-400">7 <span data-i18n="stations_count">stations</span></span>
                            </button>
                            
                            <button onclick="filterStations('green')" class="w-full btn-press glass rounded-2xl p-4 flex items-center gap-4 hover:bg-white/5 transition-colors text-left">
                                <div class="w-4 h-12 rounded-full line-green"></div>
                                <div class="flex-1">
                                    <h3 class="font-bold" data-i18n="green_line">Green Line</h3>
                                    <p class="text-sm text-gray-400">Nagasandra ‚Üî Silk Institute</p>
                                </div>
                                <span class="text-sm text-gray-400">7 <span data-i18n="stations_count">stations</span></span>
                            </button>
                            
                            <button onclick="filterStations('yellow')" class="w-full btn-press glass rounded-2xl p-4 flex items-center gap-4 hover:bg-white/5 transition-colors text-left">
                                <div class="w-4 h-12 rounded-full line-yellow"></div>
                                <div class="flex-1">
                                    <h3 class="font-bold" data-i18n="yellow_line">Yellow Line</h3>
                                    <p class="text-sm text-gray-400">RV Road ‚Üî Bommasandra</p>
                                </div>
                                <span class="text-sm text-gray-400">7 <span data-i18n="stations_count">stations</span></span>
                            </button>
                        </div>
                    </section>
                </div>
            </main>
            
            <!-- Bottom Navigation -->
            <nav class="fixed bottom-0 left-0 right-0 glass border-t border-white/10 px-4 py-3 z-30" aria-label="Main navigation">
                <div class="flex justify-around max-w-md mx-auto">
                    <button onclick="showPage('page-commuter')" class="flex flex-col items-center gap-1 text-yellow-400" aria-current="page">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span class="text-xs" data-i18n="nav_home">Home</span>
                    </button>
                    <button onclick="showPage('page-trip-planner')" class="flex flex-col items-center gap-1 text-gray-400 hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                        </svg>
                        <span class="text-xs" data-i18n="nav_trip">Trip</span>
                    </button>
                    <button onclick="showPage('page-stations')" class="flex flex-col items-center gap-1 text-gray-400 hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                        </svg>
                        <span class="text-xs" data-i18n="nav_stations">Stations</span>
                    </button>
                    <button onclick="showPage('page-settings')" class="flex flex-col items-center gap-1 text-gray-400 hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span class="text-xs" data-i18n="nav_settings">Settings</span>
                    </button>
                </div>
            </nav>
        </div>
        
        <!-- Stations List Page -->
        <div id="page-stations" class="page hidden min-h-screen pb-24">
            <header class="glass sticky top-0 z-30 px-4 py-4">
                <div class="flex items-center gap-4 max-w-4xl mx-auto">
                    <button onclick="showPage('page-commuter')" class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="Go back">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div class="flex-1">
                        <h1 class="font-bold text-xl" data-i18n="all_stations">All Stations</h1>
                        <p class="text-sm text-gray-400" id="station-filter-label">All Lines</p>
                    </div>
                </div>
            </header>
            
            <div class="px-4 py-6 max-w-4xl mx-auto">
                <!-- Search -->
                <div class="mb-6">
                    <label for="station-search" class="sr-only">Search stations</label>
                    <div class="relative">
                        <svg class="w-5 h-5 absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input type="search" id="station-search" placeholder="Search stations..." class="w-full glass rounded-2xl pl-12 pr-4 py-3 bg-transparent placeholder-gray-400 focus:outline-none" oninput="filterStationsBySearch(this.value)">
                    </div>
                </div>
                
                <!-- Line Filter Tabs -->
                <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                    <button onclick="filterStations('all')" class="filter-tab active whitespace-nowrap px-4 py-2 rounded-full text-sm font-medium glass" data-filter="all" data-i18n="all_lines">All Lines</button>
                    <button onclick="filterStations('purple')" class="filter-tab whitespace-nowrap px-4 py-2 rounded-full text-sm font-medium glass" data-filter="purple" data-i18n="purple_line">Purple Line</button>
                    <button onclick="filterStations('green')" class="filter-tab whitespace-nowrap px-4 py-2 rounded-full text-sm font-medium glass" data-filter="green" data-i18n="green_line">Green Line</button>
                    <button onclick="filterStations('yellow')" class="filter-tab whitespace-nowrap px-4 py-2 rounded-full text-sm font-medium glass" data-filter="yellow" data-i18n="yellow_line">Yellow Line</button>
                </div>
                
                <!-- Station List -->
                <div id="stations-list" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
        
        <!-- Station Detail Page -->
        <div id="page-station-detail" class="page hidden min-h-screen pb-24">
            <header class="glass sticky top-0 z-30 px-4 py-4">
                <div class="flex items-center gap-4 max-w-4xl mx-auto">
                    <button onclick="showPage('page-stations')" class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="Go back">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div class="flex-1">
                        <h1 id="station-detail-name" class="font-bold text-xl">Station Name</h1>
                        <p id="station-detail-line" class="text-sm text-gray-400">Line</p>
                    </div>
                </div>
            </header>
            
            <div class="px-4 py-6 max-w-4xl mx-auto space-y-6">
                <!-- Station Hero Card -->
                <div id="station-hero" class="glass-gold rounded-3xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h2 id="station-hero-name" class="text-2xl font-bold">Station</h2>
                            <p id="station-hero-alias" class="text-sm text-yellow-300"></p>
                        </div>
                        <div id="station-crowd-badge" class="crowd-low px-3 py-1 rounded-full text-xs font-bold text-white">
                            LOW
                        </div>
                    </div>
                    <div id="station-line-badge" class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium line-purple text-white">
                        <span class="w-2 h-2 rounded-full bg-white"></span>
                        <span>Purple Line</span>
                    </div>
                </div>
                
                <!-- Facilities -->
                <section aria-labelledby="facilities-title">
                    <h2 id="facilities-title" class="font-bold text-lg mb-3" data-i18n="facilities">Facilities</h2>
                    <div id="facilities-grid" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <!-- Populated by JS -->
                    </div>
                </section>
                
                <!-- Interactive Map -->
                <section aria-labelledby="map-title">
                    <div class="flex items-center justify-between mb-3">
                        <h2 id="map-title" class="font-bold text-lg" data-i18n="station_map">Station Map</h2>
                        <button onclick="openStationMap()" class="text-sm text-yellow-400 flex items-center gap-1">
                            <span data-i18n="expand_map">Expand</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                            </svg>
                        </button>
                    </div>
                    <div id="station-map-container" class="glass rounded-3xl h-64 overflow-hidden relative">
                        <div id="station-map" class="w-full h-full"></div>
                    </div>
                    
                    <!-- Nearby Bus Stops -->
                    <div class="mt-4 glass rounded-2xl p-4">
                        <p class="text-sm font-medium text-gray-300 mb-3" data-i18n="nearby_bus_stops">Nearby Bus Stops</p>
                        <div id="bus-stops-list" class="space-y-2 text-sm">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </section>
                
                <!-- Accessibility Notes -->
                <section aria-labelledby="access-notes-title">
                    <h2 id="access-notes-title" class="font-bold text-lg mb-3" data-i18n="accessibility_info">Accessibility Info</h2>
                    <div id="accessibility-notes" class="glass rounded-2xl p-4 space-y-3">
                        <!-- Populated by JS -->
                    </div>
                </section>
                
                <!-- Actions -->
                <div class="flex gap-3">
                    <button onclick="planTripFromStation()" class="btn-press flex-1 bg-gradient-gold text-black font-bold py-4 rounded-2xl">
                        <span data-i18n="start_from_here">Start Trip From Here</span>
                    </button>
                    <button onclick="requestHelpAtStation()" class="btn-press glass px-6 py-4 rounded-2xl hover:bg-white/10 transition-colors" aria-label="Request assistance">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Trip Planner Page -->
        <div id="page-trip-planner" class="page hidden min-h-screen pb-24">
            <header class="glass sticky top-0 z-30 px-4 py-4">
                <div class="flex items-center gap-4 max-w-4xl mx-auto">
                    <button onclick="showPage('page-commuter')" class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="Go back">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="font-bold text-xl" data-i18n="trip_planner">Trip Planner</h1>
                </div>
            </header>
            
            <div class="px-4 py-6 max-w-4xl mx-auto space-y-6">
                <!-- From/To Selection -->
                <div class="glass-gold rounded-3xl p-6 space-y-4">
                    <div class="relative">
                        <label for="trip-from" class="block text-sm font-medium text-yellow-300 mb-2" data-i18n="from_station">From Station</label>
                        <select id="trip-from" class="w-full glass rounded-xl px-4 py-3 bg-transparent font-medium cursor-pointer">
                            <option value="" class="bg-gray-900" data-i18n="select_station">Select station...</option>
                        </select>
                    </div>
                    
                    <button onclick="swapStations()" class="mx-auto w-10 h-10 rounded-full bg-yellow-400/20 flex items-center justify-center hover:bg-yellow-400/30 transition-colors" aria-label="Swap stations">
                        <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                        </svg>
                    </button>
                    
                    <div class="relative">
                        <label for="trip-to" class="block text-sm font-medium text-yellow-300 mb-2" data-i18n="to_station">To Station</label>
                        <select id="trip-to" class="w-full glass rounded-xl px-4 py-3 bg-transparent font-medium cursor-pointer">
                            <option value="" class="bg-gray-900" data-i18n="select_station">Select station...</option>
                        </select>
                    </div>
                    
                    <button onclick="planTrip()" class="btn-press w-full bg-gradient-gold text-black font-bold py-4 rounded-2xl shadow-lg shadow-yellow-500/30">
                        <span data-i18n="find_route">Find Route</span>
                    </button>
                </div>
                
                <!-- Route Display -->
                <div id="route-display" class="hidden">
                    <h2 class="font-bold text-lg mb-4" data-i18n="your_route">Your Route</h2>
                    
                    <!-- Route Summary -->
                    <div class="glass rounded-2xl p-4 mb-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400" data-i18n="total_stations">Total Stations</p>
                                <p id="route-station-count" class="text-2xl font-bold">0</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-400" data-i18n="est_time">Est. Time</p>
                                <p id="route-time" class="text-2xl font-bold">0 min</p>
                            </div>
                            <div id="route-interchange" class="hidden">
                                <p class="text-sm text-gray-400" data-i18n="interchange">Interchange</p>
                                <p class="text-lg font-bold text-yellow-400">Majestic</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Visual Route -->
                    <div id="route-visual" class="glass rounded-3xl p-6 relative overflow-hidden">
                        <!-- Route stops rendered here -->
                    </div>
                    
                    <!-- Voice Guide Button -->
                    <button onclick="readRouteAloud()" class="btn-press w-full mt-4 glass-gold rounded-2xl py-4 font-bold flex items-center justify-center gap-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                        </svg>
                        <span data-i18n="read_steps">Read Steps Aloud</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Staff Login Page -->
        <div id="page-staff-login" class="page hidden min-h-screen flex flex-col">
            <header class="glass px-4 py-4">
                <div class="flex items-center gap-4 max-w-4xl mx-auto">
                    <button onclick="showPage('page-landing')" class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="Go back">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="font-bold text-xl" data-i18n="staff_login">Staff Login</h1>
                </div>
            </header>
            
            <div class="flex-1 flex items-center justify-center p-6">
                <div class="w-full max-w-sm space-y-6">
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 rounded-2xl bg-gradient-gold mx-auto mb-4 flex items-center justify-center">
                            <svg class="w-10 h-10 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-bold" data-i18n="staff_portal">Staff Portal</h2>
                        <p class="text-gray-400 mt-2" data-i18n="staff_login_desc">Enter your staff credentials</p>
                    </div>
                    
                    <form onsubmit="staffLogin(event)" class="space-y-4">
                        <div>
                            <label for="staff-email" class="block text-sm font-medium mb-2">Email</label>
                            <input type="email" id="staff-email" required class="w-full glass rounded-xl px-4 py-3 bg-transparent focus:outline-none" placeholder="staff@nammametro.gov.in">
                        </div>
                        <div>
                            <label for="staff-password" class="block text-sm font-medium mb-2">Password</label>
                            <input type="password" id="staff-password" required class="w-full glass rounded-xl px-4 py-3 bg-transparent focus:outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <button type="submit" class="btn-press w-full bg-gradient-gold text-black font-bold py-4 rounded-2xl shadow-lg shadow-yellow-500/30">
                            <span data-i18n="login">Login</span>
                        </button>
                    </form>
                    
                    <p class="text-center text-sm text-gray-400">
                        Demo: Use any email with password "staff123"
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Staff Dashboard -->
        <div id="page-staff-dashboard" class="page hidden min-h-screen bg-gray-950">
            <header class="bg-gray-900/90 backdrop-blur-xl border-b border-gray-800 px-4 py-4 sticky top-0 z-30">
                <div class="flex items-center justify-between max-w-6xl mx-auto">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-gold flex items-center justify-center">
                            <svg class="w-6 h-6 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="font-bold">Staff Command Center</h1>
                            <p class="text-xs text-gray-400">Namma Metro Operations</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div id="staff-alert-badge" class="hidden px-3 py-1 rounded-full bg-red-500 text-white text-sm font-bold urgent-badge">
                            üö® NEW SOS
                        </div>
                        <button onclick="staffLogout()" class="px-4 py-2 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors text-sm font-medium">
                            Logout
                        </button>
                    </div>
                </div>
            </header>
            
            <div class="px-4 py-6 max-w-6xl mx-auto">
                <!-- Stats Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gray-900 rounded-2xl p-4 border border-gray-800">
                        <p class="text-sm text-gray-400">Pending Requests</p>
                        <p id="stat-pending-requests" class="text-3xl font-bold text-yellow-400">0</p>
                    </div>
                    <div class="bg-gray-900 rounded-2xl p-4 border border-gray-800">
                        <p class="text-sm text-gray-400">In Progress</p>
                        <p id="stat-processing" class="text-3xl font-bold text-blue-400">0</p>
                    </div>
                    <div class="bg-gray-900 rounded-2xl p-4 border border-gray-800">
                        <p class="text-sm text-gray-400">Completed Today</p>
                        <p id="stat-completed" class="text-3xl font-bold text-green-400">0</p>
                    </div>
                    <div class="bg-gray-900 rounded-2xl p-4 border border-gray-800">
                        <p class="text-sm text-gray-400">SOS Alerts</p>
                        <p id="stat-sos" class="text-3xl font-bold text-red-400">0</p>
                    </div>
                </div>
                
                <!-- SOS Alerts Section -->
                <section id="sos-section" class="hidden mb-6">
                    <h2 class="font-bold text-lg mb-4 flex items-center gap-2 text-red-400">
                        <span class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></span>
                        üö® Emergency SOS Alerts
                    </h2>
                    <div id="sos-requests-list" class="space-y-3">
                        <!-- Populated by JS -->
                    </div>
                </section>
                
                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- All Assistance Requests -->
                    <section>
                        <h2 class="font-bold text-lg mb-4 flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></span>
                            All Assistance Requests
                        </h2>
                        <div id="staff-requests-list" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2">
                            <!-- Populated by JS -->
                        </div>
                    </section>
                    
                    <!-- Crowd Control -->
                    <section>
                        <h2 class="font-bold text-lg mb-4">Crowd Level Control</h2>
                        <div id="crowd-control-list" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2">
                            <!-- Populated by JS -->
                        </div>
                    </section>
                </div>
            </div>
        </div>
        
        <!-- Settings Page -->
        <div id="page-settings" class="page hidden min-h-screen pb-24">
            <header class="glass sticky top-0 z-30 px-4 py-4">
                <div class="flex items-center gap-4 max-w-4xl mx-auto">
                    <button onclick="showPage('page-commuter')" class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="Go back">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h1 class="font-bold text-xl" data-i18n="settings">Settings</h1>
                </div>
            </header>
            
            <div class="px-4 py-6 max-w-4xl mx-auto space-y-6">
                <!-- Language -->
                <section class="glass rounded-2xl p-4">
                    <h2 class="font-bold mb-4" data-i18n="language">Language</h2>
                    <select id="settings-language" onchange="changeLanguage(this.value)" class="w-full glass rounded-xl px-4 py-3 bg-transparent cursor-pointer">
                        <option value="en" class="bg-gray-900">üá¨üáß English</option>
                        <option value="hi" class="bg-gray-900">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                        <option value="kn" class="bg-gray-900">üáÆüá≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                        <option value="ta" class="bg-gray-900">üáÆüá≥ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                        <option value="te" class="bg-gray-900">üáÆüá≥ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                        <option value="ml" class="bg-gray-900">üáÆüá≥ ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                    </select>
                </section>
                
                <!-- Accessibility -->
                <section class="glass rounded-2xl p-4 space-y-4">
                    <h2 class="font-bold" data-i18n="accessibility">Accessibility</h2>
                    
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium" data-i18n="large_text">Large Text</p>
                            <p class="text-sm text-gray-400" data-i18n="large_text_desc">Increase text size</p>
                        </div>
                        <button id="toggle-large-text" onclick="toggleLargeText()" class="w-14 h-8 rounded-full bg-gray-700 relative transition-colors" role="switch" aria-checked="false">
                            <span class="absolute left-1 top-1 w-6 h-6 rounded-full bg-white transition-transform"></span>
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium" data-i18n="reduce_motion">Reduce Motion</p>
                            <p class="text-sm text-gray-400" data-i18n="reduce_motion_desc">Minimize animations</p>
                        </div>
                        <button id="toggle-reduce-motion" onclick="toggleReduceMotion()" class="w-14 h-8 rounded-full bg-gray-700 relative transition-colors" role="switch" aria-checked="false">
                            <span class="absolute left-1 top-1 w-6 h-6 rounded-full bg-white transition-transform"></span>
                        </button>
                    </div>
                </section>
                
                <!-- Voice Status -->
                <section class="glass rounded-2xl p-4">
                    <h2 class="font-bold mb-4">üîä Voice Status</h2>
                    <div id="voice-status-info" class="space-y-2 text-sm">
                        <!-- Populated by JS -->
                    </div>
                    <button onclick="testVoice()" class="btn-press mt-3 w-full glass-gold rounded-xl py-3 font-medium flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                        </svg>
                        Test Voice
                    </button>
                </section>
                
                <!-- About -->
                <section class="glass rounded-2xl p-4">
                    <h2 class="font-bold mb-4" data-i18n="about">About</h2>
                    <div class="space-y-2 text-sm text-gray-400">
                        <p class="text-yellow-400 font-bold">AccessiGo v2.1.0</p>
                        <p>Bengaluru Namma Metro Accessibility Companion</p>
                        <p>‚ú® Features:</p>
                        <ul class="list-disc list-inside ml-2 space-y-1">
                            <li>Purple, Green & Yellow Metro Lines</li>
                            <li>üé§ Multi-language Voice Assistant (6 languages)</li>
                            <li>üîä Google TTS for all Indian languages</li>
                            <li>üó∫Ô∏è Interactive Maps with GPS</li>
                            <li>üö® SOS Emergency System</li>
                            <li>‚ôø Staff Assistance Requests</li>
                            <li>üì≤ Installable PWA</li>
                            <li>üì≥ Haptic Feedback</li>
                        </ul>
                        <p class="pt-2">Built with ‚ù§Ô∏è for accessibility</p>
                        <div id="pwa-status" class="pt-2 text-xs"></div>
                    </div>
                    
                    <!-- Install Button in Settings -->
                    <button id="settings-install-btn" onclick="installPWA()" class="hidden btn-press w-full mt-4 glass-gold rounded-xl py-3 font-bold flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                        <span data-i18n="install_app">Install App</span>
                    </button>
                </section>
            </div>
        </div>
    </div>
    
    <!-- Full Map Modal -->
    <div id="map-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 map-modal" onclick="closeFullMap()"></div>
        <div class="absolute inset-4 md:inset-8 glass rounded-3xl overflow-hidden flex flex-col">
            <div class="flex items-center justify-between p-4 border-b border-white/10">
                <div>
                    <h2 class="font-bold text-lg" data-i18n="metro_map">Metro Map</h2>
                    <p class="text-sm text-gray-400" data-i18n="click_location">Click anywhere to get location</p>
                </div>
                <button onclick="closeFullMap()" class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="Close map">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div id="full-map" class="flex-1"></div>
            
            <!-- Location Info Panel -->
            <div id="location-info" class="hidden p-4 border-t border-white/10 bg-gray-900/80">
                <div class="flex items-start justify-between">
                    <div>
                        <p class="text-sm text-gray-400">Selected Location</p>
                        <p id="location-coords" class="font-bold text-yellow-400">12.9716¬∞ N, 77.5946¬∞ E</p>
                        <p id="location-address" class="text-sm text-gray-300 mt-1">Loading address...</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="findNearestStation()" class="btn-press px-4 py-2 bg-gradient-gold text-black rounded-xl text-sm font-medium">
                            Nearest Station
                        </button>
                        <button onclick="getMyLocation()" class="btn-press px-4 py-2 glass rounded-xl text-sm font-medium">
                            üìç My Location
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Sheet for Assistance -->
    <div id="assistance-sheet" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="hideAssistanceSheet()"></div>
        <div class="bottom-sheet absolute bottom-0 left-0 right-0 glass rounded-t-3xl p-6 max-h-[80vh] overflow-y-auto">
            <div class="w-12 h-1 rounded-full bg-gray-600 mx-auto mb-6"></div>
            
            <h2 class="text-xl font-bold mb-6" data-i18n="request_assistance">Request Assistance</h2>
            
            <form id="assistance-form" onsubmit="submitAssistanceRequest(event)" class="space-y-4">
                <div>
                    <label for="assist-station" class="block text-sm font-medium mb-2" data-i18n="select_station">Select Station</label>
                    <select id="assist-station" required class="w-full glass rounded-xl px-4 py-3 bg-transparent cursor-pointer">
                        <!-- Populated by JS -->
                    </select>
                </div>
                
                <div>
                    <label for="assist-type" class="block text-sm font-medium mb-2" data-i18n="assistance_type">Assistance Type</label>
                    <select id="assist-type" required class="w-full glass rounded-xl px-4 py-3 bg-transparent cursor-pointer">
                        <option value="wheelchair" class="bg-gray-900" data-i18n="wheelchair_assist">Wheelchair Assistance</option>
                        <option value="visual" class="bg-gray-900" data-i18n="visual_assist">Visual Impairment Guide</option>
                        <option value="hearing" class="bg-gray-900" data-i18n="hearing_assist">Hearing Impairment Support</option>
                        <option value="elderly" class="bg-gray-900" data-i18n="elderly_assist">Elderly Assistance</option>
                        <option value="other" class="bg-gray-900" data-i18n="other_assist">Other</option>
                    </select>
                </div>
                
                <div>
                    <label for="assist-notes" class="block text-sm font-medium mb-2" data-i18n="additional_notes">Additional Notes (Optional)</label>
                    <textarea id="assist-notes" rows="3" class="w-full glass rounded-xl px-4 py-3 bg-transparent resize-none" placeholder="Any specific requirements..."></textarea>
                </div>
                
                <button type="submit" class="btn-press w-full bg-gradient-gold text-black font-bold py-4 rounded-2xl">
                    <span data-i18n="submit_request">Submit Request</span>
                </button>
            </form>
        </div>
    </div>
    
    <!-- Notification History Sheet -->
    <div id="notification-sheet" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="hideNotificationHistory()"></div>
        <div class="bottom-sheet absolute bottom-0 left-0 right-0 glass rounded-t-3xl p-6 max-h-[80vh] overflow-y-auto">
            <div class="w-12 h-1 rounded-full bg-gray-600 mx-auto mb-6"></div>
            <h2 class="text-xl font-bold mb-4" data-i18n="notifications">Notifications</h2>
            <div id="notification-list" class="space-y-3">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>
    
    <!-- Bus Stop Info Sheet -->
    <div id="bus-stop-sheet" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeBusStopSheet()"></div>
        <div class="bottom-sheet absolute bottom-0 left-0 right-0 glass rounded-t-3xl p-6">
            <div class="w-12 h-1 rounded-full bg-gray-600 mx-auto mb-6"></div>
            <div class="flex items-start gap-4">
                <div class="w-12 h-12 rounded-xl bg-blue-500 flex items-center justify-center">
                    <span class="text-2xl">üöå</span>
                </div>
                <div class="flex-1">
                    <h3 id="bus-stop-name" class="font-bold text-lg">Bus Stop Name</h3>
                    <p id="bus-stop-distance" class="text-sm text-gray-400">Distance from station</p>
                    <div id="bus-stop-routes" class="mt-3 flex flex-wrap gap-2">
                        <!-- Bus routes populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SOS Floating Button -->
    <button id="sos-button" onclick="triggerSOS()" class="fixed bottom-28 right-4 z-40 w-16 h-16 rounded-full bg-gradient-to-br from-red-500 to-red-700 shadow-2xl shadow-red-500/50 flex items-center justify-center btn-press hover:scale-110 transition-transform hidden" aria-label="Emergency SOS">
        <div class="text-center">
            <span class="text-white font-black text-lg">SOS</span>
        </div>
        <div class="absolute inset-0 rounded-full border-4 border-red-400/50 animate-ping"></div>
    </button>
    
    <!-- SOS Confirmation Modal -->
    <div id="sos-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-md"></div>
        <div class="absolute inset-0 flex items-center justify-center p-6">
            <div class="glass-gold rounded-3xl p-8 max-w-sm w-full text-center animate-scale-in">
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-red-500 to-red-700 mx-auto mb-6 flex items-center justify-center">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-red-400 mb-2">Emergency SOS</h2>
                <p class="text-gray-300 mb-6">This will immediately alert all nearby metro staff. Use only in emergencies.</p>
                
                <div class="space-y-3">
                    <div>
                        <label for="sos-station" class="block text-sm font-medium text-left mb-2">Your Station</label>
                        <select id="sos-station" class="w-full glass rounded-xl px-4 py-3 bg-transparent cursor-pointer">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div>
                        <label for="sos-type" class="block text-sm font-medium text-left mb-2">Emergency Type</label>
                        <select id="sos-type" class="w-full glass rounded-xl px-4 py-3 bg-transparent cursor-pointer">
                            <option value="medical" class="bg-gray-900">üöë Medical Emergency</option>
                            <option value="safety" class="bg-gray-900">üö® Safety Concern</option>
                            <option value="lost" class="bg-gray-900">üë§ Lost / Disoriented</option>
                            <option value="accessibility" class="bg-gray-900">‚ôø Accessibility Help</option>
                            <option value="other" class="bg-gray-900">‚ùó Other Emergency</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex gap-3 mt-6">
                    <button onclick="cancelSOS()" class="flex-1 py-4 rounded-2xl glass font-bold hover:bg-white/10 transition-colors">
                        Cancel
                    </button>
                    <button onclick="confirmSOS()" class="flex-1 py-4 rounded-2xl bg-gradient-to-r from-red-500 to-red-700 text-white font-bold btn-press">
                        Send SOS
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Voice Assistant Button -->
    <button id="voice-assistant-btn" onclick="toggleVoiceAssistant()" class="fixed bottom-28 left-4 z-40 w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 shadow-2xl shadow-purple-500/50 flex items-center justify-center btn-press hover:scale-110 transition-transform hidden" aria-label="Voice Assistant">
        <svg id="voice-icon-mic" class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
        </svg>
        <div id="voice-listening-indicator" class="absolute inset-0 rounded-full border-4 border-purple-400/50 hidden"></div>
    </button>
    
    <!-- Voice Assistant Modal -->
    <div id="voice-assistant-modal" class="fixed inset-0 z-[70] hidden">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl"></div>
        <div class="absolute inset-0 flex flex-col items-center justify-center p-6">
            <!-- Close Button -->
            <button onclick="closeVoiceAssistant()" class="absolute top-6 right-6 w-12 h-12 rounded-full glass flex items-center justify-center hover:bg-white/10 transition-colors" aria-label="Close voice assistant">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            
            <!-- Voice Orb Animation -->
            <div id="voice-orb" class="relative mb-8">
                <div class="w-32 h-32 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-2xl shadow-purple-500/50">
                    <svg id="orb-mic-icon" class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                    </svg>
                </div>
                <!-- Pulse rings for listening state -->
                <div id="pulse-ring-1" class="absolute inset-0 rounded-full border-4 border-purple-400/30 hidden" style="animation: voicePulse 2s ease-out infinite;"></div>
                <div id="pulse-ring-2" class="absolute inset-0 rounded-full border-4 border-purple-400/20 hidden" style="animation: voicePulse 2s ease-out infinite 0.5s;"></div>
                <div id="pulse-ring-3" class="absolute inset-0 rounded-full border-4 border-purple-400/10 hidden" style="animation: voicePulse 2s ease-out infinite 1s;"></div>
            </div>
            
            <!-- Status Text -->
            <div class="text-center mb-8">
                <p id="voice-status" class="text-2xl font-bold text-white mb-2">Tap to speak</p>
                <p id="voice-transcript" class="text-lg text-gray-400 max-w-md"></p>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button onclick="startListening()" id="btn-start-listening" class="btn-press px-8 py-4 rounded-2xl bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold flex items-center gap-3 shadow-lg">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                    </svg>
                    <span>Start Listening</span>
                </button>
                <button onclick="stopListening()" id="btn-stop-listening" class="hidden btn-press px-8 py-4 rounded-2xl bg-red-500 text-white font-bold flex items-center gap-3 shadow-lg">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"/>
                    </svg>
                    <span>Stop</span>
                </button>
            </div>
            
            <!-- Voice Commands Help - Multi-Language -->
            <div class="mt-8 glass rounded-2xl p-6 max-w-lg w-full">
                <h3 class="font-bold text-lg mb-4 text-center">üí° Try saying (in any language):</h3>
                <div id="voice-commands-help" class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                    <!-- Populated by JS based on language -->
                </div>
                <p class="text-center text-xs text-gray-500 mt-4">
                    üåê Supports: English ‚Ä¢ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‚Ä¢ ‡≤ï‡≤®‡≥ç‡≤®‡≤° ‚Ä¢ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç ‚Ä¢ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‚Ä¢ ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç
                </p>
            </div>
        </div>
    </div>
    
    <!-- Active Request Tracker (Commuter View) -->
    <div id="request-tracker" class="fixed bottom-48 left-4 right-4 z-40 hidden">
        <div class="glass-gold rounded-2xl p-4 shadow-2xl">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <div id="tracker-icon" class="w-10 h-10 rounded-full bg-yellow-500 flex items-center justify-center">
                        <span class="text-xl">‚è≥</span>
                    </div>
                    <div>
                        <p id="tracker-status" class="font-bold text-sm">Waiting for staff...</p>
                        <p id="tracker-station" class="text-xs text-gray-400">MG Road Station</p>
                    </div>
                </div>
                <button onclick="cancelActiveRequest()" class="text-gray-400 hover:text-white p-2" aria-label="Cancel request">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="flex gap-1">
                <div id="progress-1" class="flex-1 h-1.5 rounded-full bg-yellow-500"></div>
                <div id="progress-2" class="flex-1 h-1.5 rounded-full bg-gray-600"></div>
                <div id="progress-3" class="flex-1 h-1.5 rounded-full bg-gray-600"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-400 mt-2">
                <span>Submitted</span>
                <span>Accepted</span>
                <span>Completed</span>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // ============================================
        // DATA: Station Information (with Yellow Line)
        // ============================================
        const STATIONS = {
            purple: [
                { id: 'baiyappanahalli', name: 'Baiyappanahalli', lat: 12.9892, lng: 77.6528, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair'], busStops: [{name: 'BMTC Bus Stop - Baiyappanahalli', distance: '50m', routes: ['500A', '500B', '314']}, {name: 'Old Madras Road Bus Stand', distance: '120m', routes: ['500C', '315']}] },
                { id: 'indiranagar', name: 'Indiranagar', lat: 12.9784, lng: 77.6408, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet'], busStops: [{name: 'Indiranagar Metro Bus Bay', distance: '30m', routes: ['500', '314', 'G4']}, {name: 'CMH Road Junction', distance: '200m', routes: ['340', 'V335']}] },
                { id: 'mg-road', name: 'Mahatma Gandhi Road', alias: 'MG Road', lat: 12.9756, lng: 77.6068, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet', 'assistance'], busStops: [{name: 'MG Road Bus Stop', distance: '40m', routes: ['G2', 'G3', '500D']}, {name: 'Trinity Circle', distance: '150m', routes: ['201', '252']}] },
                { id: 'cubbon-park', name: 'Cubbon Park', lat: 12.9763, lng: 77.5929, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair'], busStops: [{name: 'Cubbon Park Metro Stop', distance: '25m', routes: ['G1', '270']}, {name: 'Raj Bhavan Road', distance: '300m', routes: ['271', '276']}] },
                { id: 'kempegowda', name: 'Nadaprabhu Kempegowda Station', alias: 'Majestic', lat: 12.9772, lng: 77.5713, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet', 'assistance', 'interchange'], busStops: [{name: 'Majestic Bus Station', distance: '100m', routes: ['All BMTC Routes']}, {name: 'Kempegowda Bus Terminal', distance: '50m', routes: ['Volvo', 'AC']}] },
                { id: 'majestic', name: 'Majestic', isInterchange: true, lat: 12.9772, lng: 77.5713, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet', 'assistance', 'interchange'], busStops: [{name: 'Majestic Bus Station', distance: '100m', routes: ['All Routes']}] },
                { id: 'vijayanagar', name: 'Vijayanagar', lat: 12.9706, lng: 77.5368, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair'], busStops: [{name: 'Vijayanagar Bus Stop', distance: '60m', routes: ['220', '225']}, {name: 'RPC Layout', distance: '180m', routes: ['229', '232']}] }
            ],
            green: [
                { id: 'nagasandra', name: 'Nagasandra', lat: 13.0389, lng: 77.5096, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair'], busStops: [{name: 'Nagasandra Cross', distance: '40m', routes: ['252', '253']}, {name: 'Tumkur Road', distance: '200m', routes: ['254', '258']}] },
                { id: 'peenya', name: 'Peenya Industry', lat: 13.0279, lng: 77.5197, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet'], busStops: [{name: 'Peenya Industrial Area', distance: '50m', routes: ['250', '251']}, {name: 'Ring Road Junction', distance: '150m', routes: ['G5', 'G6']}] },
                { id: 'yeshwanthpur', name: 'Yeshwanthpur', lat: 13.0206, lng: 77.5389, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet', 'assistance'], busStops: [{name: 'Yeshwanthpur Circle', distance: '80m', routes: ['All North Routes']}, {name: 'Railway Station Road', distance: '120m', routes: ['249', '248']}] },
                { id: 'sampige-road', name: 'Mantri Square Sampige Road', lat: 12.9958, lng: 77.5704, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet'], busStops: [{name: 'Sampige Road', distance: '30m', routes: ['240', '243']}, {name: 'Mantri Mall Bus Bay', distance: '100m', routes: ['G7', '244']}] },
                { id: 'lalbagh', name: 'Lalbagh Botanical Garden', lat: 12.9507, lng: 77.5848, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair'], busStops: [{name: 'Lalbagh Main Gate', distance: '60m', routes: ['201', '210']}, {name: 'Double Road', distance: '200m', routes: ['212', '215']}] },
                { id: 'jayanagar', name: 'Jayanagar', lat: 12.9309, lng: 77.5838, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet', 'assistance'], busStops: [{name: 'Jayanagar 4th Block', distance: '45m', routes: ['J1', 'J2', '210']}, {name: 'Cool Joint', distance: '150m', routes: ['J3', '215']}] },
                { id: 'silk-institute', name: 'Silk Institute', lat: 12.8995, lng: 77.5678, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair'], busStops: [{name: 'Silk Institute Bus Stop', distance: '35m', routes: ['220', '222']}, {name: 'BTM Layout', distance: '250m', routes: ['225', '226']}] }
            ],
            yellow: [
                { id: 'rv-road', name: 'RV Road', lat: 12.9355, lng: 77.5774, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet'], busStops: [{name: 'RV Road Junction', distance: '40m', routes: ['Y1', '210']}, {name: 'Lalbagh West Gate', distance: '300m', routes: ['201', '205']}] },
                { id: 'ragigudda', name: 'Ragigudda', lat: 12.9192, lng: 77.5889, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair'], busStops: [{name: 'Ragigudda Temple', distance: '100m', routes: ['Y2', 'Y3']}, {name: '14th Cross', distance: '180m', routes: ['Y4']}] },
                { id: 'jayadeva', name: 'Jayadeva Hospital', lat: 12.9107, lng: 77.5987, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet', 'assistance'], busStops: [{name: 'Jayadeva Hospital Bus Stop', distance: '20m', routes: ['Y1', 'Y5', '500E']}, {name: 'Dairy Circle', distance: '200m', routes: ['365', '370']}] },
                { id: 'btm-layout', name: 'BTM Layout', lat: 12.9165, lng: 77.6101, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet'], busStops: [{name: 'BTM 1st Stage', distance: '50m', routes: ['500F', '225']}, {name: 'Silk Board Junction', distance: '400m', routes: ['All Routes']}] },
                { id: 'silk-board', name: 'Silk Board Junction', lat: 12.9177, lng: 77.6227, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet', 'assistance'], busStops: [{name: 'Silk Board Bus Terminal', distance: '60m', routes: ['500', '225', '340']}, {name: 'HSR Layout', distance: '300m', routes: ['HSR1', 'HSR2']}] },
                { id: 'hsr-layout', name: 'HSR Layout', lat: 12.9116, lng: 77.6389, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair'], busStops: [{name: 'HSR BDA Complex', distance: '80m', routes: ['HSR1', 'HSR3']}, {name: '27th Main', distance: '150m', routes: ['HSR2']}] },
                { id: 'bommasandra', name: 'Bommasandra', lat: 12.8166, lng: 77.6956, facilities: ['elevator', 'ramp', 'tactile', 'wheelchair', 'toilet'], busStops: [{name: 'Bommasandra Industrial', distance: '100m', routes: ['B1', 'B2']}, {name: 'Electronic City Link', distance: '200m', routes: ['EC1', 'EC2']}] }
            ]
        };

        // ============================================
        // DATA: i18n Translations (Full Multi-Language)
        // ============================================
        const TRANSLATIONS = {
            en: {
                commuter_login: 'Commuter Login',
                staff_portal: 'Staff Portal',
                feature_voice: 'Voice Guidance',
                feature_assist: 'Assistance',
                feature_routes: 'Routes',
                large_text: 'Large Text',
                reduce_motion: 'Reduce Motion',
                welcome_back: 'Welcome back!',
                plan_trip: 'Plan Trip',
                plan_trip_desc: 'Find your route',
                stations: 'Stations',
                stations_desc: 'Browse all stops',
                request_help: 'Request Help',
                request_help_desc: 'Staff assistance',
                voice_guide: 'Voice Guide',
                voice_guide_desc: 'Audio navigation',
                live_crowd: 'Live Crowd Status',
                live: 'Live',
                metro_lines: 'Metro Lines',
                purple_line: 'Purple Line',
                green_line: 'Green Line',
                yellow_line: 'Yellow Line',
                stations_count: 'stations',
                all_stations: 'All Stations',
                all_lines: 'All Lines',
                facilities: 'Facilities',
                station_map: 'Station Map',
                expand_map: 'Expand',
                tap_directions: 'Tap for directions',
                nearby_bus_stops: 'Nearby Bus Stops',
                accessibility_info: 'Accessibility Info',
                start_from_here: 'Start Trip From Here',
                trip_planner: 'Trip Planner',
                from_station: 'From Station',
                to_station: 'To Station',
                select_station: 'Select station...',
                find_route: 'Find Route',
                your_route: 'Your Route',
                total_stations: 'Total Stations',
                est_time: 'Est. Time',
                interchange: 'Interchange',
                read_steps: 'Read Steps Aloud',
                staff_login: 'Staff Login',
                staff_login_desc: 'Enter your staff credentials',
                login: 'Login',
                settings: 'Settings',
                language: 'Language',
                accessibility: 'Accessibility',
                large_text_desc: 'Increase text size',
                reduce_motion_desc: 'Minimize animations',
                about: 'About',
                nav_home: 'Home',
                nav_trip: 'Trip',
                nav_stations: 'Stations',
                nav_settings: 'Settings',
                request_assistance: 'Request Assistance',
                assistance_type: 'Assistance Type',
                wheelchair_assist: 'Wheelchair Assistance',
                visual_assist: 'Visual Impairment Guide',
                hearing_assist: 'Hearing Impairment Support',
                elderly_assist: 'Elderly Assistance',
                other_assist: 'Other',
                additional_notes: 'Additional Notes (Optional)',
                submit_request: 'Submit Request',
                notifications: 'Notifications',
                metro_map: 'Metro Map',
                click_location: 'Click anywhere to get location',
                elevator: 'Elevator',
                ramp: 'Ramp Access',
                tactile: 'Tactile Path',
                wheelchair: 'Wheelchair',
                toilet: 'Toilet',
                assistance: 'Assistance',
                interchange_facility: 'Interchange',
                sos_emergency: 'Emergency SOS',
                sos_desc: 'This will immediately alert all nearby metro staff.',
                send_sos: 'Send SOS',
                help_on_way: 'Help is on the way!',
                request_accepted: 'Staff has accepted your request',
                request_completed: 'Your request has been completed',
                install_app: 'Install App',
                install_prompt: 'Install AccessiGo on your device for quick access'
            },
            hi: {
                commuter_login: '‡§Ø‡§æ‡§§‡•ç‡§∞‡•Ä ‡§≤‡•â‡§ó‡§ø‡§®',
                staff_portal: '‡§∏‡•ç‡§ü‡§æ‡§´ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤',
                feature_voice: '‡§Ü‡§µ‡§æ‡§ú‡§º ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§®',
                feature_assist: '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ',
                feature_routes: '‡§Æ‡§æ‡§∞‡•ç‡§ó',
                large_text: '‡§¨‡§°‡§º‡§æ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü',
                reduce_motion: '‡§ï‡§Æ ‡§ó‡§§‡§ø',
                welcome_back: '‡§µ‡§æ‡§™‡§∏ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!',
                plan_trip: '‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ',
                plan_trip_desc: '‡§Ö‡§™‡§®‡§æ ‡§∞‡§æ‡§∏‡•ç‡§§‡§æ ‡§ñ‡•ã‡§ú‡•á‡§Ç',
                stations: '‡§∏‡•ç‡§ü‡•á‡§∂‡§®',
                stations_desc: '‡§∏‡§≠‡•Ä ‡§∏‡•ç‡§ü‡•â‡§™ ‡§¶‡•á‡§ñ‡•á‡§Ç',
                request_help: '‡§Æ‡§¶‡§¶ ‡§Æ‡§æ‡§Ç‡§ó‡•á‡§Ç',
                request_help_desc: '‡§∏‡•ç‡§ü‡§æ‡§´ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ',
                voice_guide: '‡§µ‡•â‡§Ø‡§∏ ‡§ó‡§æ‡§á‡§°',
                voice_guide_desc: '‡§ë‡§°‡§ø‡§Ø‡•ã ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§®',
                live_crowd: '‡§≤‡§æ‡§á‡§µ ‡§≠‡•Ä‡§°‡§º ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                live: '‡§≤‡§æ‡§á‡§µ',
                metro_lines: '‡§Æ‡•á‡§ü‡•ç‡§∞‡•ã ‡§≤‡§æ‡§á‡§®‡•á‡§Ç',
                purple_line: '‡§¨‡•à‡§Ç‡§ó‡§®‡•Ä ‡§≤‡§æ‡§á‡§®',
                green_line: '‡§π‡§∞‡•Ä ‡§≤‡§æ‡§á‡§®',
                yellow_line: '‡§™‡•Ä‡§≤‡•Ä ‡§≤‡§æ‡§á‡§®',
                stations_count: '‡§∏‡•ç‡§ü‡•á‡§∂‡§®',
                all_stations: '‡§∏‡§≠‡•Ä ‡§∏‡•ç‡§ü‡•á‡§∂‡§®',
                all_lines: '‡§∏‡§≠‡•Ä ‡§≤‡§æ‡§á‡§®‡•á‡§Ç',
                facilities: '‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Ç',
                station_map: '‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞',
                expand_map: '‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç',
                nearby_bus_stops: '‡§®‡§ú‡§º‡§¶‡•Ä‡§ï‡•Ä ‡§¨‡§∏ ‡§∏‡•ç‡§ü‡•â‡§™',
                accessibility_info: '‡§™‡§π‡•Å‡§Ç‡§ö ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä',
                start_from_here: '‡§Ø‡§π‡§æ‡§Ç ‡§∏‡•á ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                trip_planner: '‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§ï‡§æ‡§∞',
                from_station: '‡§ï‡§π‡§æ‡§Ç ‡§∏‡•á',
                to_station: '‡§ï‡§π‡§æ‡§Ç ‡§§‡§ï',
                select_station: '‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§ö‡•Å‡§®‡•á‡§Ç...',
                find_route: '‡§∞‡§æ‡§∏‡•ç‡§§‡§æ ‡§ñ‡•ã‡§ú‡•á‡§Ç',
                your_route: '‡§Ü‡§™‡§ï‡§æ ‡§∞‡§æ‡§∏‡•ç‡§§‡§æ',
                total_stations: '‡§ï‡•Å‡§≤ ‡§∏‡•ç‡§ü‡•á‡§∂‡§®',
                est_time: '‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§∏‡§Æ‡§Ø',
                interchange: '‡§á‡§Ç‡§ü‡§∞‡§ö‡•á‡§Ç‡§ú',
                read_steps: '‡§ï‡§¶‡§Æ ‡§™‡§¢‡§º‡•á‡§Ç',
                settings: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
                language: '‡§≠‡§æ‡§∑‡§æ',
                accessibility: '‡§™‡§π‡•Å‡§Ç‡§ö',
                about: '‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç',
                nav_home: '‡§π‡•ã‡§Æ',
                nav_trip: '‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ',
                nav_stations: '‡§∏‡•ç‡§ü‡•á‡§∂‡§®',
                nav_settings: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
                request_assistance: '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§Æ‡§æ‡§Ç‡§ó‡•á‡§Ç',
                submit_request: '‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§≠‡•á‡§ú‡•á‡§Ç',
                notifications: '‡§∏‡•Ç‡§ö‡§®‡§æ‡§è‡§Ç',
                sos_emergency: '‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® SOS',
                help_on_way: '‡§Æ‡§¶‡§¶ ‡§Ü ‡§∞‡§π‡•Ä ‡§π‡•à!'
            },
            kn: {
                commuter_login: '‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£‡≤ø‡≤ï ‡≤≤‡≤æ‡≤ó‡≤ø‡≤®‡≥ç',
                staff_portal: '‡≤∏‡≤ø‡≤¨‡≥ç‡≤¨‡≤Ç‡≤¶‡≤ø ‡≤™‡≥ã‡≤∞‡≥ç‡≤ü‡≤≤‡≥ç',
                feature_voice: '‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó‡≤¶‡≤∞‡≥ç‡≤∂‡≤®',
                feature_assist: '‡≤∏‡≤π‡≤æ‡≤Ø',
                feature_routes: '‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó‡≤ó‡≤≥‡≥Å',
                large_text: '‡≤¶‡≥ä‡≤°‡≥ç‡≤° ‡≤™‡≤†‡≥ç‡≤Ø',
                reduce_motion: '‡≤ï‡≤°‡≤ø‡≤Æ‡≥Ü ‡≤ö‡≤≤‡≤®‡≥Ü',
                welcome_back: '‡≤Æ‡≤∞‡≤≥‡≤ø ‡≤∏‡≥ç‡≤µ‡≤æ‡≤ó‡≤§!',
                plan_trip: '‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü',
                plan_trip_desc: '‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó ‡≤π‡≥Å‡≤°‡≥Å‡≤ï‡≤ø',
                stations: '‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≥Å',
                stations_desc: '‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤®‡≤ø‡≤≤‡≥Å‡≤ó‡≤°‡≥Ü‡≤ó‡≤≥‡≥Å',
                request_help: '‡≤∏‡≤π‡≤æ‡≤Ø ‡≤ï‡≥á‡≤≥‡≤ø',
                request_help_desc: '‡≤∏‡≤ø‡≤¨‡≥ç‡≤¨‡≤Ç‡≤¶‡≤ø ‡≤∏‡≤π‡≤æ‡≤Ø',
                voice_guide: '‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤ó‡≥à‡≤°‡≥ç',
                voice_guide_desc: '‡≤Ü‡≤°‡≤ø‡≤Ø‡≥ã ‡≤®‡≥ç‡≤Ø‡≤æ‡≤µ‡≤ø‡≤ó‡≥á‡≤∂‡≤®‡≥ç',
                live_crowd: '‡≤≤‡≥à‡≤µ‡≥ç ‡≤ú‡≤®‡≤∏‡≤Ç‡≤¶‡≤£‡≤ø',
                live: '‡≤≤‡≥à‡≤µ‡≥ç',
                metro_lines: '‡≤Æ‡≥Ü‡≤ü‡≥ç‡≤∞‡≥ã ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó‡≤ó‡≤≥‡≥Å',
                purple_line: '‡≤®‡≥á‡≤∞‡≤≥‡≥Ü ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó',
                green_line: '‡≤π‡≤∏‡≤ø‡≤∞‡≥Å ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó',
                yellow_line: '‡≤π‡≤≥‡≤¶‡≤ø ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó',
                stations_count: '‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≥Å',
                all_stations: '‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≥Å',
                all_lines: '‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó‡≤ó‡≤≥‡≥Å',
                facilities: '‡≤∏‡≥å‡≤≤‡≤≠‡≥ç‡≤Ø‡≤ó‡≤≥‡≥Å',
                station_map: '‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£ ‡≤®‡≤ï‡≥ç‡≤∑‡≥Ü',
                nearby_bus_stops: '‡≤π‡≤§‡≥ç‡≤§‡≤ø‡≤∞‡≤¶ ‡≤¨‡≤∏‡≥ç ‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≥Å',
                accessibility_info: '‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂ ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø',
                start_from_here: '‡≤á‡≤≤‡≥ç‡≤≤‡≤ø‡≤Ç‡≤¶ ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø',
                trip_planner: '‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Ø‡≥ã‡≤ú‡≤ï',
                from_station: '‡≤é‡≤≤‡≥ç‡≤≤‡≤ø‡≤Ç‡≤¶',
                to_station: '‡≤é‡≤≤‡≥ç‡≤≤‡≤ø‡≤ó‡≥Ü',
                select_station: '‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£ ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤Æ‡≤æ‡≤°‡≤ø...',
                find_route: '‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó ‡≤π‡≥Å‡≤°‡≥Å‡≤ï‡≤ø',
                your_route: '‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó',
                total_stations: '‡≤í‡≤ü‡≥ç‡≤ü‡≥Å ‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≥Å',
                est_time: '‡≤Ö‡≤Ç‡≤¶‡≤æ‡≤ú‡≥Å ‡≤∏‡≤Æ‡≤Ø',
                interchange: '‡≤¨‡≤¶‡≤≤‡≤æ‡≤µ‡≤£‡≥Ü',
                read_steps: '‡≤π‡≤Ç‡≤§‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤ì‡≤¶‡≤ø',
                settings: '‡≤∏‡≥Ü‡≤ü‡≥ç‡≤ü‡≤ø‡≤Ç‡≤ó‡≥ç‚Äå‡≤ó‡≤≥‡≥Å',
                language: '‡≤≠‡≤æ‡≤∑‡≥Ü',
                about: '‡≤¨‡≤ó‡≥ç‡≤ó‡≥Ü',
                nav_home: '‡≤Æ‡≤®‡≥Ü',
                nav_trip: '‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£',
                nav_stations: '‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≥Å',
                nav_settings: '‡≤∏‡≥Ü‡≤ü‡≥ç‡≤ü‡≤ø‡≤Ç‡≤ó‡≥ç‚Äå‡≤ó‡≤≥‡≥Å',
                request_assistance: '‡≤∏‡≤π‡≤æ‡≤Ø ‡≤ï‡≥á‡≤≥‡≤ø',
                submit_request: '‡≤ï‡≥ã‡≤∞‡≤ø‡≤ï‡≥Ü ‡≤∏‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø',
                notifications: '‡≤Ö‡≤ß‡≤ø‡≤∏‡≥Ç‡≤ö‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å',
                sos_emergency: '‡≤§‡≥Å‡≤∞‡≥ç‡≤§‡≥Å SOS',
                help_on_way: '‡≤∏‡≤π‡≤æ‡≤Ø ‡≤¨‡≤∞‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü!'
            },
            ta: {
                commuter_login: '‡Æ™‡ÆØ‡Æ£‡Æø‡Æï‡Æ≥‡Øç ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ',
                staff_portal: '‡Æä‡Æ¥‡Æø‡ÆØ‡Æ∞‡Øç ‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡Æ≤‡Øç',
                feature_voice: '‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æµ‡Æ¥‡Æø‡Æï‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡Æ§‡Æ≤‡Øç',
                feature_assist: '‡Æâ‡Æ§‡Æµ‡Æø',
                feature_routes: '‡Æµ‡Æ¥‡Æø‡Æï‡Æ≥‡Øç',
                welcome_back: '‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç!',
                plan_trip: '‡Æ™‡ÆØ‡Æ£‡Æ§‡Øç ‡Æ§‡Æø‡Æü‡Øç‡Æü‡ÆÆ‡Øç',
                stations: '‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Øç',
                request_help: '‡Æâ‡Æ§‡Æµ‡Æø ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç',
                voice_guide: '‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æµ‡Æ¥‡Æø‡Æï‡Ææ‡Æü‡Øç‡Æü‡Æø',
                live_crowd: '‡Æ®‡Øá‡Æ∞‡Æü‡Æø ‡Æï‡ØÇ‡Æü‡Øç‡Æü ‡Æ®‡Æø‡Æ≤‡Øà',
                metro_lines: '‡ÆÆ‡ØÜ‡Æü‡Øç‡Æ∞‡Øã ‡Æµ‡Æ¥‡Æø‡Æï‡Æ≥‡Øç',
                purple_line: '‡Æä‡Æ§‡Ææ ‡Æµ‡Æ¥‡Æø',
                green_line: '‡Æ™‡Æö‡Øç‡Æö‡Øà ‡Æµ‡Æ¥‡Æø',
                yellow_line: '‡ÆÆ‡Æû‡Øç‡Æö‡Æ≥‡Øç ‡Æµ‡Æ¥‡Æø',
                all_stations: '‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Øç',
                facilities: '‡Æµ‡Æö‡Æ§‡Æø‡Æï‡Æ≥‡Øç',
                trip_planner: '‡Æ™‡ÆØ‡Æ£ ‡Æ§‡Æø‡Æü‡Øç‡Æü‡ÆÆ‡Æø‡Æü‡ØÅ‡Æ™‡Æµ‡Æ∞‡Øç',
                find_route: '‡Æµ‡Æ¥‡Æø ‡Æï‡Æ£‡Øç‡Æü‡ØÅ‡Æ™‡Æø‡Æü‡Æø',
                settings: '‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç',
                nav_home: '‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ',
                sos_emergency: '‡ÆÖ‡Æµ‡Æö‡Æ∞ SOS',
                help_on_way: '‡Æâ‡Æ§‡Æµ‡Æø ‡Æµ‡Æ∞‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ!'
            },
            te: {
                commuter_login: '‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£‡∞ø‡∞ï‡±Å‡∞≤ ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç',
                staff_portal: '‡∞∏‡∞ø‡∞¨‡±ç‡∞¨‡∞Ç‡∞¶‡∞ø ‡∞™‡±ã‡∞∞‡±ç‡∞ü‡∞≤‡±ç',
                feature_voice: '‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞ó‡±à‡∞°‡±Ü‡∞®‡±ç‡∞∏‡±ç',
                feature_assist: '‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç',
                feature_routes: '‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞æ‡∞≤‡±Å',
                welcome_back: '‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç!',
                plan_trip: '‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£ ‡∞™‡±ç‡∞∞‡∞£‡∞æ‡∞≥‡∞ø‡∞ï',
                stations: '‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç‡∞≤‡±Å',
                request_help: '‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ï‡±ã‡∞∞‡∞Ç‡∞°‡∞ø',
                voice_guide: '‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞ó‡±à‡∞°‡±ç',
                live_crowd: '‡∞≤‡±à‡∞µ‡±ç ‡∞∞‡∞¶‡±ç‡∞¶‡±Ä',
                metro_lines: '‡∞Æ‡±Ü‡∞ü‡±ç‡∞∞‡±ã ‡∞≤‡±à‡∞®‡±ç‡∞≤‡±Å',
                purple_line: '‡∞ä‡∞¶‡∞æ ‡∞≤‡±à‡∞®‡±ç',
                green_line: '‡∞Ü‡∞ï‡±Å‡∞™‡∞ö‡±ç‡∞ö ‡∞≤‡±à‡∞®‡±ç',
                yellow_line: '‡∞™‡∞∏‡±Å‡∞™‡±Å ‡∞≤‡±à‡∞®‡±ç',
                all_stations: '‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç‡∞≤‡±Å',
                facilities: '‡∞∏‡±å‡∞ï‡∞∞‡±ç‡∞Ø‡∞æ‡∞≤‡±Å',
                trip_planner: '‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£ ‡∞™‡±ç‡∞≤‡∞æ‡∞®‡∞∞‡±ç',
                find_route: '‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞Ç‡∞°‡∞ø',
                settings: '‡∞∏‡±Ü‡∞ü‡±ç‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç‚Äå‡∞≤‡±Å',
                nav_home: '‡∞π‡±ã‡∞Æ‡±ç',
                sos_emergency: '‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞ SOS',
                help_on_way: '‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞µ‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø!'
            },
            ml: {
                commuter_login: '‡¥Ø‡¥æ‡¥§‡µç‡¥∞‡¥ï‡µç‡¥ï‡¥æ‡¥∞‡µÅ‡¥ü‡µÜ ‡¥≤‡µã‡¥ó‡¥ø‡µª',
                staff_portal: '‡¥∏‡µç‡¥±‡µç‡¥±‡¥æ‡¥´‡µç ‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µΩ',
                feature_voice: '‡¥µ‡µã‡¥Ø‡µç‡¥∏‡µç ‡¥ó‡µà‡¥°‡µª‡¥∏‡µç',
                feature_assist: '‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç',
                feature_routes: '‡¥µ‡¥¥‡¥ø‡¥ï‡µæ',
                welcome_back: '‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µÜ ‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç!',
                plan_trip: '‡¥Ø‡¥æ‡¥§‡µç‡¥∞ ‡¥™‡µç‡¥≤‡¥æ‡µª',
                stations: '‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥∑‡¥®‡µÅ‡¥ï‡µæ',
                request_help: '‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥Ü‡¥µ‡¥∂‡µç‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥ï',
                voice_guide: '‡¥µ‡µã‡¥Ø‡µç‡¥∏‡µç ‡¥ó‡µà‡¥°‡µç',
                live_crowd: '‡¥≤‡µà‡¥µ‡µç ‡¥§‡¥ø‡¥∞‡¥ï‡µç‡¥ï‡µç',
                metro_lines: '‡¥Æ‡µÜ‡¥ü‡µç‡¥∞‡µã ‡¥≤‡µà‡¥®‡µÅ‡¥ï‡µæ',
                purple_line: '‡¥™‡µº‡¥™‡µç‡¥™‡¥ø‡µæ ‡¥≤‡µà‡µª',
                green_line: '‡¥ó‡µç‡¥∞‡µÄ‡µª ‡¥≤‡µà‡µª',
                yellow_line: '‡¥Æ‡¥û‡µç‡¥û ‡¥≤‡µà‡µª',
                all_stations: '‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥∑‡¥®‡µÅ‡¥ï‡¥≥‡µÅ‡¥Ç',
                facilities: '‡¥∏‡µó‡¥ï‡¥∞‡µç‡¥Ø‡¥ô‡µç‡¥ô‡µæ',
                trip_planner: '‡¥Ø‡¥æ‡¥§‡µç‡¥∞‡¥æ ‡¥™‡µç‡¥≤‡¥æ‡¥®‡µº',
                find_route: '‡¥µ‡¥¥‡¥ø ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡µÅ‡¥ï',
                settings: '‡¥ï‡µç‡¥∞‡¥Æ‡µÄ‡¥ï‡¥∞‡¥£‡¥ô‡µç‡¥ô‡µæ',
                nav_home: '‡¥π‡µã‡¥Ç',
                sos_emergency: '‡¥Ö‡¥ü‡¥ø‡¥Ø‡¥®‡µç‡¥§‡¥∞ SOS',
                help_on_way: '‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥µ‡¥∞‡µÅ‡¥®‡µç‡¥®‡µÅ!'
            }
        };
        
        // ============================================
        // VOICE COMMANDS IN MULTIPLE LANGUAGES
        // ============================================
        const VOICE_COMMANDS = {
            en: {
                emergency: ['emergency', 'sos', 'help me', 'urgent', 'danger'],
                trip: ['plan', 'trip', 'route', 'travel', 'go from', 'how to go', 'directions'],
                crowd: ['crowd', 'busy', 'crowded', 'how busy', 'status'],
                stations: ['station', 'stations', 'show stations', 'list stations', 'all stations'],
                help: ['help', 'assistance', 'need help', 'wheelchair', 'assist'],
                home: ['home', 'go home', 'main page', 'dashboard'],
                settings: ['settings', 'preferences', 'options'],
                read: ['read', 'route', 'read route', 'my route', 'read steps'],
                location: ['my location', 'where am i', 'current location', 'locate me'],
                map: ['map', 'show map', 'open map'],
                facilities: ['facilities', 'what facilities', 'amenities'],
                language: ['language', 'change language', 'speak in'],
                cancel: ['cancel', 'stop', 'close', 'exit', 'bye', 'goodbye'],
                hello: ['hello', 'hi', 'hey'],
                thanks: ['thank', 'thanks']
            },
            hi: {
                emergency: ['‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤', '‡§è‡§∏‡§ì‡§è‡§∏', '‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•ã', '‡§ñ‡§§‡§∞‡§æ', '‡§¨‡§ö‡§æ‡§ì', '‡§ú‡§∞‡•Ç‡§∞‡•Ä'],
                trip: ['‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ', '‡§∞‡§æ‡§∏‡•ç‡§§‡§æ', '‡§ï‡•à‡§∏‡•á ‡§ú‡§æ‡§ä‡§Ç', '‡§Æ‡§æ‡§∞‡•ç‡§ó', '‡§ú‡§æ‡§®‡§æ ‡§π‡•à'],
                crowd: ['‡§≠‡•Ä‡§°‡§º', '‡§ï‡§ø‡§§‡§®‡•Ä ‡§≠‡•Ä‡§°‡§º', '‡§∏‡•ç‡§•‡§ø‡§§‡§ø'],
                stations: ['‡§∏‡•ç‡§ü‡•á‡§∂‡§®', '‡§∏‡§≠‡•Ä ‡§∏‡•ç‡§ü‡•á‡§∂‡§®', '‡§®‡§ï‡•ç‡§∂‡§æ ‡§¶‡§ø‡§ñ‡§æ‡§ì'],
                help: ['‡§Æ‡§¶‡§¶', '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ', '‡§Æ‡§¶‡§¶ ‡§ö‡§æ‡§π‡§ø‡§è', '‡§µ‡•ç‡§π‡•Ä‡§≤‡§ö‡•á‡§Ø‡§∞'],
                home: ['‡§π‡•ã‡§Æ', '‡§ò‡§∞', '‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•É‡§∑‡•ç‡§†'],
                settings: ['‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏', '‡§µ‡§ø‡§ï‡§≤‡•ç‡§™'],
                read: ['‡§™‡§¢‡§º‡•ã', '‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§™‡§¢‡§º‡•ã'],
                location: ['‡§Æ‡•á‡§∞‡§æ ‡§∏‡•ç‡§•‡§æ‡§®', '‡§Æ‡•à‡§Ç ‡§ï‡§π‡§æ‡§Ç ‡§π‡•Ç‡§Ç'],
                map: ['‡§®‡§ï‡•ç‡§∂‡§æ', '‡§Æ‡•à‡§™ ‡§¶‡§ø‡§ñ‡§æ‡§ì'],
                cancel: ['‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•ã', '‡§∞‡•Å‡§ï‡•ã', '‡§Ö‡§≤‡§µ‡§ø‡§¶‡§æ'],
                hello: ['‡§®‡§Æ‡§∏‡•ç‡§§‡•á', '‡§π‡•à‡§≤‡•ã'],
                thanks: ['‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶', '‡§∂‡•Å‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ']
            },
            kn: {
                emergency: ['‡≤§‡≥Å‡≤∞‡≥ç‡≤§‡≥Å', '‡≤é‡≤∏‡≥ç‡≤ì‡≤é‡≤∏‡≥ç', '‡≤∏‡≤π‡≤æ‡≤Ø ‡≤Æ‡≤æ‡≤°‡≤ø', '‡≤Ö‡≤™‡≤æ‡≤Ø', '‡≤¨‡≤ö‡≤æ‡≤µ‡≥Å'],
                trip: ['‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£', '‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó', '‡≤π‡≥á‡≤ó‡≥Ü ‡≤π‡≥ã‡≤ó‡≥Å‡≤µ‡≥Å‡≤¶‡≥Å', '‡≤¶‡≤æ‡≤∞‡≤ø'],
                crowd: ['‡≤ú‡≤®‡≤∏‡≤Ç‡≤¶‡≤£‡≤ø', '‡≤é‡≤∑‡≥ç‡≤ü‡≥Å ‡≤ú‡≤®', '‡≤∏‡≥ç‡≤•‡≤ø‡≤§‡≤ø'],
                stations: ['‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£', '‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≥Å'],
                help: ['‡≤∏‡≤π‡≤æ‡≤Ø', '‡≤∏‡≤π‡≤æ‡≤Ø ‡≤¨‡≥á‡≤ï‡≥Å', '‡≤µ‡≥Ä‡≤≤‡≥ç‚Äå‡≤ö‡≥á‡≤∞‡≥ç'],
                home: ['‡≤Æ‡≤®‡≥Ü', '‡≤π‡≥ã‡≤Æ‡≥ç'],
                settings: ['‡≤∏‡≥Ü‡≤ü‡≥ç‡≤ü‡≤ø‡≤Ç‡≤ó‡≥ç‚Äå‡≤ó‡≤≥‡≥Å'],
                cancel: ['‡≤®‡≤ø‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø', '‡≤Æ‡≥Å‡≤ö‡≥ç‡≤ö‡≤ø', '‡≤µ‡≤ø‡≤¶‡≤æ‡≤Ø'],
                hello: ['‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞', '‡≤π‡≤≤‡≥ã'],
                thanks: ['‡≤ß‡≤®‡≥ç‡≤Ø‡≤µ‡≤æ‡≤¶']
            },
            ta: {
                emergency: ['‡ÆÖ‡Æµ‡Æö‡Æ∞‡ÆÆ‡Øç', '‡Æé‡Æ∏‡Øç‡Æì‡Æé‡Æ∏‡Øç', '‡Æâ‡Æ§‡Æµ‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç', '‡ÆÜ‡Æ™‡Æ§‡Øç‡Æ§‡ØÅ'],
                trip: ['‡Æ™‡ÆØ‡Æ£‡ÆÆ‡Øç', '‡Æµ‡Æ¥‡Æø', '‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æ™‡Øã‡Æµ‡Æ§‡ØÅ'],
                crowd: ['‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç', '‡Æé‡Æµ‡Øç‡Æµ‡Æ≥‡Æµ‡ØÅ ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç'],
                stations: ['‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡ÆÆ‡Øç', '‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Øç'],
                help: ['‡Æâ‡Æ§‡Æµ‡Æø', '‡Æâ‡Æ§‡Æµ‡Æø ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç', '‡Æö‡Æï‡Øç‡Æï‡Æ∞ ‡Æ®‡Ææ‡Æ±‡Øç‡Æï‡Ææ‡Æ≤‡Æø'],
                home: ['‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ', '‡Æµ‡ØÄ‡Æü‡ØÅ'],
                cancel: ['‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ', '‡ÆÆ‡ØÇ‡Æü‡ØÅ', '‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç'],
                hello: ['‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç', '‡Æπ‡Æ≤‡Øã'],
                thanks: ['‡Æ®‡Æ©‡Øç‡Æ±‡Æø']
            },
            te: {
                emergency: ['‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞‡∞Ç', '‡∞é‡∞∏‡±ç‡∞ì‡∞é‡∞∏‡±ç', '‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø', '‡∞™‡±ç‡∞∞‡∞Æ‡∞æ‡∞¶‡∞Ç'],
                trip: ['‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£‡∞Ç', '‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç', '‡∞é‡∞≤‡∞æ ‡∞µ‡±Ü‡∞≥‡±ç‡∞≥‡∞æ‡∞≤‡∞ø'],
                crowd: ['‡∞∞‡∞¶‡±ç‡∞¶‡±Ä', '‡∞é‡∞Ç‡∞§ ‡∞∞‡∞¶‡±ç‡∞¶‡±Ä'],
                stations: ['‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç', '‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç‡∞≤‡±Å'],
                help: ['‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç', '‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡∞ø', '‡∞µ‡±Ä‡∞≤‡±ç ‡∞ö‡±Ü‡∞Ø‡∞ø‡∞∞‡±ç'],
                home: ['‡∞π‡±ã‡∞Æ‡±ç', '‡∞á‡∞≤‡±ç‡∞≤‡±Å'],
                cancel: ['‡∞Ü‡∞™‡±Å', '‡∞Æ‡±Ç‡∞∏‡∞ø‡∞µ‡±á‡∞Ø‡±Å', '‡∞µ‡±Ä‡∞°‡±ç‡∞ï‡±ã‡∞≤‡±Å'],
                hello: ['‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç', '‡∞π‡∞≤‡±ã'],
                thanks: ['‡∞ß‡∞®‡±ç‡∞Ø‡∞µ‡∞æ‡∞¶‡∞æ‡∞≤‡±Å']
            },
            ml: {
                emergency: ['‡¥Ö‡¥ü‡¥ø‡¥Ø‡¥®‡µç‡¥§‡¥ø‡¥∞‡¥Ç', '‡¥é‡¥∏‡µç‡¥í‡¥é‡¥∏‡µç', '‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÇ', '‡¥Ö‡¥™‡¥ï‡¥ü‡¥Ç'],
                trip: ['‡¥Ø‡¥æ‡¥§‡µç‡¥∞', '‡¥µ‡¥¥‡¥ø', '‡¥é‡¥ô‡µç‡¥ô‡¥®‡µÜ ‡¥™‡µã‡¥ï‡µÅ‡¥Ç'],
                crowd: ['‡¥§‡¥ø‡¥∞‡¥ï‡µç‡¥ï‡µç', '‡¥é‡¥§‡µç‡¥∞ ‡¥§‡¥ø‡¥∞‡¥ï‡µç‡¥ï‡µç'],
                stations: ['‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥∑‡µª', '‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥∑‡¥®‡µÅ‡¥ï‡µæ'],
                help: ['‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç', '‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥µ‡µá‡¥£‡¥Ç', '‡¥µ‡µÄ‡µΩ‡¥ö‡µÜ‡¥Ø‡µº'],
                home: ['‡¥π‡µã‡¥Ç', '‡¥µ‡µÄ‡¥ü‡µç'],
                cancel: ['‡¥®‡¥ø‡µº‡¥§‡µç‡¥§‡µÅ‡¥ï', '‡¥Ö‡¥ü‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥ï', '‡¥µ‡¥ø‡¥ü'],
                hello: ['‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç', '‡¥π‡¥≤‡µã'],
                thanks: ['‡¥®‡¥®‡µç‡¥¶‡¥ø']
            }
        };
        
        // Voice responses in multiple languages
        const VOICE_RESPONSES = {
            en: {
                welcome: "Hello! I'm your AccessiGo voice assistant. How can I help you today?",
                goodbye: "Goodbye! Have a safe journey.",
                planningTrip: "Planning trip from {from} to {to}. Let me calculate the route.",
                tripHelp: "I can help you plan a trip. Please say something like: Plan a trip from MG Road to Majestic.",
                crowdHigh: "{station} is currently very crowded. Consider waiting or using an alternate route.",
                crowdMedium: "{station} is moderately busy. Expect some waiting.",
                crowdLow: "{station} is not crowded. It's a good time to travel.",
                allCrowdOk: "Good news! All stations currently have low to moderate crowd levels.",
                openingStations: "Opening all stations.",
                openingHelp: "I'll help you request assistance. Opening the help form.",
                goingHome: "Going to home screen.",
                openingSettings: "Opening settings.",
                noRoute: "You haven't planned a route yet. Would you like me to help you plan one?",
                gettingLocation: "Getting your current location.",
                openingMap: "Opening the metro map.",
                triggeringSOS: "Triggering emergency SOS alert. Please confirm on screen.",
                languageChanged: "Language changed to {language}.",
                notUnderstood: "I'm not sure what you mean. Try saying: Plan a trip, Check crowd, Request help, or Show stations.",
                hello: "Hello! I'm your AccessiGo assistant. I can help you plan trips, check crowd status, request assistance, and navigate the metro. What would you like to do?",
                thanks: "You're welcome! Is there anything else I can help you with?",
                facilities: "{station} has the following facilities: {facilities}."
            },
            hi: {
                welcome: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏‡•Ä‡§ó‡•ã ‡§µ‡•â‡§Ø‡§∏ ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•Ç‡§Ç‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç?",
                goodbye: "‡§Ö‡§≤‡§µ‡§ø‡§¶‡§æ! ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§",
                planningTrip: "{from} ‡§∏‡•á {to} ‡§§‡§ï ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§®‡§æ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç‡•§ ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§ï‡•Ä ‡§ó‡§£‡§®‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Ç‡•§",
                tripHelp: "‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡•ã‡§≤‡•á‡§Ç: ‡§è‡§Æ‡§ú‡•Ä ‡§∞‡•ã‡§° ‡§∏‡•á ‡§Æ‡•à‡§ú‡•á‡§∏‡•ç‡§ü‡§ø‡§ï ‡§§‡§ï ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§®‡§æ‡§ì‡•§",
                crowdHigh: "{station} ‡§Æ‡•á‡§Ç ‡§Ö‡§≠‡•Ä ‡§¨‡§π‡•Å‡§§ ‡§≠‡•Ä‡§°‡§º ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§ö‡•Å‡§®‡•á‡§Ç‡•§",
                crowdMedium: "{station} ‡§Æ‡•á‡§Ç ‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§≠‡•Ä‡§°‡§º ‡§π‡•à‡•§",
                crowdLow: "{station} ‡§Æ‡•á‡§Ç ‡§≠‡•Ä‡§°‡§º ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§∏‡§Æ‡§Ø ‡§π‡•à‡•§",
                allCrowdOk: "‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§ñ‡§¨‡§∞! ‡§∏‡§≠‡•Ä ‡§∏‡•ç‡§ü‡•á‡§∂‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§ï‡§Æ ‡§≠‡•Ä‡§°‡§º ‡§π‡•à‡•§",
                openingStations: "‡§∏‡§≠‡•Ä ‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§ñ‡•ã‡§≤ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç‡•§",
                openingHelp: "‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•Ç‡§Ç‡§ó‡§æ‡•§ ‡§´‡•â‡§∞‡•ç‡§Æ ‡§ñ‡•ã‡§≤ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç‡•§",
                goingHome: "‡§π‡•ã‡§Æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç‡•§",
                openingSettings: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ñ‡•ã‡§≤ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç‡•§",
                noRoute: "‡§Ü‡§™‡§®‡•á ‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§π‡•à‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•Ç‡§Ç?",
                gettingLocation: "‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç‡•§",
                openingMap: "‡§Æ‡•á‡§ü‡•ç‡§∞‡•ã ‡§Æ‡•à‡§™ ‡§ñ‡•ã‡§≤ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç‡•§",
                triggeringSOS: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® SOS ‡§Ö‡§≤‡§∞‡•ç‡§ü ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç‡•§",
                languageChanged: "‡§≠‡§æ‡§∑‡§æ {language} ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤ ‡§¶‡•Ä ‡§ó‡§à‡•§",
                notUnderstood: "‡§Æ‡•Å‡§ù‡•á ‡§∏‡§Æ‡§ù ‡§®‡§π‡•Ä‡§Ç ‡§Ü‡§Ø‡§æ‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡•ã‡§≤‡•á‡§Ç: ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ, ‡§≠‡•Ä‡§°‡§º ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç, ‡§Ø‡§æ ‡§Æ‡§¶‡§¶ ‡§Æ‡§æ‡§Ç‡§ó‡•á‡§Ç‡•§",
                hello: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏‡•Ä‡§ó‡•ã ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•Ç‡§Ç‡•§ ‡§Æ‡•à‡§Ç ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ, ‡§≠‡•Ä‡§°‡§º ‡§∏‡•ç‡§•‡§ø‡§§‡§ø, ‡§î‡§∞ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç‡•§",
                thanks: "‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à! ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§Æ‡§¶‡§¶ ‡§ö‡§æ‡§π‡§ø‡§è?",
                facilities: "{station} ‡§Æ‡•á‡§Ç ‡§Ø‡•á ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Ç ‡§π‡•à‡§Ç: {facilities}‡•§"
            },
            kn: {
                welcome: "‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞! ‡≤®‡≤æ‡≤®‡≥Å ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤é‡≤ï‡≥ç‡≤∏‡≥Ü‡≤∏‡≤ø‡≤ó‡≥ã ‡≤µ‡≤æ‡≤Ø‡≥ç‡≤∏‡≥ç ‡≤Ö‡≤∏‡≤ø‡≤∏‡≥ç‡≤ü‡≥Ü‡≤Ç‡≤ü‡≥ç. ‡≤®‡≤æ‡≤®‡≥Å ‡≤π‡≥á‡≤ó‡≥Ü ‡≤∏‡≤π‡≤æ‡≤Ø ‡≤Æ‡≤æ‡≤°‡≤¨‡≤π‡≥Å‡≤¶‡≥Å?",
                goodbye: "‡≤µ‡≤ø‡≤¶‡≤æ‡≤Ø! ‡≤∏‡≥Å‡≤∞‡≤ï‡≥ç‡≤∑‡≤ø‡≤§ ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Æ‡≤æ‡≤°‡≤ø.",
                planningTrip: "{from} ‡≤®‡≤ø‡≤Ç‡≤¶ {to} ‡≤ó‡≥Ü ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Ø‡≥ã‡≤ú‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≥á‡≤®‡≥Ü. ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó ‡≤≤‡≥Ü‡≤ï‡≥ç‡≤ï‡≤π‡≤æ‡≤ï‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≥á‡≤®‡≥Ü.",
                tripHelp: "‡≤®‡≤æ‡≤®‡≥Å ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Ø‡≥ã‡≤ú‡≤ø‡≤∏‡≤≤‡≥Å ‡≤∏‡≤π‡≤æ‡≤Ø ‡≤Æ‡≤æ‡≤°‡≤¨‡≤≤‡≥ç‡≤≤‡≥Ü. ‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤π‡≥á‡≤≥‡≤ø: ‡≤é‡≤Ç‡≤ú‡≤ø ‡≤∞‡≥ã‡≤°‡≥ç‚Äå‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤Æ‡≥Ü‡≤ú‡≥Ü‡≤∏‡≥ç‡≤ü‡≤ø‡≤ï‡≥ç‚Äå‡≤ó‡≥Ü ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Ø‡≥ã‡≤ú‡≤ø‡≤∏‡≤ø.",
                crowdHigh: "{station} ‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤à‡≤ó ‡≤§‡≥Å‡≤Ç‡≤¨‡≤æ ‡≤ú‡≤®‡≤∏‡≤Ç‡≤¶‡≤£‡≤ø ‡≤á‡≤¶‡≥Ü.",
                crowdLow: "{station} ‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤ú‡≤®‡≤∏‡≤Ç‡≤¶‡≤£‡≤ø ‡≤á‡≤≤‡≥ç‡≤≤. ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£‡≤ï‡≥ç‡≤ï‡≥Ü ‡≤í‡≤≥‡≥ç‡≤≥‡≥Ü‡≤Ø ‡≤∏‡≤Æ‡≤Ø.",
                openingStations: "‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≥Ü‡≤∞‡≥Ü‡≤Ø‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≥á‡≤®‡≥Ü.",
                openingHelp: "‡≤∏‡≤π‡≤æ‡≤Ø ‡≤ï‡≥ã‡≤∞‡≤ø‡≤ï‡≥Ü ‡≤´‡≤æ‡≤∞‡≥ç‡≤Æ‡≥ç ‡≤§‡≥Ü‡≤∞‡≥Ü‡≤Ø‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≥á‡≤®‡≥Ü.",
                triggeringSOS: "‡≤§‡≥Å‡≤∞‡≥ç‡≤§‡≥Å SOS ‡≤Ö‡≤≤‡≤∞‡≥ç‡≤ü‡≥ç ‡≤ï‡≤≥‡≥Å‡≤π‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≥á‡≤®‡≥Ü. ‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤∏‡≥ç‡≤ï‡≥ç‡≤∞‡≥Ä‡≤®‡≥ç‚Äå‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤¶‡≥É‡≤¢‡≥Ä‡≤ï‡≤∞‡≤ø‡≤∏‡≤ø.",
                notUnderstood: "‡≤®‡≤®‡≤ó‡≥Ü ‡≤Ö‡≤∞‡≥ç‡≤•‡≤µ‡≤æ‡≤ó‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤. ‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤π‡≥á‡≤≥‡≤ø: ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Ø‡≥ã‡≤ú‡≤ø‡≤∏‡≤ø, ‡≤ú‡≤®‡≤∏‡≤Ç‡≤¶‡≤£‡≤ø ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤ø‡≤∏‡≤ø, ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤∏‡≤π‡≤æ‡≤Ø ‡≤ï‡≥ã‡≤∞‡≤ø.",
                hello: "‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞! ‡≤®‡≤æ‡≤®‡≥Å ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤é‡≤ï‡≥ç‡≤∏‡≥Ü‡≤∏‡≤ø‡≤ó‡≥ã ‡≤∏‡≤π‡≤æ‡≤Ø‡≤ï.",
                thanks: "‡≤∏‡≥ç‡≤µ‡≤æ‡≤ó‡≤§! ‡≤á‡≤®‡≥ç‡≤®‡≥á‡≤®‡≤æ‡≤¶‡≤∞‡≥Ç ‡≤∏‡≤π‡≤æ‡≤Ø ‡≤¨‡≥á‡≤ï‡≥Ü?"
            },
            ta: {
                welcome: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÜ‡Æï‡Øç‡Æö‡ØÜ‡Æö‡Æø‡Æï‡Øã ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç. ‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æâ‡Æ§‡Æµ ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç?",
                goodbye: "‡Æ™‡Æø‡Æ∞‡Æø‡ÆØ‡Ææ‡Æµ‡Æø‡Æü‡Øà! ‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡Ææ‡Æ© ‡Æ™‡ÆØ‡Æ£‡ÆÆ‡Øç.",
                planningTrip: "{from} ‡Æá‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ {to} ‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡ÆØ‡Æ£‡Æ§‡Øç‡Æ§‡Øà ‡Æ§‡Æø‡Æü‡Øç‡Æü‡ÆÆ‡Æø‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç.",
                crowdHigh: "{station} ‡Æá‡Æ≤‡Øç ‡Æá‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡ÆÆ‡Æø‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç.",
                crowdLow: "{station} ‡Æá‡Æ≤‡Øç ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà. ‡Æ™‡ÆØ‡Æ£‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æ®‡Æ≤‡Øç‡Æ≤ ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç.",
                triggeringSOS: "‡ÆÖ‡Æµ‡Æö‡Æ∞ SOS ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç.",
                hello: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÜ‡Æï‡Øç‡Æö‡ØÜ‡Æö‡Æø‡Æï‡Øã ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç.",
                thanks: "‡Æ®‡Æ©‡Øç‡Æ±‡Æø! ‡Æµ‡Øá‡Æ±‡ØÅ ‡Æè‡Æ§‡Ææ‡Æµ‡Æ§‡ØÅ ‡Æâ‡Æ§‡Æµ‡Æø ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Ææ?"
            },
            te: {
                welcome: "‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç! ‡∞®‡±á‡∞®‡±Å ‡∞Æ‡±Ä ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡∞ø‡∞ó‡±ã ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞Ö‡∞∏‡∞ø‡∞∏‡±ç‡∞ü‡±Ü‡∞Ç‡∞ü‡±ç. ‡∞®‡±á‡∞®‡±Å ‡∞é‡∞≤‡∞æ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å?",
                goodbye: "‡∞µ‡±Ä‡∞°‡±ç‡∞ï‡±ã‡∞≤‡±Å! ‡∞∏‡±Å‡∞∞‡∞ï‡±ç‡∞∑‡∞ø‡∞§ ‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£‡∞Ç.",
                planningTrip: "{from} ‡∞®‡±Å‡∞Ç‡∞°‡∞ø {to} ‡∞ï‡±Å ‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞™‡±ç‡∞≤‡∞æ‡∞®‡±ç ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å.",
                crowdHigh: "{station} ‡∞≤‡±ã ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞ö‡∞æ‡∞≤‡∞æ ‡∞∞‡∞¶‡±ç‡∞¶‡±Ä‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø.",
                crowdLow: "{station} ‡∞≤‡±ã ‡∞∞‡∞¶‡±ç‡∞¶‡±Ä ‡∞≤‡±á‡∞¶‡±Å. ‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞Ç‡∞ö‡∞ø ‡∞∏‡∞Æ‡∞Ø‡∞Ç.",
                triggeringSOS: "‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞ SOS ‡∞Ö‡∞≤‡∞∞‡±ç‡∞ü‡±ç ‡∞™‡∞Ç‡∞™‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å.",
                hello: "‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç! ‡∞®‡±á‡∞®‡±Å ‡∞Æ‡±Ä ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡∞ø‡∞ó‡±ã ‡∞Ö‡∞∏‡∞ø‡∞∏‡±ç‡∞ü‡±Ü‡∞Ç‡∞ü‡±ç.",
                thanks: "‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç! ‡∞Æ‡∞∞‡±á‡∞Æ‡±à‡∞®‡∞æ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡∞æ?"
            },
            ml: {
                welcome: "‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç! ‡¥û‡¥æ‡µª ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥Ü‡¥ï‡µç‡¥∏‡¥∏‡¥ø‡¥ó‡µã ‡¥µ‡µã‡¥Ø‡µç‡¥∏‡µç ‡¥Ö‡¥∏‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥®‡µç‡¥±‡µç ‡¥Ü‡¥£‡µç. ‡¥é‡¥ô‡µç‡¥ô‡¥®‡µÜ ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ç?",
                goodbye: "‡¥µ‡¥ø‡¥ü! ‡¥∏‡µÅ‡¥∞‡¥ï‡µç‡¥∑‡¥ø‡¥§‡¥Æ‡¥æ‡¥Ø ‡¥Ø‡¥æ‡¥§‡µç‡¥∞.",
                planningTrip: "{from} ‡¥Æ‡µÅ‡¥§‡µΩ {to} ‡¥µ‡¥∞‡µÜ ‡¥Ø‡¥æ‡¥§‡µç‡¥∞ ‡¥™‡µç‡¥≤‡¥æ‡µª ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ.",
                crowdHigh: "{station} ‡¥á‡µΩ ‡¥á‡¥™‡µç‡¥™‡µã‡µæ ‡¥µ‡¥≥‡¥∞‡µÜ ‡¥§‡¥ø‡¥∞‡¥ï‡µç‡¥ï‡¥æ‡¥£‡µç.",
                crowdLow: "{station} ‡¥á‡µΩ ‡¥§‡¥ø‡¥∞‡¥ï‡µç‡¥ï‡¥ø‡¥≤‡µç‡¥≤. ‡¥Ø‡¥æ‡¥§‡µç‡¥∞‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µç ‡¥®‡¥≤‡µç‡¥≤ ‡¥∏‡¥Æ‡¥Ø‡¥Ç.",
                triggeringSOS: "‡¥Ö‡¥ü‡¥ø‡¥Ø‡¥®‡µç‡¥§‡¥ø‡¥∞ SOS ‡¥Ö‡¥≤‡µº‡¥ü‡µç‡¥ü‡µç ‡¥Ö‡¥Ø‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ.",
                hello: "‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç! ‡¥û‡¥æ‡µª ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥Ü‡¥ï‡µç‡¥∏‡¥∏‡¥ø‡¥ó‡µã ‡¥Ö‡¥∏‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥®‡µç‡¥±‡µç.",
                thanks: "‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç! ‡¥Æ‡¥±‡µç‡¥±‡µÜ‡¥®‡µç‡¥§‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡¥≤‡µÅ‡¥Ç ‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥µ‡µá‡¥£‡µã?"
            }
        };

        // ============================================
        // STATE
        // ============================================
        let state = {
            currentLang: 'en',
            largeText: false,
            reduceMotion: false,
            hapticEnabled: true,
            currentStation: null,
            currentRoute: null,
            assistanceRequest: null,
            crowdLevels: {},
            notifications: [],
            currentFilter: 'all',
            selectedLocation: null
        };

        let stationMap = null;
        let fullMap = null;
        let locationMarker = null;

        // ============================================
        // HAPTIC FEEDBACK SYSTEM
        // ============================================
        const Haptics = {
            // Check if vibration is supported
            isSupported: () => {
                return 'vibrate' in navigator;
            },
            
            // Light tap - for button presses, selections
            light: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate(10);
                }
            },
            
            // Medium tap - for confirmations, toggles
            medium: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate(25);
                }
            },
            
            // Heavy tap - for important actions
            heavy: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate(50);
                }
            },
            
            // Success pattern - for successful operations
            success: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate([30, 50, 30]);
                }
            },
            
            // Error pattern - for errors/warnings
            error: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate([50, 30, 50, 30, 50]);
                }
            },
            
            // Warning pattern - for alerts
            warning: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate([30, 20, 30]);
                }
            },
            
            // Selection changed - for list selections, tab changes
            selection: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate(15);
                }
            },
            
            // Impact - for collisions, drops
            impact: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate(40);
                }
            },
            
            // Notification - for new notifications
            notification: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate([20, 100, 20]);
                }
            },
            
            // Double tap pattern
            doubleTap: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate([15, 50, 15]);
                }
            },
            
            // Long press feedback
            longPress: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate(100);
                }
            },
            
            // Page transition
            pageTransition: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate(20);
                }
            },
            
            // Map interaction
            mapPin: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate([10, 30, 20]);
                }
            },
            
            // Bottom sheet open/close
            sheetOpen: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate(35);
                }
            },
            
            // Toggle switch
            toggle: () => {
                if (Haptics.isSupported() && state.hapticEnabled) {
                    navigator.vibrate(18);
                }
            }
        };

        // ============================================
        // INITIALIZATION (handled at end of script)
        // ============================================

        function loadState() {
            const saved = localStorage.getItem('accessigo-state');
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
            }
        }

        function saveState() {
            localStorage.setItem('accessigo-state', JSON.stringify(state));
        }

        // ============================================
        // MAP FUNCTIONS
        // ============================================
        function initStationMap(station) {
            if (stationMap) {
                stationMap.remove();
            }
            
            stationMap = L.map('station-map', {
                zoomControl: false,
                attributionControl: false
            }).setView([station.lat, station.lng], 16);
            
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                maxZoom: 19
            }).addTo(stationMap);
            
            // Station marker
            const stationIcon = L.divIcon({
                className: 'custom-marker',
                html: '<div style="width:20px;height:20px;"></div>',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
            
            L.marker([station.lat, station.lng], { icon: stationIcon })
                .addTo(stationMap)
                .bindPopup(`<b>${station.name}</b><br>Metro Station`);
            
            // Add bus stops
            (station.busStops || []).forEach((stop, i) => {
                const offset = (i + 1) * 0.001;
                const busIcon = L.divIcon({
                    className: 'bus-marker',
                    html: '<div style="width:14px;height:14px;"></div>',
                    iconSize: [14, 14],
                    iconAnchor: [7, 7]
                });
                
                L.marker([station.lat + offset, station.lng + offset * 0.5], { icon: busIcon })
                    .addTo(stationMap)
                    .on('click', () => showBusStopInfo(stop));
            });
            
            // Click handler
            stationMap.on('click', (e) => {
                handleMapClick(e.latlng.lat, e.latlng.lng);
            });
        }

        function openFullMap() {
            document.getElementById('map-modal').classList.remove('hidden');
            
            setTimeout(() => {
                if (fullMap) {
                    fullMap.remove();
                }
                
                fullMap = L.map('full-map', {
                    zoomControl: true,
                    attributionControl: false
                }).setView([12.9716, 77.5946], 12);
                
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    maxZoom: 19
                }).addTo(fullMap);
                
                // Add all stations
                const lineColors = {
                    purple: '#7B2D8E',
                    green: '#00A650',
                    yellow: '#FFCC00'
                };
                
                Object.entries(STATIONS).forEach(([line, stations]) => {
                    const coords = stations.map(s => [s.lat, s.lng]);
                    
                    // Draw line
                    L.polyline(coords, {
                        color: lineColors[line],
                        weight: 4,
                        opacity: 0.8
                    }).addTo(fullMap);
                    
                    // Add station markers
                    stations.forEach(station => {
                        const icon = L.divIcon({
                            className: '',
                            html: `<div style="width:16px;height:16px;background:${lineColors[line]};border-radius:50%;border:2px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.3);"></div>`,
                            iconSize: [16, 16],
                            iconAnchor: [8, 8]
                        });
                        
                        L.marker([station.lat, station.lng], { icon })
                            .addTo(fullMap)
                            .bindPopup(`<b>${station.name}</b><br><span style="color:${lineColors[line]}">${line.charAt(0).toUpperCase() + line.slice(1)} Line</span>`)
                            .on('click', () => {
                                closeFullMap();
                                showStationDetail(station.id);
                            });
                    });
                });
                
                // Click handler for getting location
                fullMap.on('click', (e) => {
                    handleMapClick(e.latlng.lat, e.latlng.lng);
                });
                
            }, 100);
        }

        function closeFullMap() {
            document.getElementById('map-modal').classList.add('hidden');
            if (fullMap) {
                fullMap.remove();
                fullMap = null;
            }
        }

        function handleMapClick(lat, lng) {
            Haptics.mapPin();
            state.selectedLocation = { lat, lng };
            
            // Remove existing marker
            if (locationMarker && fullMap) {
                fullMap.removeLayer(locationMarker);
            }
            
            // Add new marker
            const icon = L.divIcon({
                className: 'location-marker',
                html: '<div style="width:20px;height:20px;"></div>',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
            
            if (fullMap) {
                locationMarker = L.marker([lat, lng], { icon }).addTo(fullMap);
            }
            
            // Show location info
            document.getElementById('location-info').classList.remove('hidden');
            document.getElementById('location-coords').textContent = `${lat.toFixed(6)}¬∞ N, ${lng.toFixed(6)}¬∞ E`;
            
            // Reverse geocode (simulated)
            reverseGeocode(lat, lng);
            
            showToast(`üìç Location selected: ${lat.toFixed(4)}, ${lng.toFixed(4)}`, 'info');
        }

        function reverseGeocode(lat, lng) {
            // Simulated reverse geocoding
            const areas = [
                'Indiranagar, Bengaluru',
                'Koramangala, Bengaluru',
                'Jayanagar, Bengaluru',
                'MG Road, Bengaluru',
                'Whitefield, Bengaluru',
                'Electronic City, Bengaluru'
            ];
            
            const address = areas[Math.floor(Math.random() * areas.length)];
            document.getElementById('location-address').textContent = address;
        }

        function getMyLocation() {
            if ('geolocation' in navigator) {
                showToast('üìç Getting your location...', 'info');
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        handleMapClick(latitude, longitude);
                        
                        if (fullMap) {
                            fullMap.setView([latitude, longitude], 15);
                        }
                        
                        showToast('‚úì Location found!', 'success');
                    },
                    (error) => {
                        showToast('‚ùå Could not get location. Please enable GPS.', 'error');
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            } else {
                showToast('‚ùå Geolocation not supported', 'error');
            }
        }

        function findNearestStation() {
            if (!state.selectedLocation) {
                showToast('Please select a location first', 'error');
                return;
            }
            
            const { lat, lng } = state.selectedLocation;
            let nearest = null;
            let minDist = Infinity;
            
            getAllStations().forEach(station => {
                const dist = Math.sqrt(
                    Math.pow(station.lat - lat, 2) + 
                    Math.pow(station.lng - lng, 2)
                );
                if (dist < minDist) {
                    minDist = dist;
                    nearest = station;
                }
            });
            
            if (nearest) {
                const distKm = (minDist * 111).toFixed(2);
                showToast(`üöá Nearest: ${nearest.name} (~${distKm} km)`, 'success');
                
                closeFullMap();
                setTimeout(() => showStationDetail(nearest.id), 300);
            }
        }

        function openStationMap() {
            if (state.currentStation) {
                openFullMap();
                setTimeout(() => {
                    if (fullMap) {
                        fullMap.setView([state.currentStation.lat, state.currentStation.lng], 16);
                    }
                }, 200);
            }
        }

        function showBusStopInfo(stop) {
            Haptics.sheetOpen();
            document.getElementById('bus-stop-name').textContent = stop.name;
            document.getElementById('bus-stop-distance').textContent = `${stop.distance} from station`;
            
            const routesHtml = stop.routes.map(route => 
                `<span class="px-3 py-1 rounded-full bg-blue-500/20 text-blue-300 text-sm">${route}</span>`
            ).join('');
            document.getElementById('bus-stop-routes').innerHTML = routesHtml;
            
            const sheet = document.getElementById('bus-stop-sheet');
            sheet.classList.remove('hidden');
            setTimeout(() => {
                sheet.querySelector('.bottom-sheet').classList.add('open');
            }, 10);
        }

        function closeBusStopSheet() {
            Haptics.light();
            const sheet = document.getElementById('bus-stop-sheet');
            sheet.querySelector('.bottom-sheet').classList.remove('open');
            setTimeout(() => {
                sheet.classList.add('hidden');
            }, 400);
        }

        // ============================================
        // PAGE NAVIGATION
        // ============================================
        function showPage(pageId) {
            Haptics.pageTransition();
            
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.classList.add('hidden');
            });
            
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                requestAnimationFrame(() => {
                    targetPage.classList.add('active');
                });
                updateBottomNav(pageId);
            }
            
            // Hide SOS button and Voice Assistant on staff pages and landing
            const sosButton = document.getElementById('sos-button');
            const voiceBtn = document.getElementById('voice-assistant-btn');
            const requestTracker = document.getElementById('request-tracker');
            if (pageId === 'page-staff-dashboard' || pageId === 'page-staff-login' || pageId === 'page-landing') {
                sosButton.classList.add('hidden');
                voiceBtn.classList.add('hidden');
                requestTracker.classList.add('hidden');
            } else {
                sosButton.classList.remove('hidden');
                voiceBtn.classList.remove('hidden');
                // Show tracker if there's an active request
                if (state.activeRequest && state.activeRequest.status !== 'completed') {
                    requestTracker.classList.remove('hidden');
                }
            }
        }

        function updateBottomNav(pageId) {
            const navButtons = document.querySelectorAll('nav button');
            const pageMap = {
                'page-commuter': 0,
                'page-trip-planner': 1,
                'page-stations': 2,
                'page-settings': 3
            };
            
            navButtons.forEach((btn, index) => {
                if (index === pageMap[pageId]) {
                    btn.classList.remove('text-gray-400');
                    btn.classList.add('text-yellow-400');
                } else {
                    btn.classList.add('text-gray-400');
                    btn.classList.remove('text-yellow-400');
                }
            });
        }

        // ============================================
        // i18n & ACCESSIBILITY
        // ============================================
        function changeLanguage(lang) {
            state.currentLang = lang;
            saveState();
            applyLanguage();
            
            // Update voice recognition language
            if (voiceRecognition) {
                voiceRecognition.lang = getVoiceLang();
            }
            
            // Update voice status display
            updateVoiceStatusInfo();
            
            // Update voice commands help if modal is open
            populateVoiceCommandsHelp();
        }

        function applyLanguage() {
            const translations = { ...TRANSLATIONS.en, ...TRANSLATIONS[state.currentLang] };
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[key]) {
                    el.textContent = translations[key];
                }
            });
            
            document.getElementById('language-select').value = state.currentLang;
            document.getElementById('settings-language').value = state.currentLang;
        }

        function t(key) {
            return { ...TRANSLATIONS.en, ...TRANSLATIONS[state.currentLang] }[key] || key;
        }

        function toggleLargeText() {
            Haptics.toggle();
            state.largeText = !state.largeText;
            saveState();
            applyAccessibilitySettings();
        }

        function toggleReduceMotion() {
            Haptics.toggle();
            state.reduceMotion = !state.reduceMotion;
            saveState();
            applyAccessibilitySettings();
        }
        
        function toggleHaptics() {
            state.hapticEnabled = !state.hapticEnabled;
            if (state.hapticEnabled) {
                Haptics.success(); // Give feedback that haptics are now on
            }
            saveState();
            updateToggleButtons();
        }

        function applyAccessibilitySettings() {
            document.body.style.fontSize = state.largeText ? '18px' : '';
            updateToggleButtons();
        }

        function updateToggleButtons() {
            const largeTextBtn = document.getElementById('toggle-large-text');
            const reduceMotionBtn = document.getElementById('toggle-reduce-motion');
            
            [largeTextBtn, reduceMotionBtn].forEach((btn, i) => {
                if (!btn) return;
                const isActive = i === 0 ? state.largeText : state.reduceMotion;
                btn.setAttribute('aria-checked', isActive);
                btn.classList.toggle('bg-yellow-400', isActive);
                btn.classList.toggle('bg-gray-700', !isActive);
                btn.querySelector('span').style.transform = isActive ? 'translateX(24px)' : 'translateX(0)';
            });
        }

        // ============================================
        // STATIONS
        // ============================================
        function getAllStations() {
            return [...STATIONS.purple, ...STATIONS.green, ...STATIONS.yellow].filter((s, i, arr) => 
                arr.findIndex(x => x.id === s.id) === i
            );
        }

        function getStationLine(stationId) {
            if (STATIONS.purple.find(s => s.id === stationId)) return 'purple';
            if (STATIONS.green.find(s => s.id === stationId)) return 'green';
            if (STATIONS.yellow.find(s => s.id === stationId)) return 'yellow';
            return 'purple';
        }

        function initializeCrowdLevels() {
            const levels = ['low', 'medium', 'high'];
            getAllStations().forEach(station => {
                if (!state.crowdLevels[station.id]) {
                    state.crowdLevels[station.id] = levels[Math.floor(Math.random() * 3)];
                }
            });
        }

        function populateStationSelects() {
            const allStations = getAllStations();
            const optionsHtml = allStations.map(s => 
                `<option value="${s.id}" class="bg-gray-900">${s.name}</option>`
            ).join('');
            
            ['trip-from', 'trip-to', 'assist-station'].forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.innerHTML = `<option value="" class="bg-gray-900">${t('select_station')}</option>` + optionsHtml;
                }
            });
        }

        function renderCrowdStatus() {
            const container = document.getElementById('crowd-list');
            if (!container) return;
            
            const html = getAllStations().slice(0, 6).map(station => {
                const level = state.crowdLevels[station.id] || 'low';
                const line = getStationLine(station.id);
                
                return `
                    <button onclick="showStationDetail('${station.id}')" class="w-full flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-colors text-left">
                        <div class="flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full line-${line}"></div>
                            <span class="font-medium">${station.name}</span>
                        </div>
                        <span class="crowd-${level} px-3 py-1 rounded-full text-xs font-bold text-white animate-pulse">
                            ${level.charAt(0).toUpperCase() + level.slice(1)}
                        </span>
                    </button>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function renderStationsList() {
            const container = document.getElementById('stations-list');
            if (!container) return;
            
            let stations = [];
            if (state.currentFilter === 'purple') stations = STATIONS.purple;
            else if (state.currentFilter === 'green') stations = STATIONS.green;
            else if (state.currentFilter === 'yellow') stations = STATIONS.yellow;
            else stations = getAllStations();
            
            const html = stations.map((station, index) => {
                const level = state.crowdLevels[station.id] || 'low';
                const line = getStationLine(station.id);
                
                return `
                    <button onclick="showStationDetail('${station.id}')" class="station-item w-full btn-press glass rounded-2xl p-4 flex items-center gap-4 hover:bg-white/5 transition-all text-left animate-slide-up" style="animation-delay: ${index * 0.05}s" data-station-name="${station.name.toLowerCase()}">
                        <div class="w-4 h-12 rounded-full line-${line}"></div>
                        <div class="flex-1">
                            <h3 class="font-bold">${station.name}</h3>
                            ${station.alias ? `<p class="text-sm text-gray-400">${station.alias}</p>` : ''}
                            ${station.isInterchange ? '<span class="text-xs text-yellow-400">‚áÑ Interchange</span>' : ''}
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="crowd-${level} px-2 py-1 rounded-full text-xs font-bold text-white">${level.toUpperCase()}</span>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </div>
                    </button>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function filterStations(filter) {
            Haptics.selection();
            state.currentFilter = filter;
            
            document.querySelectorAll('.filter-tab').forEach(tab => {
                if (tab.dataset.filter === filter) {
                    tab.classList.add('bg-yellow-400', 'text-black');
                } else {
                    tab.classList.remove('bg-yellow-400', 'text-black');
                }
            });
            
            const labels = { all: 'All Lines', purple: 'Purple Line', green: 'Green Line', yellow: 'Yellow Line' };
            const labelEl = document.getElementById('station-filter-label');
            if (labelEl) labelEl.textContent = labels[filter];
            
            renderStationsList();
            showPage('page-stations');
        }

        function filterStationsBySearch(query) {
            const items = document.querySelectorAll('.station-item');
            const q = query.toLowerCase();
            items.forEach(item => {
                item.style.display = item.dataset.stationName.includes(q) ? '' : 'none';
            });
        }

        function showStationDetail(stationId) {
            const station = getAllStations().find(s => s.id === stationId);
            if (!station) return;
            
            state.currentStation = station;
            const line = getStationLine(stationId);
            const lineNames = { purple: 'Purple Line', green: 'Green Line', yellow: 'Yellow Line' };
            
            document.getElementById('station-detail-name').textContent = station.name;
            document.getElementById('station-detail-line').textContent = lineNames[line];
            document.getElementById('station-hero-name').textContent = station.name;
            document.getElementById('station-hero-alias').textContent = station.alias || '';
            
            const crowdBadge = document.getElementById('station-crowd-badge');
            const level = state.crowdLevels[stationId] || 'low';
            crowdBadge.className = `crowd-${level} px-3 py-1 rounded-full text-xs font-bold text-white`;
            crowdBadge.textContent = level.toUpperCase();
            
            const lineBadge = document.getElementById('station-line-badge');
            lineBadge.className = `inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium line-${line} ${line === 'yellow' ? 'text-black' : 'text-white'}`;
            lineBadge.querySelector('span:last-child').textContent = lineNames[line];
            
            // Facilities
            const facilityIcons = {
                elevator: { icon: 'üõó', label: t('elevator') },
                ramp: { icon: '‚ôø', label: t('ramp') },
                tactile: { icon: 'üî≤', label: t('tactile') },
                wheelchair: { icon: 'ü¶Ω', label: t('wheelchair') },
                toilet: { icon: 'üöª', label: t('toilet') },
                assistance: { icon: 'üë®‚Äç‚úàÔ∏è', label: t('assistance') },
                interchange: { icon: '‚áÑ', label: t('interchange_facility') }
            };
            
            const facilitiesHtml = (station.facilities || []).map(f => {
                const facility = facilityIcons[f] || { icon: '‚úì', label: f };
                return `
                    <div class="glass rounded-xl p-3 text-center">
                        <div class="text-2xl mb-1">${facility.icon}</div>
                        <p class="text-xs text-gray-300">${facility.label}</p>
                    </div>
                `;
            }).join('');
            document.getElementById('facilities-grid').innerHTML = facilitiesHtml;
            
            // Bus stops
            const busStopsHtml = (station.busStops || []).map(stop => `
                <button onclick='showBusStopInfo(${JSON.stringify(stop)})' class="w-full flex items-center justify-between p-2 rounded-lg hover:bg-white/5 transition-colors text-left">
                    <div class="flex items-center gap-2">
                        <span class="text-blue-400">üöå</span>
                        <span>${stop.name}</span>
                    </div>
                    <span class="text-xs text-gray-400">${stop.distance}</span>
                </button>
            `).join('');
            document.getElementById('bus-stops-list').innerHTML = busStopsHtml || '<p class="text-gray-500">No nearby bus stops</p>';
            
            // Accessibility notes
            document.getElementById('accessibility-notes').innerHTML = `
                <div class="flex items-start gap-3">
                    <span class="text-green-400">‚úì</span>
                    <div><p class="font-medium">Step-free access</p><p class="text-sm text-gray-400">Elevator and ramps at all entries</p></div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-green-400">‚úì</span>
                    <div><p class="font-medium">Tactile path</p><p class="text-sm text-gray-400">Yellow tiles from entry to platform</p></div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-green-400">‚úì</span>
                    <div><p class="font-medium">Visual displays</p><p class="text-sm text-gray-400">LED screens for train info</p></div>
                </div>
            `;
            
            showPage('page-station-detail');
            
            // Initialize map after page transition
            setTimeout(() => initStationMap(station), 300);
        }

        function planTripFromStation() {
            if (state.currentStation) {
                document.getElementById('trip-from').value = state.currentStation.id;
            }
            showPage('page-trip-planner');
        }

        function requestHelpAtStation() {
            if (state.currentStation) {
                document.getElementById('assist-station').value = state.currentStation.id;
            }
            showAssistanceSheet();
        }

        // ============================================
        // TRIP PLANNER
        // ============================================
        function swapStations() {
            Haptics.doubleTap();
            const from = document.getElementById('trip-from');
            const to = document.getElementById('trip-to');
            [from.value, to.value] = [to.value, from.value];
        }

        function planTrip() {
            const fromId = document.getElementById('trip-from').value;
            const toId = document.getElementById('trip-to').value;
            
            if (!fromId || !toId) {
                showToast('Please select both stations', 'error');
                return;
            }
            
            if (fromId === toId) {
                showToast('Please select different stations', 'error');
                return;
            }
            
            Haptics.success();
            const route = calculateRoute(fromId, toId);
            state.currentRoute = route;
            renderRoute(route);
        }

        function calculateRoute(fromId, toId) {
            // Simplified routing - find stations and create path
            const allStations = getAllStations();
            const fromStation = allStations.find(s => s.id === fromId);
            const toStation = allStations.find(s => s.id === toId);
            
            const fromLine = getStationLine(fromId);
            const toLine = getStationLine(toId);
            
            let route = [];
            let needsInterchange = fromLine !== toLine;
            
            if (!needsInterchange) {
                const line = STATIONS[fromLine];
                const fromIdx = line.findIndex(s => s.id === fromId);
                const toIdx = line.findIndex(s => s.id === toId);
                
                if (fromIdx <= toIdx) {
                    route = line.slice(fromIdx, toIdx + 1);
                } else {
                    route = line.slice(toIdx, fromIdx + 1).reverse();
                }
            } else {
                // Cross-line travel via Majestic
                route = [fromStation, { id: 'majestic', name: 'Majestic', isInterchange: true }, toStation];
            }
            
            return {
                stations: route,
                needsInterchange,
                duration: route.length * 3
            };
        }

        function renderRoute(route) {
            document.getElementById('route-display').classList.remove('hidden');
            document.getElementById('route-station-count').textContent = route.stations.length;
            document.getElementById('route-time').textContent = `${route.duration} min`;
            
            document.getElementById('route-interchange').classList.toggle('hidden', !route.needsInterchange);
            
            const html = route.stations.map((station, index) => {
                const isFirst = index === 0;
                const isLast = index === route.stations.length - 1;
                const line = getStationLine(station.id);
                const level = state.crowdLevels[station.id] || 'low';
                
                return `
                    <div class="flex items-start gap-4" style="animation-delay: ${index * 0.1}s">
                        <div class="flex flex-col items-center">
                            <div class="w-4 h-4 rounded-full ${isFirst || isLast ? 'bg-yellow-400' : station.isInterchange ? 'bg-yellow-400 ring-4 ring-yellow-400/30 animate-pulse' : 'bg-white/30'}"></div>
                            ${!isLast ? `<div class="w-0.5 h-12 bg-gradient-to-b from-gray-500 to-gray-600"></div>` : ''}
                        </div>
                        <div class="flex-1 pb-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-bold ${isFirst || isLast ? 'text-yellow-400' : ''}">${station.name}</p>
                                    ${station.isInterchange ? '<p class="text-xs text-yellow-400">‚áÑ Change lines here</p>' : ''}
                                </div>
                                ${level ? `<span class="crowd-${level} px-2 py-0.5 rounded-full text-xs font-bold text-white">${level.charAt(0).toUpperCase()}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('route-visual').innerHTML = html;
        }

        // ============================================
        // VOICE & ASSISTANCE
        // ============================================
        function startVoiceGuidance() {
            const welcomeTexts = {
                en: 'Welcome to AccessiGo. Your accessible companion for Bengaluru Namma Metro.',
                hi: '‡§è‡§ï‡•ç‡§∏‡•á‡§∏‡•Ä‡§ó‡•ã ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à‡•§ ‡§¨‡•á‡§Ç‡§ó‡§≤‡•Å‡§∞‡•Å ‡§®‡§Æ‡•ç‡§Æ‡§æ ‡§Æ‡•á‡§ü‡•ç‡§∞‡•ã ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•Å‡§≤‡§≠ ‡§∏‡§æ‡§•‡•Ä‡•§',
                kn: '‡≤é‡≤ï‡≥ç‡≤∏‡≥Ü‡≤∏‡≤ø‡≤ó‡≥ã‡≤ó‡≥Ü ‡≤∏‡≥ç‡≤µ‡≤æ‡≤ó‡≤§. ‡≤¨‡≥Ü‡≤Ç‡≤ó‡≤≥‡≥Ç‡≤∞‡≥Å ‡≤®‡≤Æ‡≥ç‡≤Æ ‡≤Æ‡≥Ü‡≤ü‡≥ç‡≤∞‡≥ã‡≤ó‡≥Ü ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂‡≤Ø‡≥ã‡≤ó‡≥ç‡≤Ø ‡≤∏‡≤π‡≤ö‡≤∞.',
                ta: '‡ÆÜ‡Æï‡Øç‡Æö‡ØÜ‡Æö‡Æø‡Æï‡Øã‡Æµ‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç. ‡Æ™‡ØÜ‡Æô‡Øç‡Æï‡Æ≥‡ØÇ‡Æ∞‡Øç ‡Æ®‡ÆÆ‡Øç‡ÆÆ ‡ÆÆ‡ØÜ‡Æü‡Øç‡Æ∞‡Øã‡Æµ‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ© ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ£‡ØÅ‡Æï‡Æï‡Øç‡Æï‡ØÇ‡Æü‡Æø‡ÆØ ‡Æ§‡ØÅ‡Æ£‡Øà.',
                te: '‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡∞ø‡∞ó‡±ã‡∞ï‡±Å ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç. ‡∞¨‡±Ü‡∞Ç‡∞ó‡∞≥‡±Ç‡∞∞‡±Å ‡∞®‡∞Æ‡±ç‡∞Æ ‡∞Æ‡±Ü‡∞ü‡±ç‡∞∞‡±ã ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞Æ‡±Ä ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡∞ø‡∞¨‡±Å‡∞≤‡±ç ‡∞∏‡∞π‡∞ö‡∞∞‡±Å‡∞°‡±Å.',
                ml: '‡¥Ü‡¥ï‡µç‡¥∏‡¥∏‡¥ø‡¥ó‡µã‡¥Ø‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç. ‡¥¨‡µÜ‡¥Ç‡¥ó‡¥≥‡µÇ‡¥∞‡µÅ ‡¥®‡¥Æ‡µç‡¥Æ ‡¥Æ‡µÜ‡¥ü‡µç‡¥∞‡µã‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥≥‡µç‡¥≥ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥Ü‡¥ï‡µç‡¥∏‡¥∏‡¥ø‡¥¨‡¥ø‡µæ ‡¥ï‡µÇ‡¥ü‡µç‡¥ü‡¥æ‡¥≥‡¥ø.'
            };
            
            speak(welcomeTexts[state.currentLang] || welcomeTexts.en);
        }

        function readRouteAloud() {
            if (!state.currentRoute) {
                showToast('Please plan a route first', 'error');
                return;
            }
            
            const r = state.currentRoute;
            const lang = state.currentLang;
            
            // Generate route text in different languages
            const routeTexts = {
                en: () => {
                    let text = `Your route has ${r.stations.length} stations and takes about ${r.duration} minutes. `;
                    if (r.needsInterchange) text += 'You will need to change at Majestic. ';
                    text += `Starting from ${r.stations[0].name}, your destination is ${r.stations[r.stations.length - 1].name}.`;
                    return text;
                },
                hi: () => {
                    let text = `‡§Ü‡§™‡§ï‡•á ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§Æ‡•á‡§Ç ${r.stations.length} ‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§≤‡§ó‡§≠‡§ó ${r.duration} ‡§Æ‡§ø‡§®‡§ü ‡§≤‡§ó‡•á‡§Ç‡§ó‡•á‡•§ `;
                    if (r.needsInterchange) text += '‡§Ü‡§™‡§ï‡•ã ‡§Æ‡•à‡§ú‡•á‡§∏‡•ç‡§ü‡§ø‡§ï ‡§Æ‡•á‡§Ç ‡§ü‡•ç‡§∞‡•á‡§® ‡§¨‡§¶‡§≤‡§®‡•Ä ‡§π‡•ã‡§ó‡•Ä‡•§ ';
                    text += `${r.stations[0].name} ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§ï‡§∞, ‡§Ü‡§™‡§ï‡§æ ‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ${r.stations[r.stations.length - 1].name} ‡§π‡•à‡•§`;
                    return text;
                },
                kn: () => {
                    let text = `‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ${r.stations.length} ‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≤ø‡≤µ‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∏‡≥Å‡≤Æ‡≤æ‡≤∞‡≥Å ${r.duration} ‡≤®‡≤ø‡≤Æ‡≤ø‡≤∑‡≤ó‡≤≥‡≥Å ‡≤¨‡≥á‡≤ï‡≤æ‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü‡•§ `;
                    if (r.needsInterchange) text += '‡≤®‡≥Ä‡≤µ‡≥Å ‡≤Æ‡≥Ü‡≤ú‡≥Ü‡≤∏‡≥ç‡≤ü‡≤ø‡≤ï‡≥ç‚Äå‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∞‡≥à‡≤≤‡≥Å ‡≤¨‡≤¶‡≤≤‡≤æ‡≤Ø‡≤ø‡≤∏‡≤¨‡≥á‡≤ï‡≥Å‡•§ ';
                    text += `${r.stations[0].name} ‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø, ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤ó‡≤Æ‡≥ç‡≤Ø‡≤∏‡≥ç‡≤•‡≤æ‡≤® ${r.stations[r.stations.length - 1].name}.`;
                    return text;
                },
                ta: () => {
                    let text = `‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Ææ‡Æ§‡Øà‡ÆØ‡Æø‡Æ≤‡Øç ${r.stations.length} ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ©, ‡Æö‡ØÅ‡ÆÆ‡Ææ‡Æ∞‡Øç ${r.duration} ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÜ‡Æï‡ØÅ‡ÆÆ‡Øç. `;
                    if (r.needsInterchange) text += '‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æú‡Æ∏‡Øç‡Æü‡Æø‡Æï‡Øç‡Æï‡Æø‡Æ≤‡Øç ‡Æ∞‡ÆØ‡Æø‡Æ≤‡Øç ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ± ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç. ';
                    text += `${r.stations[0].name} ‡Æá‡Æ≤‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡Æø, ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Æï‡Øç‡Æï‡ØÅ ${r.stations[r.stations.length - 1].name}.`;
                    return text;
                },
                te: () => {
                    let text = `‡∞Æ‡±Ä ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç‡∞≤‡±ã ${r.stations.length} ‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç‡∞≤‡±Å ‡∞â‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø, ‡∞∏‡±Å‡∞Æ‡∞æ‡∞∞‡±Å ${r.duration} ‡∞®‡∞ø‡∞Æ‡∞ø‡∞∑‡∞æ‡∞≤‡±Å ‡∞™‡∞°‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø. `;
                    if (r.needsInterchange) text += '‡∞Æ‡±Ä‡∞∞‡±Å ‡∞Æ‡±Ü‡∞ú‡±Ü‡∞∏‡±ç‡∞ü‡∞ø‡∞ï‡±ç ‡∞µ‡∞¶‡±ç‡∞¶ ‡∞∞‡±à‡∞≤‡±Å ‡∞Æ‡∞æ‡∞∞‡∞æ‡∞≤‡∞ø. ';
                    text += `${r.stations[0].name} ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞ø, ‡∞Æ‡±Ä ‡∞ó‡∞Æ‡±ç‡∞Ø‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç ${r.stations[r.stations.length - 1].name}.`;
                    return text;
                },
                ml: () => {
                    let text = `‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥µ‡¥¥‡¥ø‡¥Ø‡¥ø‡µΩ ${r.stations.length} ‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥∑‡¥®‡µÅ‡¥ï‡¥≥‡µÅ‡¥£‡µç‡¥ü‡µç, ‡¥è‡¥ï‡¥¶‡µá‡¥∂‡¥Ç ${r.duration} ‡¥Æ‡¥ø‡¥®‡¥ø‡¥±‡µç‡¥±‡µç ‡¥é‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç. `;
                    if (r.needsInterchange) text += '‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥Æ‡µÜ‡¥ú‡¥∏‡µç‡¥±‡µç‡¥±‡¥ø‡¥ï‡µç‡¥ï‡¥ø‡µΩ ‡¥ü‡µç‡¥∞‡µÜ‡¥Ø‡¥ø‡µª ‡¥Æ‡¥æ‡¥±‡¥£‡¥Ç. ';
                    text += `${r.stations[0].name} ‡¥Æ‡µÅ‡¥§‡µΩ ‡¥Ü‡¥∞‡¥Ç‡¥≠‡¥ø‡¥ö‡µç‡¥ö‡µç, ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥≤‡¥ï‡µç‡¥∑‡µç‡¥Ø‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥Ç ${r.stations[r.stations.length - 1].name}.`;
                    return text;
                }
            };
            
            const textGenerator = routeTexts[lang] || routeTexts.en;
            speak(textGenerator());
        }

        function speak(text) {
            const langCode = state.currentLang;
            
            // Language names for toast
            const langNames = {
                en: 'English',
                hi: '‡§π‡§ø‡§Ç‡§¶‡•Ä',
                kn: '‡≤ï‡≤®‡≥ç‡≤®‡≤°',
                ta: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç',
                te: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å',
                ml: '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç'
            };
            
            showToast(`üîä Speaking in ${langNames[langCode]}...`, 'info');
            
            const onComplete = () => {
                showToast('‚úì Finished speaking', 'success');
            };
            
            // Check if native voice is available
            ensureVoicesLoaded().then(() => {
                const hasNative = hasNativeVoice(langCode);
                
                if (hasNative) {
                    // Use native Web Speech API
                    window.speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = getVoiceLang();
                    
                    const voice = getBestVoice(langCode);
                    if (voice) {
                        utterance.voice = voice;
                        console.log(`Voice Guidance using: ${voice.name} (${voice.lang})`);
                    }
                    
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    
                    utterance.onend = onComplete;
                    utterance.onerror = (e) => {
                        console.error('Native TTS error, trying Google TTS:', e);
                        speakWithGoogleTTS(text, langCode, onComplete);
                    };
                    
                    window.speechSynthesis.speak(utterance);
                } else {
                    // Use Google Translate TTS
                    console.log(`Using Google TTS for voice guidance (${langCode})`);
                    speakWithGoogleTTS(text, langCode, onComplete);
                }
            });
        }

        function showAssistanceSheet() {
            Haptics.sheetOpen();
            const sheet = document.getElementById('assistance-sheet');
            sheet.classList.remove('hidden');
            setTimeout(() => sheet.querySelector('.bottom-sheet').classList.add('open'), 10);
        }

        function hideAssistanceSheet() {
            Haptics.light();
            const sheet = document.getElementById('assistance-sheet');
            sheet.querySelector('.bottom-sheet').classList.remove('open');
            setTimeout(() => sheet.classList.add('hidden'), 400);
        }

        function submitAssistanceRequest(e) {
            e.preventDefault();
            Haptics.success();
            
            const stationId = document.getElementById('assist-station').value;
            const station = getAllStations().find(s => s.id === stationId);
            
            state.assistanceRequest = {
                id: Date.now(),
                station: station?.name,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            let requests = JSON.parse(localStorage.getItem('assistance-requests') || '[]');
            requests.push(state.assistanceRequest);
            localStorage.setItem('assistance-requests', JSON.stringify(requests));
            
            hideAssistanceSheet();
            showDynamicIsland();
            showToast('‚úì Request submitted!', 'success');
            
            setTimeout(() => {
                Haptics.notification();
                updateDynamicIsland('accepted');
            }, 5000);
            renderStaffDashboard();
        }

        function showDynamicIsland() {
            const island = document.getElementById('dynamic-island');
            island.classList.remove('hidden');
            island.classList.add('flex');
        }

        function updateDynamicIsland(status) {
            const text = document.getElementById('island-text');
            const dot = document.getElementById('island-dot');
            
            const states = {
                pending: { text: '‚è≥ Request Pending...', color: 'bg-yellow-400' },
                accepted: { text: '‚úì Staff En Route', color: 'bg-blue-400' },
                processing: { text: 'üö∂ Staff On The Way', color: 'bg-purple-400' },
                completed: { text: '‚úì Completed!', color: 'bg-green-400' }
            };
            
            const state = states[status] || states.pending;
            text.textContent = state.text;
            dot.className = `w-2 h-2 rounded-full ${state.color} animate-pulse`;
        }
        
        function showRequestDetails() {
            Haptics.light();
            if (state.activeRequest) {
                const req = state.activeRequest;
                const statusText = {
                    pending: 'Waiting for a staff member to accept your request...',
                    accepted: 'A staff member has accepted and is coming to help you!',
                    processing: 'Staff is on the way to your location.',
                    completed: 'Your request has been completed. Thank you!'
                };
                
                showToast(`üìç ${req.station}: ${statusText[req.status] || 'Request in progress'}`, 'info');
            }
        }

        // ============================================
        // NOTIFICATIONS & TOAST
        // ============================================
        function showNotificationHistory() {
            Haptics.sheetOpen();
            const sheet = document.getElementById('notification-sheet');
            document.getElementById('notification-list').innerHTML = state.notifications.length === 0 
                ? '<p class="text-center text-gray-400 py-8">No notifications yet</p>'
                : state.notifications.map(n => `
                    <div class="glass rounded-xl p-4">
                        <p class="font-bold">${n.title}</p>
                        <p class="text-sm text-gray-400">${n.body}</p>
                    </div>
                `).join('');
            
            sheet.classList.remove('hidden');
            setTimeout(() => sheet.querySelector('.bottom-sheet').classList.add('open'), 10);
        }

        function hideNotificationHistory() {
            Haptics.light();
            const sheet = document.getElementById('notification-sheet');
            sheet.querySelector('.bottom-sheet').classList.remove('open');
            setTimeout(() => sheet.classList.add('hidden'), 400);
        }

        function showToast(message, type = 'info') {
            // Haptic feedback based on toast type
            if (type === 'success') Haptics.success();
            else if (type === 'error') Haptics.error();
            else Haptics.notification();
            
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const colors = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-blue-500' };
            
            toast.className = `toast glass rounded-xl px-6 py-3 ${colors[type]} shadow-lg`;
            toast.innerHTML = `<span class="text-white font-medium">${message}</span>`;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ============================================
        // STAFF PORTAL
        // ============================================
        function staffLogin(e) {
            e.preventDefault();
            if (document.getElementById('staff-password').value === 'staff123') {
                Haptics.success();
                showPage('page-staff-dashboard');
                showToast('Welcome, Staff Member!', 'success');
            } else {
                Haptics.error();
                showToast('Invalid credentials', 'error');
            }
        }

        function staffLogout() {
            Haptics.medium();
            showPage('page-landing');
        }

        function renderStaffDashboard() {
            const requestsContainer = document.getElementById('staff-requests-list');
            const crowdContainer = document.getElementById('crowd-control-list');
            if (!requestsContainer || !crowdContainer) return;
            
            const requests = JSON.parse(localStorage.getItem('assistance-requests') || '[]');
            const active = requests.filter(r => r.status !== 'completed');
            
            document.getElementById('stat-active-requests').textContent = active.length;
            
            requestsContainer.innerHTML = active.length === 0 
                ? '<p class="text-gray-400 text-center py-8">No active requests</p>'
                : active.map(req => `
                    <div class="bg-gray-900 rounded-2xl p-4 border border-gray-800">
                        <div class="flex justify-between mb-2">
                            <p class="font-bold">${req.station}</p>
                            <span class="px-2 py-1 rounded-full text-xs font-bold ${req.status === 'pending' ? 'bg-yellow-500/20 text-yellow-400' : 'bg-green-500/20 text-green-400'}">${req.status.toUpperCase()}</span>
                        </div>
                        <button onclick="acceptRequest('${req.id}')" class="w-full mt-2 py-2 rounded-lg bg-green-500 text-white text-sm font-medium">${req.status === 'pending' ? 'Accept' : 'Complete'}</button>
                    </div>
                `).join('');
            
            crowdContainer.innerHTML = getAllStations().slice(0, 8).map(station => {
                const level = state.crowdLevels[station.id] || 'low';
                return `
                    <div class="bg-gray-900 rounded-2xl p-4 border border-gray-800">
                        <div class="flex justify-between mb-3">
                            <p class="font-medium">${station.name}</p>
                            <span class="crowd-${level} px-2 py-1 rounded-full text-xs font-bold text-white">${level.toUpperCase()}</span>
                        </div>
                        <div class="flex gap-2">
                            ${['low', 'medium', 'high'].map(l => `
                                <button onclick="setCrowdLevel('${station.id}', '${l}')" class="flex-1 py-2 rounded-lg text-sm font-medium ${level === l ? (l === 'low' ? 'bg-green-500' : l === 'medium' ? 'bg-yellow-500' : 'bg-red-500') + ' text-white' : 'bg-gray-800 text-gray-400'}">${l.charAt(0).toUpperCase()}</button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function acceptRequest(id) {
            let requests = JSON.parse(localStorage.getItem('assistance-requests') || '[]');
            requests = requests.map(r => r.id == id ? { ...r, status: r.status === 'pending' ? 'accepted' : 'completed' } : r);
            localStorage.setItem('assistance-requests', JSON.stringify(requests));
            renderStaffDashboard();
            showToast('Request updated', 'success');
        }

        function setCrowdLevel(stationId, level) {
            state.crowdLevels[stationId] = level;
            saveState();
            renderCrowdStatus();
            renderStaffDashboard();
            renderStationsList();
        }

        // ============================================
        // SOS & HELP REQUEST SYSTEM
        // ============================================
        function triggerSOS() {
            Haptics.heavy();
            // Populate SOS station dropdown
            const sosStationSelect = document.getElementById('sos-station');
            const allStations = getAllStations();
            sosStationSelect.innerHTML = allStations.map(s => 
                `<option value="${s.id}" class="bg-gray-900">${s.name}</option>`
            ).join('');
            
            document.getElementById('sos-modal').classList.remove('hidden');
        }
        
        function cancelSOS() {
            Haptics.light();
            document.getElementById('sos-modal').classList.add('hidden');
        }
        
        function confirmSOS() {
            Haptics.error(); // Strong vibration for SOS
            
            const stationId = document.getElementById('sos-station').value;
            const emergencyType = document.getElementById('sos-type').value;
            const station = getAllStations().find(s => s.id === stationId);
            
            const emergencyLabels = {
                medical: 'üöë Medical Emergency',
                safety: 'üö® Safety Concern',
                lost: 'üë§ Lost / Disoriented',
                accessibility: '‚ôø Accessibility Help',
                other: '‚ùó Other Emergency'
            };
            
            const sosRequest = {
                id: Date.now(),
                station: station?.name || 'Unknown',
                stationId: stationId,
                type: emergencyType,
                typeLabel: emergencyLabels[emergencyType],
                status: 'pending',
                isSOS: true,
                createdAt: new Date().toISOString(),
                acceptedBy: null,
                acceptedAt: null,
                completedAt: null
            };
            
            // Save to localStorage (simulating Firestore)
            let requests = JSON.parse(localStorage.getItem('help-requests') || '[]');
            requests.unshift(sosRequest); // Add to beginning
            localStorage.setItem('help-requests', JSON.stringify(requests));
            
            // Update state and UI
            state.activeRequest = sosRequest;
            saveState();
            
            document.getElementById('sos-modal').classList.add('hidden');
            showRequestTracker(sosRequest);
            showToast('üö® SOS Alert Sent! Help is on the way.', 'error');
            
            // Add to notifications
            addNotification('SOS Alert Sent', `Emergency help requested at ${station?.name}`);
            
            // Update staff dashboard
            renderStaffDashboard();
        }
        
        function showRequestTracker(request) {
            const tracker = document.getElementById('request-tracker');
            tracker.classList.remove('hidden');
            updateRequestTracker(request);
        }
        
        function hideRequestTracker() {
            document.getElementById('request-tracker').classList.add('hidden');
        }
        
        function updateRequestTracker(request) {
            if (!request) return;
            
            const statusMessages = {
                pending: { text: 'Waiting for staff...', icon: '‚è≥', iconBg: 'bg-yellow-500' },
                accepted: { text: 'Staff accepted your request', icon: 'üëã', iconBg: 'bg-blue-500' },
                processing: { text: 'Staff is on the way!', icon: 'üö∂', iconBg: 'bg-purple-500' },
                completed: { text: 'Request completed', icon: '‚úì', iconBg: 'bg-green-500' }
            };
            
            const status = statusMessages[request.status] || statusMessages.pending;
            
            document.getElementById('tracker-icon').className = `w-10 h-10 rounded-full ${status.iconBg} flex items-center justify-center`;
            document.getElementById('tracker-icon').innerHTML = `<span class="text-xl">${status.icon}</span>`;
            document.getElementById('tracker-status').textContent = status.text;
            document.getElementById('tracker-station').textContent = request.station + (request.isSOS ? ' (SOS)' : '');
            
            // Update progress bar
            const progress1 = document.getElementById('progress-1');
            const progress2 = document.getElementById('progress-2');
            const progress3 = document.getElementById('progress-3');
            
            progress1.className = 'flex-1 h-1.5 rounded-full bg-yellow-500';
            progress2.className = 'flex-1 h-1.5 rounded-full ' + (request.status === 'accepted' || request.status === 'processing' || request.status === 'completed' ? 'bg-blue-500' : 'bg-gray-600');
            progress3.className = 'flex-1 h-1.5 rounded-full ' + (request.status === 'completed' ? 'bg-green-500' : 'bg-gray-600');
            
            if (request.status === 'completed') {
                setTimeout(() => {
                    hideRequestTracker();
                    state.activeRequest = null;
                    saveState();
                }, 3000);
            }
        }
        
        function cancelActiveRequest() {
            Haptics.medium();
            if (state.activeRequest) {
                let requests = JSON.parse(localStorage.getItem('help-requests') || '[]');
                requests = requests.filter(r => r.id !== state.activeRequest.id);
                localStorage.setItem('help-requests', JSON.stringify(requests));
                
                state.activeRequest = null;
                saveState();
                hideRequestTracker();
                hideDynamicIsland();
                showToast('Request cancelled', 'info');
                renderStaffDashboard();
            }
        }
        
        function hideDynamicIsland() {
            const island = document.getElementById('dynamic-island');
            island.classList.add('hidden');
            island.classList.remove('flex');
        }
        
        // Updated submitAssistanceRequest to use new system
        function submitAssistanceRequest(e) {
            e.preventDefault();
            Haptics.success();
            
            const stationId = document.getElementById('assist-station').value;
            const assistType = document.getElementById('assist-type').value;
            const notes = document.getElementById('assist-notes').value;
            const station = getAllStations().find(s => s.id === stationId);
            
            const typeLabels = {
                wheelchair: '‚ôø Wheelchair Assistance',
                visual: 'üëÅÔ∏è Visual Impairment Guide',
                hearing: 'üëÇ Hearing Impairment Support',
                elderly: 'üë¥ Elderly Assistance',
                other: '‚ùì Other Assistance'
            };
            
            const request = {
                id: Date.now(),
                station: station?.name || 'Unknown',
                stationId: stationId,
                type: assistType,
                typeLabel: typeLabels[assistType],
                notes: notes,
                status: 'pending',
                isSOS: false,
                createdAt: new Date().toISOString(),
                acceptedBy: null,
                acceptedAt: null,
                completedAt: null
            };
            
            let requests = JSON.parse(localStorage.getItem('help-requests') || '[]');
            requests.unshift(request);
            localStorage.setItem('help-requests', JSON.stringify(requests));
            
            state.activeRequest = request;
            saveState();
            
            hideAssistanceSheet();
            showRequestTracker(request);
            showDynamicIsland();
            document.getElementById('island-text').textContent = '‚è≥ Waiting for staff...';
            showToast('‚úì Help request submitted!', 'success');
            
            addNotification('Help Request Sent', `Assistance requested at ${station?.name}`);
            renderStaffDashboard();
        }
        
        function addNotification(title, body) {
            state.notifications.unshift({
                id: Date.now(),
                title,
                body,
                createdAt: new Date().toISOString(),
                read: false
            });
            saveState();
        }
        
        // ============================================
        // STAFF REQUEST MANAGEMENT
        // ============================================
        function renderStaffDashboard() {
            const requestsContainer = document.getElementById('staff-requests-list');
            const sosContainer = document.getElementById('sos-requests-list');
            const crowdContainer = document.getElementById('crowd-control-list');
            const sosSection = document.getElementById('sos-section');
            const alertBadge = document.getElementById('staff-alert-badge');
            
            if (!requestsContainer || !crowdContainer) return;
            
            const requests = JSON.parse(localStorage.getItem('help-requests') || '[]');
            
            // Separate SOS and regular requests
            const sosRequests = requests.filter(r => r.isSOS && r.status !== 'completed');
            const regularRequests = requests.filter(r => !r.isSOS);
            const pendingRequests = requests.filter(r => r.status === 'pending');
            const processingRequests = requests.filter(r => r.status === 'accepted' || r.status === 'processing');
            const completedToday = requests.filter(r => {
                if (r.status !== 'completed') return false;
                const today = new Date().toDateString();
                return new Date(r.completedAt || r.createdAt).toDateString() === today;
            });
            
            // Update stats
            document.getElementById('stat-pending-requests').textContent = pendingRequests.length;
            document.getElementById('stat-processing').textContent = processingRequests.length;
            document.getElementById('stat-completed').textContent = completedToday.length;
            document.getElementById('stat-sos').textContent = sosRequests.length;
            
            // Show/hide SOS section and alert badge
            if (sosRequests.length > 0) {
                sosSection.classList.remove('hidden');
                alertBadge.classList.remove('hidden');
                
                sosContainer.innerHTML = sosRequests.map(req => renderRequestCard(req, true)).join('');
            } else {
                sosSection.classList.add('hidden');
                alertBadge.classList.add('hidden');
            }
            
            // Render all requests
            const activeRequests = regularRequests.filter(r => r.status !== 'completed');
            requestsContainer.innerHTML = activeRequests.length === 0 
                ? '<p class="text-gray-400 text-center py-8">No active requests</p>'
                : activeRequests.map(req => renderRequestCard(req, false)).join('');
            
            // Render crowd control
            crowdContainer.innerHTML = getAllStations().slice(0, 8).map(station => {
                const level = state.crowdLevels[station.id] || 'low';
                return `
                    <div class="bg-gray-900 rounded-2xl p-4 border border-gray-800">
                        <div class="flex justify-between mb-3">
                            <p class="font-medium">${station.name}</p>
                            <span class="crowd-${level} px-2 py-1 rounded-full text-xs font-bold text-white">${level.toUpperCase()}</span>
                        </div>
                        <div class="flex gap-2">
                            ${['low', 'medium', 'high'].map(l => `
                                <button onclick="setCrowdLevel('${station.id}', '${l}')" class="flex-1 py-2 rounded-lg text-sm font-medium ${level === l ? (l === 'low' ? 'bg-green-500' : l === 'medium' ? 'bg-yellow-500' : 'bg-red-500') + ' text-white' : 'bg-gray-800 text-gray-400'}">${l.charAt(0).toUpperCase()}</button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderRequestCard(req, isSOS) {
            const timeSince = getTimeSince(req.createdAt);
            const statusColors = {
                pending: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
                accepted: 'bg-blue-500/20 text-blue-400 border-blue-500/30',
                processing: 'bg-purple-500/20 text-purple-400 border-purple-500/30',
                completed: 'bg-green-500/20 text-green-400 border-green-500/30'
            };
            
            const bgClass = isSOS ? 'bg-red-950 border-red-800' : 'bg-gray-900 border-gray-800';
            
            let actionButton = '';
            if (req.status === 'pending') {
                actionButton = `<button onclick="acceptHelpRequest('${req.id}')" class="w-full mt-3 py-3 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold btn-press">
                    ‚úã Accept Request
                </button>`;
            } else if (req.status === 'accepted' || req.status === 'processing') {
                actionButton = `<button onclick="completeHelpRequest('${req.id}')" class="w-full mt-3 py-3 rounded-xl bg-gradient-to-r from-green-500 to-green-600 text-white font-bold btn-press">
                    ‚úì Mark as Done
                </button>`;
            }
            
            return `
                <div class="${bgClass} rounded-2xl p-4 border ${isSOS ? 'ring-2 ring-red-500/50' : ''}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                ${isSOS ? '<span class="text-red-400 font-bold">üö® SOS</span>' : ''}
                                <span class="font-bold">${req.station}</span>
                            </div>
                            <p class="text-sm text-gray-400">${req.typeLabel || req.type}</p>
                            ${req.notes ? `<p class="text-xs text-gray-500 mt-1">"${req.notes}"</p>` : ''}
                        </div>
                        <div class="text-right">
                            <span class="px-2 py-1 rounded-full text-xs font-bold border ${statusColors[req.status]}">${req.status.toUpperCase()}</span>
                            <p class="text-xs text-gray-500 mt-2 timer-pulse">‚è±Ô∏è ${timeSince}</p>
                        </div>
                    </div>
                    ${req.acceptedBy ? `<p class="text-xs text-blue-400 mb-2">üë§ Accepted by: ${req.acceptedBy}</p>` : ''}
                    ${actionButton}
                </div>
            `;
        }
        
        function getTimeSince(dateString) {
            const now = new Date();
            const then = new Date(dateString);
            const diffMs = now - then;
            const diffMins = Math.floor(diffMs / 60000);
            const diffSecs = Math.floor((diffMs % 60000) / 1000);
            
            if (diffMins < 1) return `${diffSecs}s ago`;
            if (diffMins < 60) return `${diffMins}m ago`;
            const diffHours = Math.floor(diffMins / 60);
            return `${diffHours}h ${diffMins % 60}m ago`;
        }
        
        function acceptHelpRequest(requestId) {
            Haptics.success();
            
            let requests = JSON.parse(localStorage.getItem('help-requests') || '[]');
            requests = requests.map(r => {
                if (r.id == requestId) {
                    return {
                        ...r,
                        status: 'accepted',
                        acceptedBy: 'Staff Member',
                        acceptedAt: new Date().toISOString()
                    };
                }
                return r;
            });
            localStorage.setItem('help-requests', JSON.stringify(requests));
            
            // Update commuter's view if they have this request active
            const acceptedRequest = requests.find(r => r.id == requestId);
            if (state.activeRequest && state.activeRequest.id == requestId) {
                state.activeRequest = acceptedRequest;
                updateRequestTracker(acceptedRequest);
                updateDynamicIsland('accepted');
                Haptics.notification();
                showToast('‚úì Staff has accepted your request!', 'success');
                addNotification('Help Accepted', 'A staff member is coming to assist you.');
            }
            
            renderStaffDashboard();
            showToast('Request accepted! Go help the commuter.', 'success');
        }
        
        function completeHelpRequest(requestId) {
            Haptics.success();
            
            let requests = JSON.parse(localStorage.getItem('help-requests') || '[]');
            requests = requests.map(r => {
                if (r.id == requestId) {
                    return {
                        ...r,
                        status: 'completed',
                        completedAt: new Date().toISOString()
                    };
                }
                return r;
            });
            localStorage.setItem('help-requests', JSON.stringify(requests));
            
            // Update commuter's view if they have this request active
            const completedRequest = requests.find(r => r.id == requestId);
            if (state.activeRequest && state.activeRequest.id == requestId) {
                state.activeRequest = completedRequest;
                updateRequestTracker(completedRequest);
                hideDynamicIsland();
                Haptics.success();
                showToast('‚úì Your request has been completed!', 'success');
                addNotification('Help Completed', 'Thank you for using AccessiGo!');
            }
            
            renderStaffDashboard();
            showToast('Request completed! Great job! üéâ', 'success');
        }
        
        // Refresh timers more frequently
        setInterval(() => {
            if (document.getElementById('page-staff-dashboard').classList.contains('active')) {
                renderStaffDashboard();
            }
            
            // Check for updates to active request
            if (state.activeRequest) {
                const requests = JSON.parse(localStorage.getItem('help-requests') || '[]');
                const updatedRequest = requests.find(r => r.id === state.activeRequest.id);
                if (updatedRequest && updatedRequest.status !== state.activeRequest.status) {
                    state.activeRequest = updatedRequest;
                    updateRequestTracker(updatedRequest);
                    
                    if (updatedRequest.status === 'accepted') {
                        Haptics.notification();
                        updateDynamicIsland('accepted');
                        showToast('‚úì Staff has accepted your request!', 'success');
                    } else if (updatedRequest.status === 'completed') {
                        Haptics.success();
                        hideDynamicIsland();
                        showToast('‚úì Your request has been completed!', 'success');
                    }
                }
            }
        }, 2000);
        
        // Check for active request on load
        function checkActiveRequest() {
            if (state.activeRequest) {
                const requests = JSON.parse(localStorage.getItem('help-requests') || '[]');
                const currentRequest = requests.find(r => r.id === state.activeRequest.id);
                
                if (currentRequest && currentRequest.status !== 'completed') {
                    state.activeRequest = currentRequest;
                    showRequestTracker(currentRequest);
                    if (currentRequest.status === 'pending') {
                        showDynamicIsland();
                    }
                } else {
                    state.activeRequest = null;
                    saveState();
                }
            }
        }
        
        // ============================================
        // VOICE ASSISTANT SYSTEM
        // ============================================
        let voiceRecognition = null;
        let isListening = false;
        let voiceAssistantActive = false;
        
        // Initialize Speech Recognition
        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                voiceRecognition = new SpeechRecognition();
                voiceRecognition.continuous = false;
                voiceRecognition.interimResults = true;
                voiceRecognition.lang = getVoiceLang();
                
                voiceRecognition.onstart = () => {
                    isListening = true;
                    updateVoiceUI('listening');
                    Haptics.medium();
                };
                
                voiceRecognition.onresult = (event) => {
                    let transcript = '';
                    let isFinal = false;
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            isFinal = true;
                        }
                    }
                    
                    document.getElementById('voice-transcript').textContent = `"${transcript}"`;
                    
                    if (isFinal) {
                        processVoiceCommand(transcript.toLowerCase().trim());
                    }
                };
                
                voiceRecognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    isListening = false;
                    updateVoiceUI('error');
                    
                    if (event.error === 'no-speech') {
                        speakResponse("I didn't hear anything. Please try again.");
                    } else if (event.error === 'not-allowed') {
                        speakResponse("Microphone access was denied. Please enable it in your browser settings.");
                    } else {
                        speakResponse("Sorry, I couldn't understand. Please try again.");
                    }
                };
                
                voiceRecognition.onend = () => {
                    isListening = false;
                    if (voiceAssistantActive) {
                        updateVoiceUI('idle');
                    }
                };
                
                return true;
            }
            return false;
        }
        
        function getVoiceLang() {
            const langMap = {
                'en': 'en-IN',
                'hi': 'hi-IN',
                'kn': 'kn-IN',
                'ta': 'ta-IN',
                'te': 'te-IN',
                'ml': 'ml-IN'
            };
            return langMap[state.currentLang] || 'en-IN';
        }
        
        function toggleVoiceAssistant() {
            Haptics.medium();
            if (voiceAssistantActive) {
                closeVoiceAssistant();
            } else {
                openVoiceAssistant();
            }
        }
        
        function openVoiceAssistant() {
            voiceAssistantActive = true;
            document.getElementById('voice-assistant-modal').classList.remove('hidden');
            document.getElementById('voice-assistant-btn').classList.add('listening');
            
            // Populate voice commands help based on language
            populateVoiceCommandsHelp();
            
            // Welcome message in current language
            speakLocalizedResponse('welcome');
        }
        
        function populateVoiceCommandsHelp() {
            const helpContainer = document.getElementById('voice-commands-help');
            if (!helpContainer) return;
            
            const commandExamples = {
                en: [
                    { cmd: '"Plan a trip"', desc: 'from MG Road to Majestic' },
                    { cmd: '"Crowd at Indiranagar"', desc: 'Check station crowd' },
                    { cmd: '"I need help"', desc: 'Request assistance' },
                    { cmd: '"Emergency" or "SOS"', desc: 'Trigger SOS alert' },
                    { cmd: '"Show stations"', desc: 'Navigate to stations' },
                    { cmd: '"Read my route"', desc: 'Audio navigation' }
                ],
                hi: [
                    { cmd: '"‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ"', desc: '‡§è‡§Æ‡§ú‡•Ä ‡§∞‡•ã‡§° ‡§∏‡•á ‡§Æ‡•à‡§ú‡•á‡§∏‡•ç‡§ü‡§ø‡§ï ‡§§‡§ï' },
                    { cmd: '"‡§≠‡•Ä‡§°‡§º ‡§ï‡§ø‡§§‡§®‡•Ä ‡§π‡•à"', desc: '‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§ï‡•Ä ‡§≠‡•Ä‡§°‡§º ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç' },
                    { cmd: '"‡§Æ‡§¶‡§¶ ‡§ö‡§æ‡§π‡§ø‡§è"', desc: '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡§∞‡•á‡§Ç' },
                    { cmd: '"‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤" ‡§Ø‡§æ "‡§è‡§∏‡§ì‡§è‡§∏"', desc: 'SOS ‡§Ö‡§≤‡§∞‡•ç‡§ü ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞ ‡§ï‡§∞‡•á‡§Ç' },
                    { cmd: '"‡§∏‡§≠‡•Ä ‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§¶‡§ø‡§ñ‡§æ‡§ì"', desc: '‡§∏‡•ç‡§ü‡•á‡§∂‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç' },
                    { cmd: '"‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§™‡§¢‡§º‡•ã"', desc: '‡§ë‡§°‡§ø‡§Ø‡•ã ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§®' }
                ],
                kn: [
                    { cmd: '"‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Ø‡≥ã‡≤ú‡≤ø‡≤∏‡≤ø"', desc: '‡≤é‡≤Ç‡≤ú‡≤ø ‡≤∞‡≥ã‡≤°‡≥ç‚Äå‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤Æ‡≥Ü‡≤ú‡≥Ü‡≤∏‡≥ç‡≤ü‡≤ø‡≤ï‡≥ç‚Äå‡≤ó‡≥Ü' },
                    { cmd: '"‡≤ú‡≤®‡≤∏‡≤Ç‡≤¶‡≤£‡≤ø ‡≤é‡≤∑‡≥ç‡≤ü‡≥Å"', desc: '‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤¶ ‡≤ú‡≤®‡≤∏‡≤Ç‡≤¶‡≤£‡≤ø ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤ø‡≤∏‡≤ø' },
                    { cmd: '"‡≤∏‡≤π‡≤æ‡≤Ø ‡≤¨‡≥á‡≤ï‡≥Å"', desc: '‡≤∏‡≤π‡≤æ‡≤Ø ‡≤ï‡≥ã‡≤∞‡≤ø' },
                    { cmd: '"‡≤§‡≥Å‡≤∞‡≥ç‡≤§‡≥Å" ‡≤Ö‡≤•‡≤µ‡≤æ "‡≤é‡≤∏‡≥ç‡≤ì‡≤é‡≤∏‡≥ç"', desc: 'SOS ‡≤Ö‡≤≤‡≤∞‡≥ç‡≤ü‡≥ç' },
                    { cmd: '"‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≥ã‡≤∞‡≤ø‡≤∏‡≤ø"', desc: '‡≤®‡≤ø‡≤≤‡≥ç‡≤¶‡≤æ‡≤£‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤π‡≥ã‡≤ó‡≤ø' },
                    { cmd: '"‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó ‡≤ì‡≤¶‡≤ø"', desc: '‡≤Ü‡≤°‡≤ø‡≤Ø‡≥ã ‡≤®‡≥ç‡≤Ø‡≤æ‡≤µ‡≤ø‡≤ó‡≥á‡≤∂‡≤®‡≥ç' }
                ],
                ta: [
                    { cmd: '"‡Æ™‡ÆØ‡Æ£‡ÆÆ‡Øç ‡Æ§‡Æø‡Æü‡Øç‡Æü‡ÆÆ‡Æø‡Æü‡ØÅ"', desc: 'MG ‡Æ∞‡Øã‡Æü‡Æø‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡ÆÆ‡Æú‡Æ∏‡Øç‡Æü‡Æø‡Æï‡Øç' },
                    { cmd: '"‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç ‡Æé‡Æµ‡Øç‡Æµ‡Æ≥‡Æµ‡ØÅ"', desc: '‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç' },
                    { cmd: '"‡Æâ‡Æ§‡Æµ‡Æø ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç"', desc: '‡Æâ‡Æ§‡Æµ‡Æø ‡Æï‡Øã‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç' },
                    { cmd: '"‡ÆÖ‡Æµ‡Æö‡Æ∞‡ÆÆ‡Øç" ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ "SOS"', desc: 'SOS ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà' },
                    { cmd: '"‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æü‡ØÅ"', desc: '‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç' },
                    { cmd: '"‡Æµ‡Æ¥‡Æø ‡Æ™‡Æü‡Æø"', desc: '‡ÆÜ‡Æü‡Æø‡ÆØ‡Øã ‡Æµ‡Æ¥‡Æø‡Æö‡ØÜ‡Æ≤‡ØÅ‡Æ§‡Øç‡Æ§‡Æ≤‡Øç' }
                ],
                te: [
                    { cmd: '"‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£‡∞Ç ‡∞™‡±ç‡∞≤‡∞æ‡∞®‡±ç ‡∞ö‡±á‡∞Ø‡∞ø"', desc: 'MG ‡∞∞‡±ã‡∞°‡±ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞Æ‡±Ü‡∞ú‡±Ü‡∞∏‡±ç‡∞ü‡∞ø‡∞ï‡±ç' },
                    { cmd: '"‡∞∞‡∞¶‡±ç‡∞¶‡±Ä ‡∞é‡∞Ç‡∞§"', desc: '‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç ‡∞∞‡∞¶‡±ç‡∞¶‡±Ä ‡∞§‡∞®‡∞ø‡∞ñ‡±Ä' },
                    { cmd: '"‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡∞ø"', desc: '‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ï‡±ã‡∞∞‡∞Ç‡∞°‡∞ø' },
                    { cmd: '"‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞‡∞Ç" ‡∞≤‡±á‡∞¶‡∞æ "SOS"', desc: 'SOS ‡∞Ö‡∞≤‡∞∞‡±ç‡∞ü‡±ç' },
                    { cmd: '"‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç‡∞≤‡±Å ‡∞ö‡±Ç‡∞™‡∞ø‡∞Ç‡∞ö‡±Å"', desc: '‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç‡∞≤‡∞ï‡±Å ‡∞µ‡±Ü‡∞≥‡±ç‡∞≥‡∞Ç‡∞°‡∞ø' },
                    { cmd: '"‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç ‡∞ö‡∞¶‡±Å‡∞µ‡±Å"', desc: '‡∞Ü‡∞°‡∞ø‡∞Ø‡±ã ‡∞®‡∞æ‡∞µ‡∞ø‡∞ó‡±á‡∞∑‡∞®‡±ç' }
                ],
                ml: [
                    { cmd: '"‡¥Ø‡¥æ‡¥§‡µç‡¥∞ ‡¥™‡µç‡¥≤‡¥æ‡µª ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï"', desc: 'MG ‡¥±‡µã‡¥°‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥Æ‡µÜ‡¥ú‡¥∏‡µç‡¥±‡µç‡¥±‡¥ø‡¥ï‡µç' },
                    { cmd: '"‡¥§‡¥ø‡¥∞‡¥ï‡µç‡¥ï‡µç ‡¥é‡¥§‡µç‡¥∞"', desc: '‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥∑‡µª ‡¥§‡¥ø‡¥∞‡¥ï‡µç‡¥ï‡µç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï' },
                    { cmd: '"‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥µ‡µá‡¥£‡¥Ç"', desc: '‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥Ü‡¥µ‡¥∂‡µç‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥ï' },
                    { cmd: '"‡¥Ö‡¥ü‡¥ø‡¥Ø‡¥®‡µç‡¥§‡¥ø‡¥∞‡¥Ç" ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ "SOS"', desc: 'SOS ‡¥Ö‡¥≤‡µº‡¥ü‡µç‡¥ü‡µç' },
                    { cmd: '"‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥∑‡¥®‡µÅ‡¥ï‡µæ ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï"', desc: '‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥∑‡¥®‡µÅ‡¥ï‡¥≥‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥ï' },
                    { cmd: '"‡¥µ‡¥¥‡¥ø ‡¥µ‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï"', desc: '‡¥ì‡¥°‡¥ø‡¥Ø‡µã ‡¥®‡¥æ‡¥µ‡¥ø‡¥ó‡µá‡¥∑‡µª' }
                ]
            };
            
            const examples = commandExamples[state.currentLang] || commandExamples.en;
            
            helpContainer.innerHTML = examples.map(ex => `
                <div class="glass rounded-xl p-3">
                    <p class="text-purple-400 font-medium">${ex.cmd}</p>
                    <p class="text-gray-400">${ex.desc}</p>
                </div>
            `).join('');
        }
        
        function closeVoiceAssistant() {
            Haptics.light();
            voiceAssistantActive = false;
            stopListening();
            document.getElementById('voice-assistant-modal').classList.add('hidden');
            document.getElementById('voice-assistant-btn').classList.remove('listening');
            window.speechSynthesis.cancel();
        }
        
        function startListening() {
            if (!voiceRecognition) {
                if (!initVoiceRecognition()) {
                    speakResponse("Sorry, voice recognition is not supported in your browser. Please try Chrome or Edge.");
                    return;
                }
            }
            
            if (isListening) return;
            
            voiceRecognition.lang = getVoiceLang();
            
            try {
                voiceRecognition.start();
                Haptics.medium();
            } catch (e) {
                console.error('Error starting recognition:', e);
            }
        }
        
        function stopListening() {
            if (voiceRecognition && isListening) {
                voiceRecognition.stop();
                isListening = false;
                updateVoiceUI('idle');
            }
        }
        
        function updateVoiceUI(status) {
            const voiceStatus = document.getElementById('voice-status');
            const btnStart = document.getElementById('btn-start-listening');
            const btnStop = document.getElementById('btn-stop-listening');
            const modal = document.getElementById('voice-assistant-modal');
            const orbIcon = document.getElementById('orb-mic-icon');
            
            switch(status) {
                case 'listening':
                    voiceStatus.textContent = "Listening...";
                    voiceStatus.className = "text-2xl font-bold text-purple-400 mb-2";
                    btnStart.classList.add('hidden');
                    btnStop.classList.remove('hidden');
                    modal.classList.add('voice-listening');
                    orbIcon.innerHTML = `
                        <div class="voice-wave">
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                        </div>
                    `;
                    break;
                    
                case 'processing':
                    voiceStatus.textContent = "Processing...";
                    voiceStatus.className = "text-2xl font-bold text-yellow-400 mb-2";
                    modal.classList.remove('voice-listening');
                    orbIcon.innerHTML = `<svg class="w-16 h-16 text-white animate-spin" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>`;
                    break;
                    
                case 'speaking':
                    voiceStatus.textContent = "Speaking...";
                    voiceStatus.className = "text-2xl font-bold text-green-400 mb-2";
                    btnStart.classList.add('hidden');
                    btnStop.classList.add('hidden');
                    modal.classList.remove('voice-listening');
                    orbIcon.innerHTML = `<svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                    </svg>`;
                    break;
                    
                case 'error':
                    voiceStatus.textContent = "Error occurred";
                    voiceStatus.className = "text-2xl font-bold text-red-400 mb-2";
                    btnStart.classList.remove('hidden');
                    btnStop.classList.add('hidden');
                    modal.classList.remove('voice-listening');
                    resetOrbIcon();
                    break;
                    
                default: // idle
                    voiceStatus.textContent = "Tap to speak";
                    voiceStatus.className = "text-2xl font-bold text-white mb-2";
                    btnStart.classList.remove('hidden');
                    btnStop.classList.add('hidden');
                    modal.classList.remove('voice-listening');
                    resetOrbIcon();
            }
        }
        
        function resetOrbIcon() {
            document.getElementById('orb-mic-icon').innerHTML = `
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
            `;
        }
        
        // Get the best available voice for a language
        function getBestVoice(langCode) {
            const voices = window.speechSynthesis.getVoices();
            if (voices.length === 0) return null;
            
            const langMap = {
                'en': ['en-IN', 'en-GB', 'en-US', 'en'],
                'hi': ['hi-IN', 'hi'],
                'kn': ['kn-IN', 'kn'],
                'ta': ['ta-IN', 'ta'],
                'te': ['te-IN', 'te'],
                'ml': ['ml-IN', 'ml']
            };
            
            const preferredLangs = langMap[langCode] || langMap['en'];
            
            // Try to find a voice matching preferred languages
            for (const lang of preferredLangs) {
                const voice = voices.find(v => v.lang.startsWith(lang) || v.lang === lang);
                if (voice) return voice;
            }
            
            // Try partial match
            for (const lang of preferredLangs) {
                const voice = voices.find(v => v.lang.toLowerCase().includes(lang.split('-')[0]));
                if (voice) return voice;
            }
            
            // Return null if no matching voice (will use Google TTS fallback)
            return null;
        }
        
        // Check if a language has native voice support
        function hasNativeVoice(langCode) {
            const voice = getBestVoice(langCode);
            if (!voice) return false;
            
            // Check if the voice actually matches the language
            const langMap = {
                'en': ['en'],
                'hi': ['hi'],
                'kn': ['kn'],
                'ta': ['ta'],
                'te': ['te'],
                'ml': ['ml']
            };
            
            const prefixes = langMap[langCode] || ['en'];
            return prefixes.some(prefix => voice.lang.toLowerCase().startsWith(prefix));
        }
        
        // Use Google Translate TTS as fallback (works for all languages)
        function speakWithGoogleTTS(text, langCode, callback) {
            const langCodes = {
                'en': 'en',
                'hi': 'hi',
                'kn': 'kn',
                'ta': 'ta',
                'te': 'te',
                'ml': 'ml'
            };
            
            const lang = langCodes[langCode] || 'en';
            
            // Split text into chunks (Google TTS has a limit of ~200 chars)
            const chunks = splitTextIntoChunks(text, 180);
            
            let currentChunk = 0;
            
            function playNextChunk() {
                if (currentChunk >= chunks.length) {
                    if (callback) callback();
                    return;
                }
                
                const chunk = chunks[currentChunk];
                const url = `https://translate.google.com/translate_tts?ie=UTF-8&tl=${lang}&client=tw-ob&q=${encodeURIComponent(chunk)}`;
                
                const audio = new Audio(url);
                audio.playbackRate = 0.9;
                
                audio.onended = () => {
                    currentChunk++;
                    playNextChunk();
                };
                
                audio.onerror = (e) => {
                    console.error('Google TTS error:', e);
                    currentChunk++;
                    playNextChunk();
                };
                
                audio.play().catch(err => {
                    console.error('Audio play error:', err);
                    // Try native TTS as last resort
                    speakWithNativeTTS(chunk, langCode, () => {
                        currentChunk++;
                        playNextChunk();
                    });
                });
            }
            
            playNextChunk();
        }
        
        // Split text into smaller chunks for TTS
        function splitTextIntoChunks(text, maxLength) {
            const chunks = [];
            const sentences = text.split(/(?<=[.!?‡•§])\s+/);
            let currentChunk = '';
            
            for (const sentence of sentences) {
                if ((currentChunk + ' ' + sentence).length <= maxLength) {
                    currentChunk = currentChunk ? currentChunk + ' ' + sentence : sentence;
                } else {
                    if (currentChunk) chunks.push(currentChunk);
                    
                    // If single sentence is too long, split by words
                    if (sentence.length > maxLength) {
                        const words = sentence.split(' ');
                        currentChunk = '';
                        for (const word of words) {
                            if ((currentChunk + ' ' + word).length <= maxLength) {
                                currentChunk = currentChunk ? currentChunk + ' ' + word : word;
                            } else {
                                if (currentChunk) chunks.push(currentChunk);
                                currentChunk = word;
                            }
                        }
                    } else {
                        currentChunk = sentence;
                    }
                }
            }
            
            if (currentChunk) chunks.push(currentChunk);
            return chunks;
        }
        
        // Speak using native Web Speech API
        function speakWithNativeTTS(text, langCode, callback) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = getVoiceLang();
            
            const voice = getBestVoice(langCode);
            if (voice) {
                utterance.voice = voice;
            }
            
            utterance.rate = 0.9;
            utterance.pitch = 1;
            
            utterance.onend = () => {
                if (callback) callback();
            };
            
            utterance.onerror = () => {
                if (callback) callback();
            };
            
            window.speechSynthesis.speak(utterance);
        }
        
        // Ensure voices are loaded
        function ensureVoicesLoaded() {
            return new Promise((resolve) => {
                const voices = window.speechSynthesis.getVoices();
                if (voices.length > 0) {
                    resolve(voices);
                    return;
                }
                
                // Chrome loads voices asynchronously
                window.speechSynthesis.onvoiceschanged = () => {
                    resolve(window.speechSynthesis.getVoices());
                };
                
                // Timeout fallback
                setTimeout(() => resolve(window.speechSynthesis.getVoices()), 100);
            });
        }
        
        function speakResponse(text, callback) {
            const langCode = state.currentLang;
            
            // Update UI
            updateVoiceUI('speaking');
            document.getElementById('voice-transcript').textContent = text;
            Haptics.notification();
            
            // Language names for toast
            const langNames = {
                en: 'English',
                hi: '‡§π‡§ø‡§Ç‡§¶‡•Ä',
                kn: '‡≤ï‡≤®‡≥ç‡≤®‡≤°',
                ta: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç',
                te: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å',
                ml: '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç'
            };
            
            const onComplete = () => {
                if (voiceAssistantActive) {
                    updateVoiceUI('idle');
                }
                if (callback) callback();
            };
            
            // Check if native voice is available for this language
            ensureVoicesLoaded().then(() => {
                const hasNative = hasNativeVoice(langCode);
                
                if (hasNative) {
                    // Use native Web Speech API
                    console.log(`Using native voice for ${langCode}`);
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = getVoiceLang();
                    
                    const voice = getBestVoice(langCode);
                    if (voice) {
                        utterance.voice = voice;
                        console.log(`Voice: ${voice.name} (${voice.lang})`);
                    }
                    
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    
                    utterance.onend = onComplete;
                    utterance.onerror = (e) => {
                        console.error('Native TTS error, trying Google TTS:', e);
                        // Fallback to Google TTS
                        speakWithGoogleTTS(text, langCode, onComplete);
                    };
                    
                    window.speechSynthesis.speak(utterance);
                } else {
                    // Use Google Translate TTS for languages without native support
                    console.log(`Using Google TTS for ${langCode} (no native voice)`);
                    showToast(`üîä Speaking in ${langNames[langCode]}...`, 'info');
                    speakWithGoogleTTS(text, langCode, onComplete);
                }
            });
        }
        
        // ============================================
        // VOICE COMMAND PROCESSING (Multi-Language NLP)
        // ============================================
        function processVoiceCommand(command) {
            updateVoiceUI('processing');
            Haptics.success();
            
            console.log('Processing command:', command, 'Language:', state.currentLang);
            
            // Get commands for current language (fallback to English)
            const commands = { ...VOICE_COMMANDS.en, ...(VOICE_COMMANDS[state.currentLang] || {}) };
            const responses = { ...VOICE_RESPONSES.en, ...(VOICE_RESPONSES[state.currentLang] || {}) };
            
            // Normalize station names in command
            const normalizedCommand = normalizeStationNames(command);
            
            // Intent detection using multi-language keywords
            if (matchIntentMultiLang(command, 'emergency')) {
                handleEmergencyCommand();
            }
            else if (matchIntentMultiLang(command, 'trip')) {
                handleTripCommand(normalizedCommand);
            }
            else if (matchIntentMultiLang(command, 'crowd')) {
                handleCrowdCommand(normalizedCommand);
            }
            else if (matchIntentMultiLang(command, 'stations')) {
                handleStationsCommand(normalizedCommand);
            }
            else if (matchIntentMultiLang(command, 'help')) {
                handleAssistanceCommand(normalizedCommand);
            }
            else if (matchIntentMultiLang(command, 'home')) {
                handleNavigationCommand('home');
            }
            else if (matchIntentMultiLang(command, 'settings')) {
                handleNavigationCommand('settings');
            }
            else if (matchIntentMultiLang(command, 'read')) {
                handleReadRouteCommand();
            }
            else if (matchIntentMultiLang(command, 'location')) {
                handleLocationCommand();
            }
            else if (matchIntentMultiLang(command, 'map')) {
                handleMapCommand();
            }
            else if (matchIntentMultiLang(command, 'facilities')) {
                handleFacilitiesCommand(normalizedCommand);
            }
            else if (matchIntentMultiLang(command, 'language')) {
                handleLanguageCommand(command);
            }
            else if (matchIntentMultiLang(command, 'cancel')) {
                speakLocalizedResponse('goodbye', () => {
                    closeVoiceAssistant();
                });
            }
            else if (matchIntentMultiLang(command, 'hello')) {
                speakLocalizedResponse('hello');
            }
            else if (matchIntentMultiLang(command, 'thanks')) {
                speakLocalizedResponse('thanks');
            }
            else {
                speakLocalizedResponse('notUnderstood');
            }
        }
        
        // Match intent using multi-language keywords
        function matchIntentMultiLang(command, intentType) {
            const lang = state.currentLang;
            const commandLower = command.toLowerCase();
            
            // Check current language keywords first
            if (VOICE_COMMANDS[lang] && VOICE_COMMANDS[lang][intentType]) {
                if (VOICE_COMMANDS[lang][intentType].some(kw => commandLower.includes(kw.toLowerCase()))) {
                    return true;
                }
            }
            
            // Fallback to English keywords
            if (VOICE_COMMANDS.en[intentType]) {
                if (VOICE_COMMANDS.en[intentType].some(kw => commandLower.includes(kw.toLowerCase()))) {
                    return true;
                }
            }
            
            return false;
        }
        
        // Get localized response
        function getLocalizedResponse(key, replacements = {}) {
            const lang = state.currentLang;
            let response = (VOICE_RESPONSES[lang] && VOICE_RESPONSES[lang][key]) 
                ? VOICE_RESPONSES[lang][key] 
                : VOICE_RESPONSES.en[key] || key;
            
            // Replace placeholders
            Object.entries(replacements).forEach(([k, v]) => {
                response = response.replace(`{${k}}`, v);
            });
            
            return response;
        }
        
        // Speak localized response
        function speakLocalizedResponse(key, callback, replacements = {}) {
            const response = getLocalizedResponse(key, replacements);
            speakResponse(response, callback);
        }
        
        function matchIntent(command, keywords) {
            return keywords.some(keyword => command.includes(keyword));
        }
        
        function normalizeStationNames(command) {
            // Replace common aliases
            const aliases = {
                'mg road': 'mahatma gandhi road',
                'm g road': 'mahatma gandhi road',
                'kempegowda': 'nadaprabhu kempegowda station',
                'mantri': 'mantri square sampige road',
                'sampige': 'mantri square sampige road',
                'lalbagh': 'lalbagh botanical garden',
                'peenya': 'peenya industry',
                'silk board': 'silk board junction',
                'silkboard': 'silk board junction'
            };
            
            let normalized = command;
            Object.entries(aliases).forEach(([alias, full]) => {
                normalized = normalized.replace(alias, full);
            });
            return normalized;
        }
        
        function findStationInCommand(command) {
            const allStations = getAllStations();
            
            // First try exact match
            for (const station of allStations) {
                if (command.includes(station.name.toLowerCase())) {
                    return station;
                }
                if (station.alias && command.includes(station.alias.toLowerCase())) {
                    return station;
                }
            }
            
            // Try partial match
            for (const station of allStations) {
                const words = station.name.toLowerCase().split(' ');
                for (const word of words) {
                    if (word.length > 3 && command.includes(word)) {
                        return station;
                    }
                }
            }
            
            return null;
        }
        
        function findTwoStationsInCommand(command) {
            const allStations = getAllStations();
            const found = [];
            
            // Find "from X to Y" pattern
            const fromToMatch = command.match(/from\s+(.+?)\s+to\s+(.+?)(?:\s|$|\.)/i);
            if (fromToMatch) {
                const fromQuery = fromToMatch[1].toLowerCase();
                const toQuery = fromToMatch[2].toLowerCase();
                
                const fromStation = findBestStationMatch(fromQuery, allStations);
                const toStation = findBestStationMatch(toQuery, allStations);
                
                if (fromStation && toStation) {
                    return [fromStation, toStation];
                }
            }
            
            // Try finding two stations mentioned
            for (const station of allStations) {
                const nameLower = station.name.toLowerCase();
                if (command.includes(nameLower) || (station.alias && command.includes(station.alias.toLowerCase()))) {
                    found.push(station);
                    if (found.length === 2) break;
                }
            }
            
            return found.length === 2 ? found : null;
        }
        
        function findBestStationMatch(query, stations) {
            // Exact match first
            for (const station of stations) {
                if (query.includes(station.name.toLowerCase()) || station.name.toLowerCase().includes(query)) {
                    return station;
                }
                if (station.alias && (query.includes(station.alias.toLowerCase()) || station.alias.toLowerCase().includes(query))) {
                    return station;
                }
            }
            
            // Partial word match
            for (const station of stations) {
                const words = station.name.toLowerCase().split(' ');
                for (const word of words) {
                    if (word.length > 3 && query.includes(word)) {
                        return station;
                    }
                }
            }
            
            return null;
        }
        
        // ============================================
        // VOICE COMMAND HANDLERS (Multi-Language)
        // ============================================
        function handleEmergencyCommand() {
            speakLocalizedResponse('triggeringSOS', () => {
                closeVoiceAssistant();
                triggerSOS();
            });
        }
        
        function handleTripCommand(command) {
            const stations = findTwoStationsInCommand(command);
            
            if (stations && stations.length === 2) {
                const [from, to] = stations;
                speakLocalizedResponse('planningTrip', () => {
                    closeVoiceAssistant();
                    showPage('page-trip-planner');
                    document.getElementById('trip-from').value = from.id;
                    document.getElementById('trip-to').value = to.id;
                    
                    setTimeout(() => {
                        planTrip();
                        setTimeout(() => {
                            readRouteAloud();
                        }, 1000);
                    }, 500);
                }, { from: from.name, to: to.name });
            } else {
                speakLocalizedResponse('tripHelp');
                setTimeout(() => {
                    closeVoiceAssistant();
                    showPage('page-trip-planner');
                }, 3000);
            }
        }
        
        function handleCrowdCommand(command) {
            const station = findStationInCommand(command);
            
            if (station) {
                const level = state.crowdLevels[station.id] || 'low';
                const responseKey = level === 'high' ? 'crowdHigh' : level === 'medium' ? 'crowdMedium' : 'crowdLow';
                speakLocalizedResponse(responseKey, null, { station: station.name });
            } else {
                const crowdedStations = getAllStations().filter(s => state.crowdLevels[s.id] === 'high');
                
                if (crowdedStations.length > 0) {
                    const stationNames = crowdedStations.map(s => s.name).join(', ');
                    speakResponse(`${stationNames} ${crowdedStations.length === 1 ? 'is' : 'are'} crowded.`);
                } else {
                    speakLocalizedResponse('allCrowdOk');
                }
            }
        }
        
        function handleStationsCommand(command) {
            const lineKeywords = {
                purple: ['purple', '‡§¨‡•à‡§Ç‡§ó‡§®‡•Ä', '‡≤®‡≥á‡≤∞‡≤≥‡≥Ü', '‡Æä‡Æ§‡Ææ', '‡∞ä‡∞¶‡∞æ', '‡¥™‡µº‡¥™‡µç‡¥™‡¥ø‡µæ'],
                green: ['green', '‡§π‡§∞‡•Ä', '‡≤π‡≤∏‡≤ø‡≤∞‡≥Å', '‡Æ™‡Æö‡Øç‡Æö‡Øà', '‡∞Ü‡∞ï‡±Å‡∞™‡∞ö‡±ç‡∞ö', '‡¥ó‡µç‡¥∞‡µÄ‡µª'],
                yellow: ['yellow', '‡§™‡•Ä‡§≤‡•Ä', '‡≤π‡≤≥‡≤¶‡≤ø', '‡ÆÆ‡Æû‡Øç‡Æö‡Æ≥‡Øç', '‡∞™‡∞∏‡±Å‡∞™‡±Å', '‡¥Æ‡¥û‡µç‡¥û']
            };
            
            for (const [line, keywords] of Object.entries(lineKeywords)) {
                if (keywords.some(kw => command.includes(kw))) {
                    speakResponse(`Opening ${line} line stations.`, () => {
                        closeVoiceAssistant();
                        filterStations(line);
                    });
                    return;
                }
            }
            
            speakLocalizedResponse('openingStations', () => {
                closeVoiceAssistant();
                showPage('page-stations');
                filterStations('all');
            });
        }
        
        function handleAssistanceCommand(command) {
            const station = findStationInCommand(command);
            
            speakLocalizedResponse('openingHelp', () => {
                closeVoiceAssistant();
                
                if (station) {
                    showAssistanceSheet();
                    document.getElementById('assist-station').value = station.id;
                    
                    // Detect assistance type in multiple languages
                    const wheelchairKw = ['wheelchair', '‡§µ‡•ç‡§π‡•Ä‡§≤‡§ö‡•á‡§Ø‡§∞', '‡≤µ‡≥Ä‡≤≤‡≥ç‚Äå‡≤ö‡≥á‡≤∞‡≥ç', '‡Æö‡Æï‡Øç‡Æï‡Æ∞ ‡Æ®‡Ææ‡Æ±‡Øç‡Æï‡Ææ‡Æ≤‡Æø', '‡∞µ‡±Ä‡∞≤‡±ç ‡∞ö‡±Ü‡∞Ø‡∞ø‡∞∞‡±ç', '‡¥µ‡µÄ‡µΩ‡¥ö‡µÜ‡¥Ø‡µº'];
                    const visualKw = ['visual', 'blind', 'see', '‡§Ü‡§Å‡§ñ', '‡≤ï‡≤£‡≥ç‡≤£‡≥Å', '‡Æï‡Æ£‡Øç', '‡∞ï‡∞®‡±ç‡∞®‡±Å', '‡¥ï‡¥£‡µç‡¥£‡µç'];
                    const hearingKw = ['hearing', 'deaf', '‡§ï‡§æ‡§®', '‡≤ï‡≤ø‡≤µ‡≤ø', '‡Æï‡Ææ‡Æ§‡ØÅ', '‡∞ö‡±Ü‡∞µ‡∞ø', '‡¥ö‡µÜ‡¥µ‡¥ø'];
                    const elderlyKw = ['elderly', 'old', '‡§¨‡•Å‡§ú‡•Å‡§∞‡•ç‡§ó', '‡≤µ‡≥É‡≤¶‡≥ç‡≤ß', '‡ÆÆ‡ØÅ‡Æ§‡Æø‡ÆØ‡Æµ‡Æ∞‡Øç', '‡∞µ‡±É‡∞¶‡±ç‡∞ß', '‡¥µ‡µÉ‡¥¶‡µç‡¥ß'];
                    
                    if (wheelchairKw.some(kw => command.includes(kw))) {
                        document.getElementById('assist-type').value = 'wheelchair';
                    } else if (visualKw.some(kw => command.includes(kw))) {
                        document.getElementById('assist-type').value = 'visual';
                    } else if (hearingKw.some(kw => command.includes(kw))) {
                        document.getElementById('assist-type').value = 'hearing';
                    } else if (elderlyKw.some(kw => command.includes(kw))) {
                        document.getElementById('assist-type').value = 'elderly';
                    }
                } else {
                    showAssistanceSheet();
                }
            });
        }
        
        function handleNavigationCommand(page) {
            switch(page) {
                case 'home':
                    speakLocalizedResponse('goingHome', () => {
                        closeVoiceAssistant();
                        showPage('page-commuter');
                    });
                    break;
                case 'settings':
                    speakLocalizedResponse('openingSettings', () => {
                        closeVoiceAssistant();
                        showPage('page-settings');
                    });
                    break;
            }
        }
        
        function handleReadRouteCommand() {
            if (state.currentRoute) {
                closeVoiceAssistant();
                readRouteAloud();
            } else {
                speakLocalizedResponse('noRoute');
            }
        }
        
        function handleLocationCommand() {
            speakLocalizedResponse('gettingLocation', () => {
                closeVoiceAssistant();
                openFullMap();
                setTimeout(() => {
                    getMyLocation();
                }, 500);
            });
        }
        
        function handleMapCommand() {
            speakLocalizedResponse('openingMap', () => {
                closeVoiceAssistant();
                openFullMap();
            });
        }
        
        function handleFacilitiesCommand(command) {
            const station = findStationInCommand(command);
            
            if (station) {
                const facilities = station.facilities || [];
                const facilityNames = {
                    elevator: t('elevator'),
                    ramp: t('ramp'),
                    tactile: t('tactile'),
                    wheelchair: t('wheelchair'),
                    toilet: t('toilet'),
                    assistance: t('assistance'),
                    interchange: t('interchange_facility')
                };
                
                const facilityList = facilities.map(f => facilityNames[f] || f).join(', ');
                speakLocalizedResponse('facilities', () => {
                    closeVoiceAssistant();
                    showStationDetail(station.id);
                }, { station: station.name, facilities: facilityList });
            } else {
                speakResponse("Please specify a station name.");
            }
        }
        
        function handleLanguageCommand(command) {
            const languages = {
                'english': { code: 'en', name: 'English' },
                'hindi': { code: 'hi', name: 'Hindi' },
                '‡§π‡§ø‡§Ç‡§¶‡•Ä': { code: 'hi', name: '‡§π‡§ø‡§Ç‡§¶‡•Ä' },
                'kannada': { code: 'kn', name: 'Kannada' },
                '‡≤ï‡≤®‡≥ç‡≤®‡≤°': { code: 'kn', name: '‡≤ï‡≤®‡≥ç‡≤®‡≤°' },
                'tamil': { code: 'ta', name: 'Tamil' },
                '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç': { code: 'ta', name: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç' },
                'telugu': { code: 'te', name: 'Telugu' },
                '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å': { code: 'te', name: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å' },
                'malayalam': { code: 'ml', name: 'Malayalam' },
                '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç': { code: 'ml', name: '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç' }
            };
            
            for (const [keyword, langInfo] of Object.entries(languages)) {
                if (command.toLowerCase().includes(keyword.toLowerCase())) {
                    changeLanguage(langInfo.code);
                    // Update voice recognition language
                    if (voiceRecognition) {
                        voiceRecognition.lang = getVoiceLang();
                    }
                    speakLocalizedResponse('languageChanged', null, { language: langInfo.name });
                    return;
                }
            }
            
            speakResponse("I support English, Hindi, Kannada, Tamil, Telugu, and Malayalam.");
        }
        
        // ============================================
        // PWA INSTALL & SERVICE WORKER
        // ============================================
        let deferredPrompt = null;
        
        // Register Service Worker
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('ServiceWorker registered:', registration.scope);
                    
                    // Check for updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showToast('üîÑ New version available! Refresh to update.', 'info');
                            }
                        });
                    });
                } catch (error) {
                    console.log('ServiceWorker registration failed:', error);
                }
            }
        }
        
        // PWA Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });
        
        function showInstallButton() {
            // Add install button to landing page
            const installBtn = document.createElement('button');
            installBtn.id = 'install-btn';
            installBtn.className = 'btn-press glass-gold rounded-2xl px-6 py-3 font-bold flex items-center gap-2 mx-auto mt-4 animate-slide-up';
            installBtn.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                <span data-i18n="install_app">Install App</span>
            `;
            installBtn.onclick = installPWA;
            
            const landingButtons = document.querySelector('#page-landing .flex.flex-col.sm\\:flex-row');
            if (landingButtons && !document.getElementById('install-btn')) {
                landingButtons.parentNode.insertBefore(installBtn, landingButtons.nextSibling);
            }
            
            // Show install button in settings
            const settingsInstallBtn = document.getElementById('settings-install-btn');
            if (settingsInstallBtn) {
                settingsInstallBtn.classList.remove('hidden');
            }
            
            // Update PWA status
            updatePWAStatus();
        }
        
        function updatePWAStatus() {
            const statusEl = document.getElementById('pwa-status');
            if (!statusEl) return;
            
            if (isPWA()) {
                statusEl.innerHTML = '<span class="text-green-400">‚úì Running as installed app</span>';
            } else if (deferredPrompt) {
                statusEl.innerHTML = '<span class="text-yellow-400">üì≤ App can be installed</span>';
            } else {
                statusEl.innerHTML = '<span class="text-gray-500">üåê Running in browser</span>';
            }
        }
        
        async function installPWA() {
            if (!deferredPrompt) {
                showToast('App is already installed or not installable', 'info');
                return;
            }
            
            Haptics.success();
            deferredPrompt.prompt();
            
            const { outcome } = await deferredPrompt.userChoice;
            console.log('Install prompt outcome:', outcome);
            
            if (outcome === 'accepted') {
                showToast('üéâ AccessiGo installed! Find it on your home screen.', 'success');
                document.getElementById('install-btn')?.remove();
            }
            
            deferredPrompt = null;
        }
        
        // Handle app installed event
        window.addEventListener('appinstalled', () => {
            console.log('AccessiGo was installed');
            showToast('‚úì AccessiGo installed successfully!', 'success');
            deferredPrompt = null;
            document.getElementById('install-btn')?.remove();
        });
        
        // Check if running as PWA
        function isPWA() {
            return window.matchMedia('(display-mode: standalone)').matches 
                || window.navigator.standalone 
                || document.referrer.includes('android-app://');
        }
        
        // Handle URL parameters for shortcuts
        function handleShortcuts() {
            const params = new URLSearchParams(window.location.search);
            const action = params.get('action');
            
            if (action) {
                setTimeout(() => {
                    switch(action) {
                        case 'trip':
                            showPage('page-commuter');
                            setTimeout(() => showPage('page-trip-planner'), 300);
                            break;
                        case 'sos':
                            showPage('page-commuter');
                            setTimeout(() => triggerSOS(), 300);
                            break;
                        case 'voice':
                            showPage('page-commuter');
                            setTimeout(() => openVoiceAssistant(), 300);
                            break;
                    }
                }, 500);
            }
        }
        
        // Request notification permission
        async function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    console.log('Notification permission granted');
                }
            }
        }
        
        // Send local notification (for PWA)
        function sendNotification(title, body, data = {}) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification(title, {
                    body,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><rect width="512" height="512" rx="128" fill="%23FFD700"/></svg>',
                    badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 96 96"><rect width="96" height="96" rx="20" fill="%23FFD700"/></svg>',
                    vibrate: [100, 50, 100],
                    data
                });
                
                notification.onclick = () => {
                    window.focus();
                    notification.close();
                };
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            initializeCrowdLevels();
            populateStationSelects();
            renderCrowdStatus();
            renderStationsList();
            renderStaffDashboard();
            applyLanguage();
            applyAccessibilitySettings();
            checkActiveRequest();
            initVoiceRecognition();
            registerServiceWorker();
            handleShortcuts();
            
            // Preload speech synthesis voices
            preloadVoices();
            
            // Update voice status after voices load
            setTimeout(updateVoiceStatusInfo, 1000);
            
            // Request notification permission after a delay
            setTimeout(requestNotificationPermission, 5000);
            
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                state.reduceMotion = true;
                applyAccessibilitySettings();
            }
            
            // Show PWA status
            if (isPWA()) {
                console.log('Running as PWA');
            }
            
            updatePWAStatus();
        });
        
        // Preload and log available voices
        function preloadVoices() {
            if ('speechSynthesis' in window) {
                // Force voice loading
                window.speechSynthesis.getVoices();
                
                // Log voices when loaded
                window.speechSynthesis.onvoiceschanged = () => {
                    const voices = window.speechSynthesis.getVoices();
                    console.log('Available voices:', voices.length);
                    
                    // Log Indian language voices
                    const indianVoices = voices.filter(v => 
                        v.lang.includes('IN') || 
                        v.lang.startsWith('hi') || 
                        v.lang.startsWith('kn') || 
                        v.lang.startsWith('ta') || 
                        v.lang.startsWith('te') || 
                        v.lang.startsWith('ml')
                    );
                    
                    if (indianVoices.length > 0) {
                        console.log('Indian voices available:', indianVoices.map(v => `${v.name} (${v.lang})`));
                    } else {
                        console.log('No Indian language voices found. Using Google TTS fallback.');
                    }
                    
                    // Update voice status in settings
                    updateVoiceStatusInfo();
                };
            }
        }
        
        // Update voice status information in settings
        function updateVoiceStatusInfo() {
            const container = document.getElementById('voice-status-info');
            if (!container) return;
            
            const languages = [
                { code: 'en', name: 'English', native: 'English' },
                { code: 'hi', name: 'Hindi', native: '‡§π‡§ø‡§Ç‡§¶‡•Ä' },
                { code: 'kn', name: 'Kannada', native: '‡≤ï‡≤®‡≥ç‡≤®‡≤°' },
                { code: 'ta', name: 'Tamil', native: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç' },
                { code: 'te', name: 'Telugu', native: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å' },
                { code: 'ml', name: 'Malayalam', native: '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç' }
            ];
            
            const html = languages.map(lang => {
                const hasNative = hasNativeVoice(lang.code);
                const voice = getBestVoice(lang.code);
                
                return `
                    <div class="flex items-center justify-between p-2 rounded-lg ${lang.code === state.currentLang ? 'bg-yellow-500/20 border border-yellow-500/30' : 'bg-white/5'}">
                        <div class="flex items-center gap-2">
                            <span class="text-lg">${lang.code === state.currentLang ? '‚úì' : ''}</span>
                            <span class="font-medium">${lang.native}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            ${hasNative 
                                ? `<span class="text-green-400 text-xs">Native ‚úì</span>` 
                                : `<span class="text-blue-400 text-xs">Google TTS</span>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html + `
                <p class="text-xs text-gray-500 mt-2">
                    ${hasNativeVoice(state.currentLang) 
                        ? '‚úì Your device has native voice for selected language' 
                        : 'üåê Using Google Translate TTS (requires internet)'}
                </p>
            `;
        }
        
        // Test voice function
        function testVoice() {
            Haptics.medium();
            
            const testMessages = {
                en: "Hello! This is AccessiGo voice assistant. Your voice is working correctly.",
                hi: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Ø‡§π ‡§è‡§ï‡•ç‡§∏‡•á‡§∏‡•Ä‡§ó‡•ã ‡§µ‡•â‡§Ø‡§∏ ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•à‡•§ ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡§π‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∞‡§π‡•Ä ‡§π‡•à‡•§",
                kn: "‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞! ‡≤á‡≤¶‡≥Å ‡≤é‡≤ï‡≥ç‡≤∏‡≥Ü‡≤∏‡≤ø‡≤ó‡≥ã ‡≤µ‡≤æ‡≤Ø‡≥ç‡≤∏‡≥ç ‡≤Ö‡≤∏‡≤ø‡≤∏‡≥ç‡≤ü‡≥Ü‡≤Ç‡≤ü‡≥ç. ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤∏‡≤∞‡≤ø‡≤Ø‡≤æ‡≤ó‡≤ø ‡≤ï‡≤æ‡≤∞‡≥ç‡≤Ø‡≤®‡≤ø‡≤∞‡≥ç‡≤µ‡≤π‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü.",
                ta: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æá‡Æ§‡ØÅ ‡ÆÜ‡Æï‡Øç‡Æö‡ØÜ‡Æö‡Æø‡Æï‡Øã ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç. ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æï ‡Æµ‡Øá‡Æ≤‡Øà ‡Æö‡ØÜ‡ÆØ‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.",
                te: "‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç! ‡∞á‡∞¶‡∞ø ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡∞ø‡∞ó‡±ã ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞Ö‡∞∏‡∞ø‡∞∏‡±ç‡∞ü‡±Ü‡∞Ç‡∞ü‡±ç. ‡∞Æ‡±Ä ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞∏‡∞∞‡∞ø‡∞ó‡±ç‡∞ó‡∞æ ‡∞™‡∞®‡∞ø ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø.",
                ml: "‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç! ‡¥á‡¥§‡µç ‡¥Ü‡¥ï‡µç‡¥∏‡¥∏‡¥ø‡¥ó‡µã ‡¥µ‡µã‡¥Ø‡µç‡¥∏‡µç ‡¥Ö‡¥∏‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥®‡µç‡¥±‡µç ‡¥Ü‡¥£‡µç. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∂‡¥¨‡µç‡¥¶‡¥Ç ‡¥∂‡¥∞‡¥ø‡¥Ø‡¥æ‡¥Ø‡¥ø ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ."
            };
            
            const message = testMessages[state.currentLang] || testMessages.en;
            speak(message);
        }
        
        // Call voice status update when settings page is shown
        const originalShowPage = showPage;
        showPage = function(pageId) {
            originalShowPage(pageId);
            if (pageId === 'page-settings') {
                setTimeout(updateVoiceStatusInfo, 100);
            }
        };
    </script>
</body>
</html>
